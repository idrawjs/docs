function Gl(e){return function(t,i){return n(0);function n(o){let s=e[o];if(o===e.length&&i&&(s=i),!s)return Promise.resolve();try{return Promise.resolve(s(t,n.bind(null,o+1)))}catch(r){return Promise.reject(r)}}}}function Xl(e){return new Promise(t=>{setTimeout(()=>{t()},e)})}function Hl(e,t){let i=-1;return function(...n){i>=0||(i=setTimeout(()=>{e(...n),i=-1},t))}}function Nl(e,t){let i=-1;return function(...n){i>=0&&window.clearTimeout(i),i=setTimeout(()=>{e(...n),i=-1},t)}}function Ul(e,t){const{fileName:i,type:n="image/jpeg"}=t,o=e.toDataURL(n);let s=document.createElement("a");s.href=o,s.download=i,s.click(),s=null}function $l(e){const{accept:t,success:i,error:n}=e;let o=document.createElement("input");o.type="file",t&&(o.accept=t),o.addEventListener("change",function(){var s;const r=(s=o.files)===null||s===void 0?void 0:s[0];i({file:r}),o=null}),o.addEventListener("error",function(s){typeof n=="function"&&n(s),o=null}),o.click()}function Ql(e){return new Promise(function(t,i){let n=new FileReader;n.addEventListener("load",function(){t(n.result),n=null}),n.addEventListener("error",function(o){i(o),n=null}),n.addEventListener("abort",function(){i(new Error("abort")),n=null}),n.readAsDataURL(e)})}function Zl(e){return new Promise(function(t,i){let n=new FileReader;n.addEventListener("load",function(){t(n.result),n=null}),n.addEventListener("error",function(o){i(o),n=null}),n.addEventListener("abort",function(){i(new Error("abort")),n=null}),n.readAsText(e)})}function $s(e){const t=new TextEncoder().encode(e),i=new Blob([t],{type:"text/plain;charset=utf-8"});return window.URL.createObjectURL(i)}function Jl(e,t){const{fileName:i}=t,n=$s(e);let o=document.createElement("a");o.href=n,o.download=i,o.click(),o=null}function Kl(e){return parseInt(e.replace(/^\#/,"0x"))}function ql(e){return"#"+e.toString(16)}function Ni(e){return typeof e=="string"&&(/^\#([0-9a-f]{3}|[0-9a-f]{6}|[0-9a-f]{8})$/i.test(e)||/^[a-z]{1,}$/i.test(e))}const Qs={aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgreen:"#006400",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",gold:"#ffd700",goldenrod:"#daa520",gray:"#808080",green:"#008000",greenyellow:"#adff2f",honeydew:"#f0fff0",hotpink:"#ff69b4","indianred ":"#cd5c5c",indigo:"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",lavender:"#e6e6fa",lavenderblush:"#fff0f5",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrodyellow:"#fafad2",lightgrey:"#d3d3d3",lightgreen:"#90ee90",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370d8",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#d87093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",rebeccapurple:"#663399",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32"};function ec(e){const t=e.toLowerCase(),i=Qs[t];return typeof i=="string"?i:null}function tc(e){let t="transparent";if(typeof e=="string")t=e;else if((e==null?void 0:e.type)==="linear-gradient"){const i=[];typeof e.angle=="number"?i.push(`${e.angle}deg`):i.push("180deg"),Array.isArray(e.stops)&&e.stops.forEach(n=>{i.push(`${n.color} ${n.offset*100}%`)}),t=`linear-gradient(${i.join(", ")})`}else if((e==null?void 0:e.type)==="radial-gradient"){const i=[];Array.isArray(e.stops)&&e.stops.forEach(n=>{i.push(`${n.color} ${n.offset*100}%`)}),t=`radial-gradient(circle, ${i.join(", ")})`}return t}function ic(e){let t="transparent";if(typeof e=="string")t=e;else if((e==null?void 0:e.type)==="radial-gradient"||(e==null?void 0:e.type)==="linear-gradient"){const i=[];Array.isArray(e.stops)&&e.stops.length>0&&(e.stops.forEach((n,o)=>{i.push(`${n.color} ${n.offset*100}%`),o===e.stops.length-1&&n.offset<1&&i.push(`${n.color} ${n.offset*100}%`)}),t=`linear-gradient(90deg, ${i.join(", ")})`)}return t}function Kn(e,t){if(t===1)return e;let i=1;const n=/^\#[0-9a-f]{6,6}$/i,o=/^\#[0-9a-f]{8,8}$/i;let s=e;if(n.test(e)?i=parseInt(e.substring(5,7).replace(/^\#/,"0x")):o.test(e)&&(i=parseInt(e.substring(7,9).replace(/^\#/,"0x")),s=e.substring(0,7)),i=i*t,n.test(s)&&i>0&&i<1){const r=Math.max(0,Math.min(255,Math.ceil(i*256)));s=`${s.toUpperCase()}${r.toString(16).toUpperCase()}`}return s}function gt(){function e(){return((1+Math.random())*65536|0).toString(16).substring(1)}return`${e()}${e()}-${e()}-${e()}-${e()}-${e()}${e()}${e()}`}function tt(e){let t=0;for(let i=0;i<e.length;i++)t+=e.charCodeAt(i)*e.charCodeAt(i)*i*i;return t.toString(16).substring(0,4)}function qe(e){const t=e.length,i=Math.floor(t/2),n=e.substring(0,4).padEnd(4,"0"),o=e.substring(0,4).padEnd(4,"0"),s=tt(t.toString(16).padEnd(4,n)),r=tt(e.substring(i-4,i).padEnd(4,n)).padEnd(4,"f"),a=tt(e.substring(i-8,i-4).padEnd(4,n)).padEnd(4,"f"),c=tt(e.substring(i-12,i-8).padEnd(4,n)).padEnd(4,"f"),l=tt(e.substring(i-16,i-12).padEnd(4,o)).padEnd(4,"f"),d=tt(e.substring(i,i+4).padEnd(4,o)).padEnd(4,"f"),f=tt(e.substring(i+4,i+8).padEnd(4,o)).padEnd(4,"f"),u=tt(o.padEnd(4,n).padEnd(4,o));return`@assets/${s}${r}-${a}-${c}-${l}-${d}${f}${u}`}function vt(e){return/^@assets\/[0-9a-z]{8,8}\-[0-9a-z]{4,4}\-[0-9a-z]{4,4}\-[0-9a-z]{4,4}\-[0-9a-z]{12,12}$/.test(`${e}`)}function Vt(e){function t(i){const n=Zs(i);if(["Null","Number","String","Boolean","Undefined"].indexOf(n)>=0)return i;if(n==="Array"){const o=[];return i.forEach(s=>{o.push(t(s))}),o}else if(n==="Object"){const o={};return Object.keys(i).forEach(a=>{o[a]=t(i[a])}),Object.getOwnPropertySymbols(i).forEach(a=>{o[a]=t(i[a])}),o}}return t(e)}function nc(e){const t=Vt(e),i=n=>{n.uuid=gt(),n.type==="group"&&n.detail.children&&n.detail.children.forEach(o=>{i(o)})};return i(t),t}function Zs(e){return Object.prototype.toString.call(e).replace(/[\]|\[]{1,1}/gi,"").split(" ")[1]}function oc(e,t){const i=e.assets||{};let n=e;(t==null?void 0:t.clone)===!0&&(n=Vt(e));const o=s=>{s.forEach(r=>{if(r.type==="image"&&r.detail.src){const a=r.detail.src,c=qe(a);i[c]||(i[c]={type:"image",value:a}),r.detail.src=c}else if(r.type==="svg"){const a=r.detail.svg,c=qe(a);i[c]||(i[c]={type:"svg",value:a}),r.detail.svg=c}else if(r.type==="html"){const a=r.detail.html,c=qe(a);i[c]||(i[c]={type:"html",value:a}),r.detail.html=c}else if(r.type==="group"&&Array.isArray(r.detail.children)){const a=r.detail.assets||{};Object.keys(a).forEach(c=>{i[c]||(i[c]=a[c])}),delete r.detail.assets,o(r.detail.children)}})};return o(n.elements),n.assets=i,n}function Js(e,t){const i=e.assets||{},n=Vt(e),o=(t==null?void 0:t.loadItemMap)||{},s=r=>{r.forEach(a=>{var c,l,d;if(a.type==="image"&&a.detail.src){const f=a.detail.src;if(vt(f)&&!i[f]&&o[f]&&typeof((c=o[f])===null||c===void 0?void 0:c.source)=="string")i[f]={type:"image",value:o[f].source};else if(!i[f]){const u=qe(f);i[u]||(i[u]={type:"image",value:f}),a.detail.src=u}}else if(a.type==="svg"){const f=a.detail.svg;if(vt(f)&&!i[f]&&o[f]&&typeof((l=o[f])===null||l===void 0?void 0:l.source)=="string")i[f]={type:"svg",value:o[f].source};else if(!i[f]){const u=qe(f);i[u]||(i[u]={type:"svg",value:f}),a.detail.svg=u}}else if(a.type==="html"){const f=a.detail.html;if(vt(f)&&!i[f]&&o[f]&&typeof((d=o[f])===null||d===void 0?void 0:d.source)=="string")i[f]={type:"html",value:o[f].source};else if(!i[f]){const u=qe(f);i[u]||(i[u]={type:"html",value:f}),a.detail.html=u}}else if(a.type==="group"&&Array.isArray(a.detail.children)){const f=a.detail.assets||{};Object.keys(f).forEach(u=>{i[u]||(i[u]=f[u])}),delete a.detail.assets,s(a.detail.children)}})};return s(n.elements),n.assets=i,n}function Oe(e){return(Object.prototype.toString.call(e)||"").replace(/(\[object|\])/gi,"").trim()}const Ut={type(e,t){const i=Oe(e);return t===!0?i.toLocaleLowerCase():i},array(e){return Oe(e)==="Array"},json(e){return Oe(e)==="Object"},function(e){return Oe(e)==="Function"},asyncFunction(e){return Oe(e)==="AsyncFunction"},boolean(e){return Oe(e)==="Boolean"},string(e){return Oe(e)==="String"},number(e){return Oe(e)==="Number"},undefined(e){return Oe(e)==="Undefined"},null(e){return Oe(e)==="Null"},promise(e){return Oe(e)==="Promise"}};function Ks(e,t){const{width:i,height:n}=t;return new Promise((o,s)=>{const r=`
    <svg 
      xmlns="http://www.w3.org/2000/svg" 
      width="${i||""}" 
      height = "${n||""}">
      <foreignObject width="100%" height="100%">
        <div xmlns = "http://www.w3.org/1999/xhtml">
          ${e}
        </div>
      </foreignObject>
    </svg>
    `,a=new Blob([r],{type:"image/svg+xml;charset=utf-8"}),c=new FileReader;c.readAsDataURL(a),c.onload=function(l){var d;const f=(d=l==null?void 0:l.target)===null||d===void 0?void 0:d.result;o(f)},c.onerror=function(l){s(l)}})}function qs(e){return new Promise((t,i)=>{const n=e,o=new Blob([n],{type:"image/svg+xml;charset=utf-8"}),s=new FileReader;s.readAsDataURL(o),s.onload=function(r){var a;const c=(a=r==null?void 0:r.target)===null||a===void 0?void 0:a.result;t(c)},s.onerror=function(r){i(r)}})}var $o=function(e,t,i,n){function o(s){return s instanceof i?s:new i(function(r){r(s)})}return new(i||(i=Promise))(function(s,r){function a(d){try{l(n.next(d))}catch(f){r(f)}}function c(d){try{l(n.throw(d))}catch(f){r(f)}}function l(d){d.done?s(d.value):o(d.value).then(a,c)}l((n=n.apply(e,t||[])).next())})};const{Image:er}=window;function nn(e){return new Promise((t,i)=>{const n=new er;n.crossOrigin="anonymous",n.onload=function(){t(n)},n.onabort=i,n.onerror=i,n.src=e})}function tr(e){return $o(this,void 0,void 0,function*(){const t=yield qs(e);return yield nn(t)})}function ir(e){return e.replace(/\&/gi,"&amp;")}function nr(e,t){return $o(this,void 0,void 0,function*(){e=ir(e);const i=yield Ks(e,t);return yield nn(i)})}function yt(e){return typeof e=="number"&&(e>0||e<=0)}function or(e){return yt(e)}function sr(e){return yt(e)}function Qo(e){return typeof e=="number"&&e>=0}function rr(e){return typeof e=="number"&&e>=0}function ar(e){return typeof e=="number"&&e>=-360&&e<=360}function lr(e){return Qo(e)}function cr(e){return yt(e)&&e>=0}function dr(e){return Ni(e)}function Zo(e){return typeof e=="string"&&/^(http:\/\/|https:\/\/|\.\/|\/)/.test(`${e}`)}function Jo(e){return typeof e=="string"&&/^(data:image\/)/.test(`${e}`)}function fr(e){return Jo(e)||Zo(e)}function hr(e){return typeof e=="string"&&/^(<svg[\s]{1,}|<svg>)/i.test(`${e}`.trim())&&/<\/[\s]{0,}svg>$/i.test(`${e}`.trim())}function ur(e){let t=!1;if(typeof e=="string"){let i=document.createElement("div");i.innerHTML=e,i.children.length>0&&(t=!0),i=null}return t}function gr(e){return typeof e=="string"}function vr(e){return yt(e)&&e>0}function mr(e){return yt(e)&&e>0}function yr(e){return yt(e)&&e>0}function wr(e){return["center","left","right"].includes(e)}function pr(e){return typeof e=="string"&&e.length>0}function br(e){return["bold"].includes(e)}function Sr(e){return/^(-?\d+(?:\.\d+)?)$/.test(`${e}`)}const J={x:or,y:sr,w:Qo,h:rr,angle:ar,number:yt,numberStr:Sr,borderWidth:lr,borderRadius:cr,color:dr,imageSrc:fr,imageURL:Zo,imageBase64:Jo,svg:hr,html:ur,text:gr,fontSize:vr,lineHeight:mr,textAlign:wr,fontFamily:pr,fontWeight:br,strokeWidth:yr};function Mr(e){const{x:t,y:i,w:n,h:o,angle:s}=e;return!(!(J.x(t)&&J.y(i)&&J.w(n)&&J.h(o)&&J.angle(s))||!(s>=-360&&s<=360))}function Ko(e={}){const{borderColor:t,borderRadius:i,borderWidth:n}=e;return!(e.hasOwnProperty("borderColor")&&!J.color(t)||e.hasOwnProperty("borderRadius")&&!J.number(i)||e.hasOwnProperty("borderWidth")&&!J.number(n))}function xr(e){const{background:t}=e;return!(e.hasOwnProperty("background")&&!J.color(t)||!Ko(e))}function Ar(e){const{background:t,borderColor:i,borderWidth:n}=e;return!(e.hasOwnProperty("background")&&!J.color(t)||e.hasOwnProperty("borderColor")&&!J.color(i)||e.hasOwnProperty("borderWidth")&&!J.number(n))}function Ir(e){const{src:t}=e;return!!J.imageSrc(t)}function Rr(e){const{svg:t}=e;return!!J.svg(t)}function Pr(e){const{html:t}=e;return!!J.html(t)}function zr(e){const{text:t,color:i,fontSize:n,lineHeight:o,fontFamily:s,textAlign:r,fontWeight:a,background:c,strokeWidth:l,strokeColor:d}=e;return!(!J.text(t)||!J.color(i)||!J.fontSize(n)||e.hasOwnProperty("background")&&!J.color(c)||e.hasOwnProperty("fontWeight")&&!J.fontWeight(a)||e.hasOwnProperty("lineHeight")&&!J.lineHeight(o)||e.hasOwnProperty("fontFamily")&&!J.fontFamily(s)||e.hasOwnProperty("textAlign")&&!J.textAlign(r)||e.hasOwnProperty("strokeWidth")&&!J.strokeWidth(l)||e.hasOwnProperty("strokeColor")&&!J.color(d)||!Ko(e))}const sc={attrs:Mr,textDesc:zr,rectDesc:xr,circleDesc:Ar,imageDesc:Ir,svgDesc:Rr,htmlDesc:Pr};var ui=function(e,t,i,n,o){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!o)throw new TypeError("Private accessor was defined without a setter");if(typeof t=="function"?e!==t||!o:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?o.call(e,i):o?o.value=i:t.set(e,i),i},V=function(e,t,i,n){if(i==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof t=="function"?e!==t||!n:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return i==="m"?n:i==="a"?n.call(e):n?n.value:t.get(e)},B,Xe;const Lr=12,Er="400",Tr="-apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, 'Noto Sans', sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji'";class qo{constructor(t,i){B.set(this,void 0),Xe.set(this,void 0),ui(this,B,t,"f"),ui(this,Xe,Object.assign({devicePixelRatio:1,offscreenCanvas:null},i),"f"),this.$resetFont()}$undoPixelRatio(t){return t/V(this,Xe,"f").devicePixelRatio}$doPixelRatio(t){return V(this,Xe,"f").devicePixelRatio*t}$getContext(){return V(this,B,"f")}$setContext(t){ui(this,B,t,"f")}$setFont(t){const i=[];t.fontWeight&&i.push(`${t.fontWeight}`),i.push(`${this.$doPixelRatio(t.fontSize||12)}px`),i.push(`${t.fontFamily||"sans-serif"}`),V(this,B,"f").font=`${i.join(" ")}`}$resetFont(){this.$setFont({fontSize:Lr,fontFamily:Tr,fontWeight:Er})}$getOffscreenCanvas(){return V(this,Xe,"f").offscreenCanvas}$resize(t){const{width:i,height:n,devicePixelRatio:o,resetStyle:s}=t,{canvas:r}=V(this,B,"f");r.width=i*o,r.height=n*o,ui(this,Xe,Object.assign(Object.assign({},V(this,Xe,"f")),{devicePixelRatio:o}),"f"),s===!0&&(r.style.width=`${i}px`,r.style.height=`${n}px`)}$getSize(){const{devicePixelRatio:t}=V(this,Xe,"f"),{width:i,height:n}=V(this,B,"f").canvas;return{width:i/t,height:n/t,devicePixelRatio:t}}get canvas(){return V(this,B,"f").canvas}get fillStyle(){return V(this,B,"f").fillStyle}set fillStyle(t){V(this,B,"f").fillStyle=t}get strokeStyle(){return V(this,B,"f").strokeStyle}set strokeStyle(t){V(this,B,"f").strokeStyle=t}get lineWidth(){return this.$undoPixelRatio(V(this,B,"f").lineWidth)}set lineWidth(t){V(this,B,"f").lineWidth=this.$doPixelRatio(t)}get textAlign(){return V(this,B,"f").textAlign}set textAlign(t){V(this,B,"f").textAlign=t}get textBaseline(){return V(this,B,"f").textBaseline}set textBaseline(t){V(this,B,"f").textBaseline=t}get globalAlpha(){return V(this,B,"f").globalAlpha}set globalAlpha(t){V(this,B,"f").globalAlpha=t}get shadowColor(){return V(this,B,"f").shadowColor}set shadowColor(t){V(this,B,"f").shadowColor=t}get shadowOffsetX(){return this.$undoPixelRatio(V(this,B,"f").shadowOffsetX)}set shadowOffsetX(t){V(this,B,"f").shadowOffsetX=this.$doPixelRatio(t)}get shadowOffsetY(){return this.$undoPixelRatio(V(this,B,"f").shadowOffsetY)}set shadowOffsetY(t){V(this,B,"f").shadowOffsetY=this.$doPixelRatio(t)}get shadowBlur(){return this.$undoPixelRatio(V(this,B,"f").shadowBlur)}set shadowBlur(t){V(this,B,"f").shadowBlur=this.$doPixelRatio(t)}get lineCap(){return V(this,B,"f").lineCap}set lineCap(t){V(this,B,"f").lineCap=t}get globalCompositeOperation(){return V(this,B,"f").globalCompositeOperation}set globalCompositeOperation(t){V(this,B,"f").globalCompositeOperation=t}fill(...t){return V(this,B,"f").fill(...t)}arc(t,i,n,o,s,r){return V(this,B,"f").arc(this.$doPixelRatio(t),this.$doPixelRatio(i),this.$doPixelRatio(n),o,s,r)}rect(t,i,n,o){return V(this,B,"f").rect(this.$doPixelRatio(t),this.$doPixelRatio(i),this.$doPixelRatio(n),this.$doPixelRatio(o))}fillRect(t,i,n,o){return V(this,B,"f").fillRect(this.$doPixelRatio(t),this.$doPixelRatio(i),this.$doPixelRatio(n),this.$doPixelRatio(o))}clearRect(t,i,n,o){return V(this,B,"f").clearRect(this.$doPixelRatio(t),this.$doPixelRatio(i),this.$doPixelRatio(n),this.$doPixelRatio(o))}beginPath(){return V(this,B,"f").beginPath()}closePath(){return V(this,B,"f").closePath()}lineTo(t,i){return V(this,B,"f").lineTo(this.$doPixelRatio(t),this.$doPixelRatio(i))}moveTo(t,i){return V(this,B,"f").moveTo(this.$doPixelRatio(t),this.$doPixelRatio(i))}arcTo(t,i,n,o,s){return V(this,B,"f").arcTo(this.$doPixelRatio(t),this.$doPixelRatio(i),this.$doPixelRatio(n),this.$doPixelRatio(o),this.$doPixelRatio(s))}getLineDash(){return V(this,B,"f").getLineDash()}setLineDash(t){const i=t.map(n=>this.$doPixelRatio(n));return V(this,B,"f").setLineDash(i)}stroke(t){return t?V(this,B,"f").stroke(t):V(this,B,"f").stroke()}translate(t,i){return V(this,B,"f").translate(this.$doPixelRatio(t),this.$doPixelRatio(i))}rotate(t){return V(this,B,"f").rotate(t)}drawImage(...t){const i=t[0],n=t[1],o=t[2],s=t[3],r=t[4],a=t[t.length-4],c=t[t.length-3],l=t[t.length-2],d=t[t.length-1];return t.length===9?V(this,B,"f").drawImage(i,this.$doPixelRatio(n),this.$doPixelRatio(o),this.$doPixelRatio(s),this.$doPixelRatio(r),this.$doPixelRatio(a),this.$doPixelRatio(c),this.$doPixelRatio(l),this.$doPixelRatio(d)):V(this,B,"f").drawImage(i,this.$doPixelRatio(a),this.$doPixelRatio(c),this.$doPixelRatio(l),this.$doPixelRatio(d))}createPattern(t,i){return V(this,B,"f").createPattern(t,i)}measureText(t){return V(this,B,"f").measureText(t)}fillText(t,i,n,o){return o!==void 0?V(this,B,"f").fillText(t,this.$doPixelRatio(i),this.$doPixelRatio(n),this.$doPixelRatio(o)):V(this,B,"f").fillText(t,this.$doPixelRatio(i),this.$doPixelRatio(n))}strokeText(t,i,n,o){return o!==void 0?V(this,B,"f").strokeText(t,this.$doPixelRatio(i),this.$doPixelRatio(n),this.$doPixelRatio(o)):V(this,B,"f").strokeText(t,this.$doPixelRatio(i),this.$doPixelRatio(n))}save(){V(this,B,"f").save()}restore(){V(this,B,"f").restore()}scale(t,i){V(this,B,"f").scale(t,i)}circle(t,i,n,o,s,r,a,c){V(this,B,"f").ellipse(this.$doPixelRatio(t),this.$doPixelRatio(i),this.$doPixelRatio(n),this.$doPixelRatio(o),s,r,a,c)}isPointInPath(t,i){return V(this,B,"f").isPointInPath(this.$doPixelRatio(t),this.$doPixelRatio(i))}clip(...t){return V(this,B,"f").clip(...t)}setTransform(t,i,n,o,s,r){return V(this,B,"f").setTransform(t,i,n,o,s,r)}getTransform(){return V(this,B,"f").getTransform()}createLinearGradient(t,i,n,o){return V(this,B,"f").createLinearGradient(this.$doPixelRatio(t),this.$doPixelRatio(i),this.$doPixelRatio(n),this.$doPixelRatio(o))}createRadialGradient(t,i,n,o,s,r){return V(this,B,"f").createRadialGradient(this.$doPixelRatio(t),this.$doPixelRatio(i),this.$doPixelRatio(n),this.$doPixelRatio(o),this.$doPixelRatio(s),this.$doPixelRatio(r))}createConicGradient(t,i,n){return V(this,B,"f").createConicGradient(t,this.$doPixelRatio(i),this.$doPixelRatio(n))}}B=new WeakMap,Xe=new WeakMap;function bt(e){const{width:t,height:i,ctx:n,devicePixelRatio:o}=e;let s=n;if(!s){const a=document.createElement("canvas");a.width=t*o,a.height=i*o,s=a.getContext("2d")}return new qo(s,e)}function Ii(e){const{width:t,height:i,devicePixelRatio:n}=e,o=new OffscreenCanvas(t*n,i*n),r=o.getContext("2d").canvas.getContext("2d");return new qo(r,{devicePixelRatio:n,offscreenCanvas:o})}function Cr(e,t){const{width:i,height:n,devicePixelRatio:o,offscreen:s,createCustomContext2D:r}=t,a={width:i,height:n,devicePixelRatio:o},c=e.getContext("2d");if(r){const l=r(a),d=r(a),f=r(a),u=bt(Object.assign({ctx:c},a));return{underlayContext:f,viewContext:l,overlayContext:d,boardContext:u,drawView:()=>{const{width:h,height:m}=l.$getSize();u.clearRect(0,0,h,m),u.drawImage(f.canvas,0,0,h,m),u.drawImage(l.canvas,0,0,h,m),u.drawImage(d.canvas,0,0,h,m),f.clearRect(0,0,h,m),l.clearRect(0,0,h,m),d.clearRect(0,0,h,m)}}}if(s===!0){const l=Ii(a),d=Ii(a),f=Ii(a),u=bt(Object.assign({ctx:c},a));return{underlayContext:f,viewContext:l,overlayContext:d,boardContext:u,drawView:()=>{const{width:h,height:m}=l.$getSize();u.clearRect(0,0,h,m),u.drawImage(f.canvas,0,0,h,m),u.drawImage(l.canvas,0,0,h,m),u.drawImage(d.canvas,0,0,h,m),f.clearRect(0,0,h,m),l.clearRect(0,0,h,m),d.clearRect(0,0,h,m)}}}else{const l=bt(a),d=bt(a),f=bt(a),u=bt(Object.assign({ctx:c},a));return{underlayContext:f,viewContext:l,overlayContext:d,boardContext:u,drawView:()=>{u.clearRect(0,0,i,n),u.drawImage(f.canvas,0,0,i,n),u.drawImage(l.canvas,0,0,i,n),u.drawImage(d.canvas,0,0,i,n),f.clearRect(0,0,i,n),l.clearRect(0,0,i,n),d.clearRect(0,0,i,n)}}}}var Dr=function(e,t,i,n,o){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!o)throw new TypeError("Private accessor was defined without a setter");if(typeof t=="function"?e!==t||!o:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?o.call(e,i):o?o.value=i:t.set(e,i),i},We=function(e,t,i,n){if(i==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof t=="function"?e!==t||!n:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return i==="m"?n:i==="a"?n.call(e):n?n.value:t.get(e)},Pe;class ri{constructor(){Pe.set(this,void 0),Dr(this,Pe,new Map,"f")}on(t,i){if(We(this,Pe,"f").has(t)){const n=We(this,Pe,"f").get(t)||[];n==null||n.push(i),We(this,Pe,"f").set(t,n)}else We(this,Pe,"f").set(t,[i])}off(t,i){if(We(this,Pe,"f").has(t)){const n=We(this,Pe,"f").get(t);if(Array.isArray(n)){for(let o=0;o<(n==null?void 0:n.length);o++)if(n[o]===i){n.splice(o,1);break}}We(this,Pe,"f").set(t,n||[])}}trigger(t,i){const n=We(this,Pe,"f").get(t);return Array.isArray(n)?(n.forEach(o=>{o(i)}),!0):!1}has(t){if(We(this,Pe,"f").has(t)){const i=We(this,Pe,"f").get(t);if(Array.isArray(i)&&i.length>0)return!0}return!1}destroy(){this.clear()}clear(){We(this,Pe,"f").clear()}}Pe=new WeakMap;function es(e,t){const i=(e.x-t.x)*(e.x-t.x)+(e.y-t.y)*(e.y-t.y);return i===0?i:Math.sqrt(i)}function rc(e,t){return es(e,t)/Math.abs(t.t-e.t)}function _r(e,t){return e.x===t.x&&e.y===t.y&&e.t===t.t}function ac(e,t){return _r(e,t)===!0&&e.f===t.f}function qn(e){return e>=0||e<0}function Or(e){return qn(e.x)&&qn(e.y)&&e.t>0}function lc(e){return Or(e)===!0&&e.f>=0}function ue(e,t){return{x:e.x+(t.x-e.x)/2,y:e.y+(t.y-e.y)/2}}var gi=function(e,t,i,n,o){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!o)throw new TypeError("Private accessor was defined without a setter");if(typeof t=="function"?e!==t||!o:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?o.call(e,i):o?o.value=i:t.set(e,i),i},ct=function(e,t,i,n){if(i==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof t=="function"?e!==t||!n:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return i==="m"?n:i==="a"?n.call(e):n?n.value:t.get(e)},Ri,He,Ui,Rn;class oi{constructor(t){Ri.add(this),He.set(this,void 0),Ui.set(this,void 0),gi(this,Ui,Vt(t.defaultStorage),"f"),gi(this,He,ct(this,Ri,"m",Rn).call(this),"f")}set(t,i){ct(this,He,"f")[t]=i}get(t){return ct(this,He,"f")[t]}getSnapshot(t){return(t==null?void 0:t.deepClone)===!0?Vt(ct(this,He,"f")):Object.assign({},ct(this,He,"f"))}clear(){gi(this,He,ct(this,Ri,"m",Rn).call(this),"f")}destroy(){gi(this,He,null,"f")}}He=new WeakMap,Ui=new WeakMap,Ri=new WeakSet,Rn=function(){return Vt(ct(this,Ui,"f"))};function ai(e){const{activeStore:t}=e;return{scale:t==null?void 0:t.scale,offsetTop:t==null?void 0:t.offsetTop,offsetBottom:t==null?void 0:t.offsetBottom,offsetLeft:t==null?void 0:t.offsetLeft,offsetRight:t==null?void 0:t.offsetRight}}function on(e){const{activeStore:t}=e;return{devicePixelRatio:t.devicePixelRatio,width:t==null?void 0:t.width,height:t==null?void 0:t.height,contextWidth:t==null?void 0:t.contextWidth,contextHeight:t==null?void 0:t.contextHeight}}function Wr(e){return e/Math.PI*180}function et(e){return e/180*Math.PI}function li(e,t,i,n){const o=et(t||0);i&&(o>0||o<0)&&(e.translate(i.x,i.y),e.rotate(o),e.translate(-i.x,-i.y)),n(e),i&&(o>0||o<0)&&(e.translate(i.x,i.y),e.rotate(-o),e.translate(-i.x,-i.y))}function Ye(e,t,i){const n=Fe(t);li(e,t.angle||0,n,()=>{i(e)})}function Fe(e){return{x:e.x+e.w/2,y:e.y+e.h/2}}function ts(e){const t=Math.min(e[0].x,e[1].x,e[2].x,e[3].x),i=Math.min(e[0].y,e[1].y,e[2].y,e[3].y),n=Math.max(e[0].x,e[1].x,e[2].x,e[3].x),o=Math.max(e[0].y,e[1].y,e[2].y,e[3].y),s={x:t,y:i,w:n-t,h:o-i};return Fe(s)}function kr(e,t,i){const n=Pn(e,t),o=Pn(e,i);return o!==null&&n!==null?n>Math.PI*3/2&&o<Math.PI/2?o+(Math.PI*2-n):o>Math.PI*3/2&&n<Math.PI/2?n+(Math.PI*2-o):o-n:0}function Pn(e,t){const i=t.x-e.x,n=t.y-e.y;if(i===0){if(n<0)return 0;if(n>0)return Math.PI}else if(n===0){if(i<0)return Math.PI*3/2;if(i>0)return Math.PI/2}return i>0&&n<0?Math.atan(Math.abs(i)/Math.abs(n)):i>0&&n>0?Math.PI-Math.atan(Math.abs(i)/Math.abs(n)):i<0&&n>0?Math.PI+Math.atan(Math.abs(i)/Math.abs(n)):i<0&&n<0?2*Math.PI-Math.atan(Math.abs(i)/Math.abs(n)):0}function le(e,t,i){let s=Pn(e,t)+i;s>Math.PI*2?s=s-Math.PI*2:s<0-Math.PI*2&&(s=s+Math.PI*2),s<0&&(s=s+Math.PI*2);const r=es(e,t);let a=0,c=0;return s===0?(a=0,c=0-r):s>0&&s<Math.PI/2?(a=Math.sin(s)*r,c=0-Math.cos(s)*r):s===Math.PI/2?(a=r,c=0):s>Math.PI/2&&s<Math.PI?(a=Math.sin(Math.PI-s)*r,c=Math.cos(Math.PI-s)*r):s===Math.PI?(a=0,c=r):s>Math.PI&&s<3/2*Math.PI?(a=0-Math.sin(s-Math.PI)*r,c=Math.cos(s-Math.PI)*r):s===3/2*Math.PI?(a=0-r,c=0):s>3/2*Math.PI&&s<2*Math.PI?(a=0-Math.sin(2*Math.PI-s)*r,c=0-Math.cos(2*Math.PI-s)*r):s===2*Math.PI&&(a=0,c=0-r),a+=e.x,c+=e.y,{x:a,y:c}}function $i(e,t){if((t==null?void 0:t.length)>0){let i=e.x,n=e.y;return t.forEach(o=>{const{x:s,y:r,w:a,h:c,angle:l=0}=o,d=Fe({x:s,y:r,w:a,h:c,angle:l}),f=le(d,{x:i,y:n},et(l));i=f.x,n=f.y}),{x:i,y:n}}return e}function is(e,t,i){const{x:n,y:o,w:s,h:r}=e;let a={x:n,y:o},c={x:n+s,y:o},l={x:n+s,y:o+r},d={x:n,y:o+r};if(i&&(i>0||i<0)){const f=et(Be(i));a=le(t,a,f),c=le(t,c,f),l=le(t,l,f),d=le(t,d,f)}return[a,c,l,d]}function wt(e){const{angle:t=0}=e,i=Fe(e);return is(e,i,t)}function eo(e,t,i){return[le(e,{x:t[0].x,y:t[0].y},i),le(e,{x:t[1].x,y:t[1].y},i),le(e,{x:t[2].x,y:t[2].y},i),le(e,{x:t[3].x,y:t[3].y},i)]}function Be(e){if(!(e>0||e<0)||e===0)return 0;let t=e%360;return t<0&&(t+=360),t}function jr(e,t){var i;const n=[];if(typeof t=="string"&&/^\d+(\.\d+)*$/.test(t)){const o=t.split(".");let s=e;for(;o.length>0;){const r=o.shift();if(typeof r=="string"){const a=s[parseInt(r)];a&&o.length===0?n.push(a.uuid):a.type==="group"&&o.length>0&&(s=((i=a==null?void 0:a.detail)===null||i===void 0?void 0:i.children)||[])}break}}return n}function cc(e,t){var i;let n=[];return Array.isArray(e==null?void 0:e.elements)&&((i=e==null?void 0:e.elements)===null||i===void 0?void 0:i.length)>0&&Array.isArray(t)&&t.length>0&&t.forEach(o=>{var s;typeof o=="number"?!((s=e==null?void 0:e.elements)===null||s===void 0)&&s[o]&&n.push(e.elements[o].uuid):typeof o=="string"&&(n=n.concat(jr(e.elements,o)))}),n}function ns(e){let t=!0;if(Array.isArray(e)){const i=[];e.forEach(n=>{var o;typeof n.uuid=="string"&&n.uuid?i.includes(n.uuid)?(t=!1,console.warn(`Duplicate uuids: ${n.uuid}`)):i.push(n.uuid):(t=!1,console.warn("Element missing uuid",n)),n.type==="group"&&(t=ns((o=n==null?void 0:n.detail)===null||o===void 0?void 0:o.children))})}return t}function Vr(e){var t;const i={x:0,y:0,w:0,h:0};let n=null;for(let s=0;s<e.length;s++){const r=e[s];if(!((t=r==null?void 0:r.operations)===null||t===void 0)&&t.invisible)continue;const a={x:r.x,y:r.y,w:r.w,h:r.h,angle:r.angle||0};if(a.angle&&(a.angle>0||a.angle<0)){const c=wt(a);if(c.length===4){const l=[c[0].x,c[1].x,c[2].x,c[3].x],d=[c[0].y,c[1].y,c[2].y,c[3].y];a.x=Math.min(...l),a.y=Math.min(...d),a.w=Math.abs(Math.max(...l)-Math.min(...l)),a.h=Math.abs(Math.max(...d)-Math.min(...d))}}if(n){const c=Math.min(a.x,i.x),l=Math.min(a.y,i.y),d=Math.max(a.x+a.w,i.x+i.w),f=Math.max(a.y+a.h,i.y+i.h);i.x=c,i.y=l,i.w=Math.abs(d-c),i.h=Math.abs(f-l)}else i.x=a.x,i.y=a.y,i.w=a.w,i.h=a.h;n=a}return{x:Math.floor(i.x),y:Math.floor(i.y),w:Math.ceil(i.w),h:Math.ceil(i.h)}}function os(e,t){const i={x:0,y:0,w:0,h:0};e.forEach(o=>{const s={x:o.x,y:o.y,w:o.w,h:o.h,angle:o.angle};if(s.angle&&(s.angle>0||s.angle<0)){const d=wt(s);if(d.length===4){const f=[d[0].x,d[1].x,d[2].x,d[3].x],u=[d[0].y,d[1].y,d[2].y,d[3].y];s.x=Math.min(...f),s.y=Math.min(...u),s.w=Math.abs(Math.max(...f)-Math.min(...f)),s.h=Math.abs(Math.max(...u)-Math.min(...u))}}const r=Math.min(s.x,i.x),a=Math.min(s.y,i.y),c=Math.max(s.x+s.w,i.x+i.w),l=Math.max(s.y+s.h,i.y+i.h);i.x=r,i.y=a,i.w=Math.abs(c-r),i.h=Math.abs(l-a)}),t!=null&&t.extend&&(i.x=Math.min(i.x,0),i.y=Math.min(i.y,0));const n={contextWidth:i.w,contextHeight:i.h};return t!=null&&t.viewWidth&&(t!=null&&t.viewHeight)&&(t==null?void 0:t.viewWidth)>0&&(t==null?void 0:t.viewHeight)>0&&(t.viewWidth>i.x+i.w&&(n.contextWidth=t.viewWidth-i.x),t.viewHeight>i.y+i.h&&(n.contextHeight=t.viewHeight-i.y)),n}function Br(e,t,i){const n=os(e,{viewWidth:t.width,viewHeight:t.height,extend:i==null?void 0:i.extend});return(i==null?void 0:i.extend)===!0&&(n.contextWidth=Math.max(n.contextWidth,t.contextWidth),n.contextHeight=Math.max(n.contextHeight,t.contextHeight)),{contextSize:n}}function dc(e){const t=[],i=n=>{n.forEach(o=>{o.type==="image"&&vt(o.detail.src)?t.push(o.detail.src):o.type==="svg"&&vt(o.detail.svg)?t.push(o.detail.svg):o.type==="html"&&o.detail.html?t.push(o.detail.html):o.type==="group"&&Array.isArray(o.detail.children)&&i(o.detail.children)})};return i(e),t}function Yr(e,t){var i;let n=null;for(let o=0;o<t.length;o++){const s=t[o];if(s.uuid===e){n=s;break}else if(!n&&s.type==="group"){const r=Yr(e,((i=s==null?void 0:s.detail)===null||i===void 0?void 0:i.children)||[]);if((r==null?void 0:r.uuid)===e){n=r;break}}}return n}function Fr(e,t){const i=[];function n(o){var s;for(let r=0;r<o.length;r++){const a=o[r];e.includes(a.uuid)?i.push(a):a.type==="group"&&n(((s=a==null?void 0:a.detail)===null||s===void 0?void 0:s.children)||[])}}return n(t),i}function Gr(e,t){const i=[];function n(o,s){var r;let a=null;for(let c=0;c<s.length;c++){const l=s[c];if(l.uuid===o){a=l;break}else if(!a&&l.type==="group"){i.push(l);const d=n(o,((r=l==null?void 0:l.detail)===null||r===void 0?void 0:r.children)||[]);if((d==null?void 0:d.uuid)===o){a=d;break}i.pop()}}return a}return n(e,t),i}function ss(e,t){var i;const n=[];let o=e;if(t.length>1)for(let s=0;s<t.length-1;s++){const r=t[s],a=o[r];if((a==null?void 0:a.type)==="group"&&Array.isArray((i=a==null?void 0:a.detail)===null||i===void 0?void 0:i.children))n.push(a),o=a.detail.children;else return null}return n}function fc(e){const{x:t,y:i,w:n,h:o,angle:s}=e;return{x:t,y:i,w:n,h:o,angle:s}}function hc(e,t){const i=e;let n=null,o=null;return i.type==="image"?n=i.detail.src:i.type==="svg"?n=i.detail.svg:i.type==="html"&&(n=i.detail.html),n&&(n!=null&&n.startsWith("@assets/"))&&(o=t[n]),(o==null?void 0:o.type)===i.type&&typeof(o==null?void 0:o.value)=="string"&&(o!=null&&o.value)&&(i.type==="image"?i.detail.src=o.value:i.type==="svg"?i.detail.svg=o.value:i.type==="html"&&(i.detail.html=o.value)),i}function uc(e){let t=null,i=null,n=null;return e.type==="image"?n=e.detail.src:e.type==="svg"?n=e.detail.svg:e.type==="html"&&(n=e.detail.html),typeof n=="string"&&!vt(n)&&(t=qe(n),i={type:e.type,value:n},e.type==="image"?e.detail.src=t:e.type==="svg"?e.detail.svg=t:e.type==="html"&&(e.detail.html=t)),{element:e,assetId:t,assetItem:i}}function gc(e){return["image","svg","html"].includes(e==null?void 0:e.type)}function Xr(e,t){const i=[];return e.forEach(n=>{const o=sn(n,t);o&&i.push(o)}),i}function sn(e,t){let i=null,n=t;for(let o=0;o<e.length;o++){const s=e[o],r=n[s];if(o<e.length-1&&r.type==="group")n=r.detail.children;else if(o===e.length-1)i=r;else break}return i}function vc(e,t){const i=[];let n=t;for(let o=0;o<e.length;o++){const s=e[o],r=n[s];if(r)i.push(r);else break;if(o<e.length-1&&r.type==="group")n=r.detail.children;else break}return i}function ei(e,t){const i=[];let n=!1;const o=s=>{var r;for(let a=0;a<s.length&&n!==!0;a++){i.push(a);const c=s[a];if(c.uuid===e){n=!0;break}else c.type==="group"&&o(((r=c==null?void 0:c.detail)===null||r===void 0?void 0:r.children)||[]);if(n)break;i.pop()}};return o(t),i}function Hr(e,t){const i=e.x,n=e.y,o=e.x+e.w,s=e.y+e.h,r=t.x,a=t.y,c=t.x+t.w,l=t.y+t.h;return i<=c&&o>=r&&n<=l&&s>=a}function rs(e){const{x:t,y:i,h:n,w:o}=e;return[{x:t,y:i},{x:t+o,y:i},{x:t+o,y:i+n},{x:t,y:i+n}]}function me(e){const{x:t,y:i,w:n,h:o,angle:s=0}=e;return s===0?rs(e):is(e,Fe({x:t,y:i,w:n,h:o,angle:s}),s)}function Gn(e){const t=[];let i=0,n=0;const o=[],s=[...e];for(let r=0;r<s.length;r++){const{x:a,y:c,w:l,h:d,angle:f=0}=s[r];i+=a,n+=c;let u;if(r===0){const v={x:i,y:n,w:l,h:d,angle:f};u=me({x:a,y:c,w:l,h:d,angle:f}),o.push({center:Fe(v),angle:f,radian:et(f)})}else{u=rs({x:i,y:n,w:l,h:d,angle:f});for(let h=0;h<o.length;h++){const{center:m,radian:p}=o[h];u=eo(m,u,p)}const g=ts(u);if(f>0||f<0){const h=et(f);u=eo(g,u,h)}o.push({center:g,angle:f,radian:et(f)})}t.push(u)}return t}function Nr(e,t){const{groupQueue:i}=t;if(!(i.length>0))return[me(e)];const n=[...i,e];return Gn(n)}function si(e,t){return Nr(e,t).pop()||null}function Ur(e,t){const{scale:i,offsetX:n,offsetY:o}=e,{viewSizeInfo:s}=t,{width:r,height:a,contextWidth:c,contextHeight:l}=s,d=c*i,f=l*i,u=0-n*i,v=0-o*i,g=r-(d+u/i),h=a-(f+v/i);return{scale:i,offsetLeft:u,offsetTop:v,offsetRight:g,offsetBottom:h}}function $r(e){const{scale:t,point:i,viewScaleInfo:n}=e,{offsetLeft:o,offsetTop:s}=n,r=t/n.scale,a=i.x,c=i.y,l=a-a*r+(o*r-o),d=c-c*r+(s*r-s);return{moveX:l,moveY:d}}function Qr(e){const{moveX:t=0,moveY:i=0,viewScaleInfo:n,viewSizeInfo:o}=e,{scale:s}=n,{width:r,height:a,contextWidth:c,contextHeight:l}=o;let d=n.offsetLeft,f=n.offsetRight,u=n.offsetTop,v=n.offsetBottom;d+=t,u+=i;const g=c*s,h=l*s;return f=r-(g+d),v=a-(h+u),{scale:s,offsetTop:u,offsetLeft:d,offsetRight:f,offsetBottom:v}}function Ie(e,t){const{viewScaleInfo:i}=t,{x:n,y:o,w:s,h:r,angle:a}=e,{scale:c,offsetTop:l,offsetLeft:d}=i;return{x:n*c+d,y:o*c+l,w:s*c,h:r*c,angle:a}}function N(e,t){const{viewScaleInfo:i}=t,{x:n,y:o}=e,{scale:s,offsetTop:r,offsetLeft:a}=i;return{x:n*s+a,y:o*s+r}}function xe(e,t){return[N(e[0],t),N(e[1],t),N(e[2],t),N(e[3],t)]}function zn(e,t){const{context2d:i,element:n,viewScaleInfo:o}=t,{angle:s=0}=n,{x:r,y:a,w:c,h:l}=Ie(n,{viewScaleInfo:o}),d=wt({x:r,y:a,w:c,h:l,angle:s});if(d.length>=2){i.beginPath(),i.moveTo(d[0].x,d[0].y);for(let f=1;f<d.length;f++)i.lineTo(d[f].x,d[f].y);i.closePath()}return!!i.isPointInPath(e.x,e.y)}function Zr(e,t,i){const n=[t[0].x,t[1].x,t[2].x,t[3].x],o=[t[0].y,t[1].y,t[2].y,t[3].y],s=Math.min(...n),r=Math.max(...n),a=Math.min(...o),c=Math.max(...o);return e.x>s&&e.x<r&&e.y>a&&e.y<c}function Jr(e,t){var i,n,o;const{context2d:s,data:r,viewScaleInfo:a,viewSizeInfo:c,groupQueue:l}=t,d={index:-1,element:null,groupQueueIndex:-1};if(l&&Array.isArray(l)&&(l==null?void 0:l.length)>0)for(let f=l.length-1;f>=0;f--){let u=0,v=0,g=0;for(let m=0;m<=f;m++)u+=l[m].x,v+=l[m].y,g+=l[m].angle||0;const h=l[f];if(h&&h.type==="group"&&Array.isArray((i=h.detail)===null||i===void 0?void 0:i.children))for(let m=0;m<h.detail.children.length;m++){const p=h.detail.children[m];if(((n=p==null?void 0:p.operations)===null||n===void 0?void 0:n.invisible)!==!0)if(p){const M={x:u+p.x,y:v+p.y,w:p.w,h:p.h,angle:g+(p.angle||0)};if(zn(e,{context2d:s,element:M,viewScaleInfo:a,viewSizeInfo:c})){d.element=p,(f<l.length-1||p.type!=="group")&&(d.groupQueueIndex=f);break}}else break}if(d.element)break}if(d.element)return d;for(let f=r.elements.length-1;f>=0;f--){const u=r.elements[f];if(((o=u==null?void 0:u.operations)===null||o===void 0?void 0:o.invisible)!==!0&&zn(e,{context2d:s,element:u,viewScaleInfo:a,viewSizeInfo:c})){d.index=f,d.element=u;break}}return d}function mc(e,t){const{viewSizeInfo:i,viewScaleInfo:n}=t,{width:o,height:s}=i,{angle:r}=e,{x:a,y:c,w:l,h:d}=Ie(e,{viewScaleInfo:n}),f=wt({x:a,y:c,w:l,h:d,angle:r}),u={x:0,y:0,w:o,h:s},v=Math.min(f[0].x,f[1].x,f[2].x,f[3].x),g=Math.min(f[0].y,f[1].y,f[2].y,f[3].y),h=Math.max(f[0].x,f[1].x,f[2].x,f[3].x),m=Math.max(f[0].y,f[1].y,f[2].y,f[3].y),p={x:v,y:g,w:h-v,h:m-g};return Hr(u,p)}function rn(e,t){const{groupQueue:i}=t,n=si(e,{groupQueue:i}),o=ue(n[0],n[1]),s=ue(n[1],n[2]),r=ue(n[2],n[3]),a=ue(n[3],n[0]),c=n[0],l=n[1],d=n[2],f=n[3],u=Math.max(c.x,l.x,d.x,f.x),v=Math.max(c.y,l.y,d.y,f.y),g=Math.min(c.x,l.x,d.x,f.x),h=Math.min(c.y,l.y,d.y,f.y);return{center:{x:(u+g)/2,y:(v+h)/2},topLeft:c,topRight:l,bottomLeft:f,bottomRight:d,top:o,right:s,left:a,bottom:r}}function as(e){const t=Math.max(e.topLeft.x,e.topRight.x,e.bottomRight.x,e.bottomLeft.x),i=Math.max(e.topLeft.y,e.topRight.y,e.bottomRight.y,e.bottomLeft.y),n=Math.min(e.topLeft.x,e.topRight.x,e.bottomRight.x,e.bottomLeft.x),o=Math.min(e.topLeft.y,e.topRight.y,e.bottomRight.y,e.bottomLeft.y),s={x:e.center.x,y:e.center.y},r={x:n,y:o},a={x:t,y:o},c={x:t,y:i},l={x:n,y:i},d=ue(r,a),f=ue(l,c),u=ue(r,l),v=ue(a,c);return{center:s,topLeft:r,topRight:a,bottomLeft:l,bottomRight:c,top:d,right:v,left:u,bottom:f}}function yc(e,t){const{groupQueue:i,viewScaleInfo:n,range:o}=t,s=rn(e,{groupQueue:i}),{center:r,top:a,bottom:c,left:l,right:d,topLeft:f,topRight:u,bottomLeft:v,bottomRight:g}=s,h={center:N(r,{viewScaleInfo:n}),topLeft:N(f,{viewScaleInfo:n}),topRight:N(u,{viewScaleInfo:n}),bottomLeft:N(v,{viewScaleInfo:n}),bottomRight:N(g,{viewScaleInfo:n}),top:N(a,{viewScaleInfo:n}),right:N(d,{viewScaleInfo:n}),left:N(l,{viewScaleInfo:n}),bottom:N(c,{viewScaleInfo:n})};if(o===!0){const m=Math.max(h.topLeft.x,h.topRight.x,h.bottomRight.x,h.bottomLeft.x),p=Math.max(h.topLeft.y,h.topRight.y,h.bottomRight.y,h.bottomLeft.y),M=Math.min(h.topLeft.x,h.topRight.x,h.bottomRight.x,h.bottomLeft.x),w=Math.min(h.topLeft.y,h.topRight.y,h.bottomRight.y,h.bottomLeft.y),y={x:h.center.x,y:h.center.y},A={x:M,y:w},b={x:m,y:w},S={x:m,y:p},R={x:M,y:p},j=ue(A,b),O=ue(R,S),W=ue(A,R),_=ue(b,S);return{center:y,topLeft:A,topRight:b,bottomLeft:R,bottomRight:S,top:j,right:_,left:W,bottom:O}}return h}function wc(e,t){const{groupQueue:i,viewScaleInfo:n}=t,o=rn(e,{groupQueue:i}),{center:s,top:r,bottom:a,left:c,right:l,topLeft:d,topRight:f,bottomLeft:u,bottomRight:v}=o,g={center:N(s,{viewScaleInfo:n}),topLeft:N(d,{viewScaleInfo:n}),topRight:N(f,{viewScaleInfo:n}),bottomLeft:N(u,{viewScaleInfo:n}),bottomRight:N(v,{viewScaleInfo:n}),top:N(r,{viewScaleInfo:n}),right:N(l,{viewScaleInfo:n}),left:N(c,{viewScaleInfo:n}),bottom:N(a,{viewScaleInfo:n})},h=Math.max(g.topLeft.x,g.topRight.x,g.bottomRight.x,g.bottomLeft.x),m=Math.max(g.topLeft.y,g.topRight.y,g.bottomRight.y,g.bottomLeft.y),p=Math.min(g.topLeft.x,g.topRight.x,g.bottomRight.x,g.bottomLeft.x),M=Math.min(g.topLeft.y,g.topRight.y,g.bottomRight.y,g.bottomLeft.y),w={x:g.center.x,y:g.center.y},y={x:p,y:M},A={x:h,y:M},b={x:h,y:m},S={x:p,y:m},R=ue(y,A),j=ue(S,b),O=ue(y,S),W=ue(A,b);return{originRectInfo:o,rangeRectInfo:{center:w,topLeft:y,topRight:A,bottomLeft:S,bottomRight:b,top:R,right:W,left:O,bottom:j}}}function Kr(e,t){const i={},n=[],o=s=>{const r={isVisibleInView:!0,isGroup:s.type==="group",position:[...n]};let a=null;const c=ss(e,n);a=rn(s,{groupQueue:c||[]}),i[s.uuid]=Object.assign(Object.assign({},r),{originRectInfo:a,rangeRectInfo:J.angle(s.angle)?as(a):a}),s.type==="group"&&s.detail.children.forEach((l,d)=>{n.push(d),o(l),n.pop()})};return e.forEach((s,r)=>{n.push(r),o(s),n.pop()}),ls(i,t)}function qr(e,t){const i=Math.min(e.topLeft.x,e.topRight.x,e.bottomLeft.x,e.bottomRight.x),n=Math.max(e.topLeft.x,e.topRight.x,e.bottomLeft.x,e.bottomRight.x),o=Math.min(e.topLeft.y,e.topRight.y,e.bottomLeft.y,e.bottomRight.y),s=Math.max(e.topLeft.y,e.topRight.y,e.bottomLeft.y,e.bottomRight.y),r=Math.min(t.topLeft.x,t.topRight.x,t.bottomLeft.x,t.bottomRight.x),a=Math.max(t.topLeft.x,t.topRight.x,t.bottomLeft.x,t.bottomRight.x),c=Math.min(t.topLeft.y,t.topRight.y,t.bottomLeft.y,t.bottomRight.y),l=Math.max(t.topLeft.y,t.topRight.y,t.bottomLeft.y,t.bottomRight.y);return i<=a&&n>=r&&o<=l&&s>=c||a<=s&&a>=s&&a<=s&&a>=s}function ls(e,t){const i=ea(t);let n=0,o=0;return Object.keys(e).forEach(s=>{const r=e[s];r.isVisibleInView=qr(r.rangeRectInfo,i),r.isVisibleInView?n++:o++}),{viewVisibleInfoMap:e,visibleCount:n,invisibleCount:o}}function ea(e){const{viewScaleInfo:t,viewSizeInfo:i}=e,{scale:n,offsetTop:o,offsetLeft:s}=t,{width:r,height:a}=i,c=0-s/n,l=0-o/n,d=r/n,f=a/n,u=Fe({x:c,y:l,w:d,h:f}),v={x:c,y:l},g={x:c+d,y:l},h={x:c,y:l+f},m={x:c+d,y:l+f},p={x:c,y:u.y},M={x:u.x,y:l},w={x:c+d,y:u.y},y={x:u.x,y:l+f};return{center:u,topLeft:v,topRight:g,bottomLeft:h,bottomRight:m,left:p,top:M,right:w,bottom:y}}function pe(e,t){const{x:i,y:n}=e,{size:o,angle:s}=t;return{x:i-o/2,y:n-o/2,w:o,h:o,angle:s}}function vi(e,t){const{groupQueue:i,controllerSize:n,viewScaleInfo:o}=t,s=(n&&n>0?n:8)/o.scale,{x:r,y:a,w:c,h:l,angle:d=0}=e,f=[{uuid:gt(),x:r,y:a,w:c,h:l,angle:d,type:"group",detail:{children:[]}},...i];let u=0;f.forEach(({angle:Ge=0})=>{u+=Ge});const v=si(e,{groupQueue:i}),g=si({x:r-s*2,y:a-s*2,h:l+s*4,w:c+s*4,angle:d},{groupQueue:[...i]}),h=ue(v[0],v[1]),m=ue(v[1],v[2]),p=ue(v[2],v[3]),M=ue(v[3],v[0]),w=v[0],y=v[1],A=v[2],b=v[3],S=pe(h,{size:s,angle:u}),R=pe(m,{size:s,angle:u}),j=pe(p,{size:s,angle:u}),O=pe(M,{size:s,angle:u}),W=pe(w,{size:s,angle:u}),_=pe(y,{size:s,angle:u}),k=pe(b,{size:s,angle:u}),U=pe(A,{size:s,angle:u}),K=me(W),L=me(_),T=me(k),Y=me(U),E=[K[1],L[0],L[3],K[2]],$=[L[3],L[2],Y[1],Y[0]],G=[T[1],Y[0],Y[3],T[2]],x=[K[3],K[2],T[1],T[0]],Z=me(S),Q=me(R),P=me(j),z=me(O),I=ue(g[0],g[1]),C=pe(I,{size:s,angle:u}),H=me(C);return{elementWrapper:v,left:{type:"left",vertexes:x,center:M},right:{type:"right",vertexes:$,center:m},top:{type:"top",vertexes:E,center:h},bottom:{type:"bottom",vertexes:G,center:p},topLeft:{type:"top-left",vertexes:K,center:w},topRight:{type:"top-right",vertexes:L,center:y},bottomLeft:{type:"bottom-left",vertexes:T,center:b},bottomRight:{type:"bottom-right",vertexes:Y,center:A},leftMiddle:{type:"left-middle",vertexes:z,center:M},rightMiddle:{type:"right-middle",vertexes:Q,center:m},topMiddle:{type:"top-middle",vertexes:Z,center:h},bottomMiddle:{type:"bottom-middle",vertexes:P,center:p},rotate:{type:"rotate",vertexes:H,center:I}}}function to(e,t){const{controllerSize:i,viewScaleInfo:n}=t,o=i&&i>0?i:8,{x:s,y:r,w:a,h:c}=Ie(e,{viewScaleInfo:n}),l=Fe({x:s,y:r,w:a,h:c}),d={x:l.x,y:r},f={x:s+a,y:l.y},u={x:l.x,y:r+c},v={x:s,y:l.y},g={x:s,y:r},h={x:s+a,y:r},m={x:s+a,y:r+c},p={x:s,y:r+c},M=pe(d,{size:o,angle:0}),w=pe(f,{size:o,angle:0}),y=pe(u,{size:o,angle:0}),A=pe(v,{size:o,angle:0}),b=pe(g,{size:o,angle:0}),S=pe(h,{size:o,angle:0}),R=pe(p,{size:o,angle:0}),j=pe(m,{size:o,angle:0}),O=me(b),W=me(S),_=me(R),k=me(j),U=[O[1],W[0],W[3],O[2]],K=[W[3],W[2],k[1],k[0]],L=[_[1],k[0],k[3],_[2]],T=[O[3],O[2],_[1],_[0]],Y=me(M),E=me(w),$=me(y),G=me(A);return{left:{type:"left",vertexes:T,center:v},right:{type:"right",vertexes:K,center:f},top:{type:"top",vertexes:U,center:d},bottom:{type:"bottom",vertexes:L,center:u},topLeft:{type:"top-left",vertexes:O,center:g},topRight:{type:"top-right",vertexes:W,center:h},bottomLeft:{type:"bottom-left",vertexes:_,center:p},bottomRight:{type:"bottom-right",vertexes:k,center:m},leftMiddle:{type:"left-middle",vertexes:G,center:v},rightMiddle:{type:"right-middle",vertexes:E,center:f},topMiddle:{type:"top-middle",vertexes:Y,center:d},bottomMiddle:{type:"bottom-middle",vertexes:$,center:u}}}const ta=/([astvzqmhlc])([^astvzqmhlc]*)/gi,ia=/(-?\d+(?:\.\d+)?)/gi;function pc(e){const t=[];return e.replace(ta,(i,n,o)=>{const s=o.match(ia),r=s?s.map(Number):[],a={type:n,params:r};return t.push(a),i}),t}function Xn(e){let t="";return e.forEach(i=>{t+=i.type+i.params.join(" ")}),t}const na=/\s([^'"/\s><]+?)[\s/>]|([^\s=]+)=\s?(".*?"|'.*?')/g,oa=/<[a-zA-Z0-9\-\!\/](?:"[^"]*"|'[^']*'|[^'">])*>/g,sa=/^\s*$/,ra={};function io(e){const t={type:"element",name:"",isVoid:!1,attributes:{},children:[]},i=e.match(/<\/?([^\s]+?)[/\s>]/);if(i&&(t.name=i[1],(ra[i[1]]||e.charAt(e.length-2)==="/")&&(t.isVoid=!0),t.name.startsWith("!--"))){const s=e.indexOf("-->");return{type:"comment",name:null,attributes:{},children:[],isVoid:!1,comment:s!==-1?e.slice(4,s):""}}const n=new RegExp(na);let o=null;for(;o=n.exec(e),o!==null;)if(o[0].trim())if(o[1]){const s=o[1].trim();let r=[s,""];s.indexOf("=")>-1&&(r=s.split("=")),t.attributes[r[0]]=r[1],n.lastIndex--}else o[2]&&(t.attributes[o[2]]=o[3].trim().substring(1,o[3].length-1));return t}function bc(e){const t=[],i=[];let n,o=-1,s=!1;return e.replace(oa,(r,a)=>{const c=r.charAt(1)!=="/",l=r.startsWith("<!--"),d=a+r.length,f=e.charAt(d);let u;if(l){const v=io(r);return o<0?(t.push(v),r):(u=i[o],u.children.push(v),r)}if(c){if(o++,n=io(r),!n.isVoid&&!s&&f&&f!=="<"){const v=e.slice(d,e.indexOf("<",d));v.trim()&&n.children.push({type:"text",name:null,attributes:{},children:[],isVoid:!1,textContent:v.trim()})}o===0&&t.push(n),u=i[o-1],u&&u.children.push(n),i[o]=n}if((!c||!Array.isArray(n)&&n.isVoid)&&(o>-1&&!Array.isArray(n)&&(n.isVoid||n.name===r.slice(2,-1))&&(o--,n=o===-1?t:i[o]),f!=="<"&&f)){u=o===-1?t:i[o].children;const v=e.indexOf("<",d);let g=e.slice(d,v===-1?void 0:v);sa.test(g)&&(g=" "),(v>-1&&o+u.length>=0||g!==" ")&&g.trim()&&u.push({type:"text",name:null,attributes:{},children:[],isVoid:!1,textContent:g.trim()})}return r}),t}function aa(e){const t=[];for(let i in e)t.push(i+'="'+e[i]+'"');return t.length?" "+t.join(" "):""}function cs(e,t){switch(t.type){case"text":return e+t.textContent;case"element":return e+="<"+t.name+(t.attributes?aa(t.attributes):"")+(t.isVoid?"/>":">"),t.isVoid?e:e+t.children.reduce(cs,"")+"</"+t.name+">";case"comment":return e+="<!--"+t.comment+"-->",e}}function Sc(e){return e.reduce(function(t,i){return t+cs("",i)},"")}function Mc(e,t){let i=.5;const n=(t==null?void 0:t.type)||"image/png";return t!=null&&t.radio&&(t==null?void 0:t.radio)>0&&(t==null?void 0:t.radio)<=1&&(i=t==null?void 0:t.radio),new Promise((o,s)=>{const r=new Image;r.addEventListener("load",()=>{const{width:a,height:c}=r,l=a*i,d=c*i;let f=document.createElement("canvas");f.width=l,f.height=d,f.getContext("2d").drawImage(r,0,0,l,d);const v=f.toDataURL(n);f=null,o(v)}),r.addEventListener("error",a=>{s(a)}),r.src=e})}function ye(e,t){let i=2;return typeof(t==null?void 0:t.decimalPlaces)<"u"&&(t==null?void 0:t.decimalPlaces)>=0&&(i=t.decimalPlaces),parseFloat(e.toFixed(i))}function la(e){return e[1]!=-1*e[3]||e[4]!=e[0]||e[0]*e[4]-e[3]*e[1]!=1?null:Math.acos(e[0])}function xc(e){const t=la(e);return typeof t=="number"?t*180/Math.PI:t}const Pi="Text Element";function Bt(){return{boxSizing:"border-box",borderWidth:0,borderColor:"#000000",shadowColor:"#000000",borderRadius:0,borderDash:[],shadowOffsetX:0,shadowOffsetY:0,shadowBlur:0,opacity:1,color:"#000000",textAlign:"left",verticalAlign:"top",fontSize:16,fontFamily:"sans-serif",fontWeight:400,minInlineSize:"auto",wordBreak:"break-all",overflow:"hidden"}}function ca(){return{background:"#D9D9D9"}}function da(){return{background:"#D9D9D9",radius:0}}function fa(e){const t=Bt();return{text:Pi,color:t.color,fontFamily:t.fontFamily,fontWeight:t.fontWeight,lineHeight:e.w/Pi.length,fontSize:e.w/Pi.length,textAlign:"center",verticalAlign:"middle"}}function ha(){return{svg:'<svg t="1701004189871" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg"   width="200" height="200"><path d="M908.1 353.1l-253.9-36.9L540.7 86.1c-3.1-6.3-8.2-11.4-14.5-14.5-15.8-7.8-35-1.3-42.9 14.5L369.8 316.2l-253.9 36.9c-7 1-13.4 4.3-18.3 9.3-12.3 12.7-12.1 32.9 0.6 45.3l183.7 179.1-43.4 252.9c-1.2 6.9-0.1 14.1 3.2 20.3 8.2 15.6 27.6 21.7 43.2 13.4L512 754l227.1 119.4c6.2 3.3 13.4 4.4 20.3 3.2 17.4-3 29.1-19.5 26.1-36.9l-43.4-252.9 183.7-179.1c5-4.9 8.3-11.3 9.3-18.3 2.7-17.5-9.5-33.7-27-36.3zM664.8 561.6l36.1 210.3L512 672.7 323.1 772l36.1-210.3-152.8-149L417.6 382 512 190.7 606.4 382l211.2 30.7-152.8 148.9z"   fill="#2c2c2c"></path></svg>'}}function ua(){return{src:"data:image/svg+xml;base64,PHN2ZyAgIHZpZXdCb3g9IjAgMCAxMDI0IDEwMjQiIHZlcnNpb249IjEuMSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiAgd2lkdGg9IjIwMCIgaGVpZ2h0PSIyMDAiPjxwYXRoIGQ9Ik05MjggMTYwSDk2Yy0xNy43IDAtMzIgMTQuMy0zMiAzMnY2NDBjMCAxNy43IDE0LjMgMzIgMzIgMzJoODMyYzE3LjcgMCAzMi0xNC4zIDMyLTMyVjE5MmMwLTE3LjctMTQuMy0zMi0zMi0zMnogbS00MCA2MzJIMTM2di0zOS45bDEzOC41LTE2NC4zIDE1MC4xIDE3OEw2NTguMSA0ODkgODg4IDc2MS42Vjc5MnogbTAtMTI5LjhMNjY0LjIgMzk2LjhjLTMuMi0zLjgtOS0zLjgtMTIuMiAwTDQyNC42IDY2Ni40bC0xNDQtMTcwLjdjLTMuMi0zLjgtOS0zLjgtMTIuMiAwTDEzNiA2NTIuN1YyMzJoNzUydjQzMC4yeiIgIGZpbGw9IiM1MTUxNTEiPjwvcGF0aD48cGF0aCBkPSJNMzA0IDQ1NmM0OC42IDAgODgtMzkuNCA4OC04OHMtMzkuNC04OC04OC04OC04OCAzOS40LTg4IDg4IDM5LjQgODggODggODh6IG0wLTExNmMxNS41IDAgMjggMTIuNSAyOCAyOHMtMTIuNSAyOC0yOCAyOC0yOC0xMi41LTI4LTI4IDEyLjUtMjggMjgtMjh6IiAgZmlsbD0iIzUxNTE1MSI+PC9wYXRoPjwvc3ZnPg=="}}function ga(){return{children:[],background:"#D9D9D9",overflow:"hidden"}}const va=Bt();function an(e,t){const{viewScaleInfo:i}=t,{scale:n}=i;let{borderRadius:o,borderDash:s}=e.detail;const r=Array.isArray(s)&&s.length>0,{boxSizing:a=va.boxSizing,borderWidth:c}=e.detail;Array.isArray(c)&&(o=0);let{x:l,y:d,w:f,h:u}=e,v=[0,0,0,0];if(typeof o=="number"){const h=o*n;v=[h,h,h,h]}else Array.isArray(o)&&(o==null?void 0:o.length)===4&&(v=[o[0]*n,o[1]*n,o[2]*n,o[3]*n]);let g=0;return typeof c=="number"&&(g=(c||0)*n),a==="border-box"&&!r?(l=e.x+g/2,d=e.y+g/2,f=e.w-g,u=e.h-g):a==="content-box"?(l=e.x-g/2,d=e.y-g/2,f=e.w+g,u=e.h+g):(l=e.x,d=e.y,f=e.w,u=e.h),f=Math.max(f,1),u=Math.max(u,1),v=v.map(h=>Math.min(h,f/2,u/2)),{x:l,y:d,w:f,h:u,radiusList:v}}const Me=e=>ye(e,{decimalPlaces:4});function ds(e,t){const{detail:i}=e,{xRatio:n,yRatio:o,maxRatio:s}=t,r=(n+o)/2,{borderWidth:a,borderRadius:c,borderDash:l,shadowOffsetX:d,shadowOffsetY:f,shadowBlur:u}=i;if(typeof a=="number")i.borderWidth=Me(a*r);else if(Array.isArray(i.borderWidth)){const v=a;i.borderWidth=[Me(v[0]*o),Me(v[1]*n),Me(v[2]*o),Me(v[3]*n)]}if(typeof c=="number")i.borderRadius=Me(c*r);else if(Array.isArray(i.borderRadius)){const v=c;i.borderRadius=[v[0]*n,v[1]*n,v[2]*o,v[3]*o]}Array.isArray(l)&&l.forEach((v,g)=>{i.borderDash[g]=Me(v*s)}),typeof d=="number"&&(i.shadowOffsetX=Me(d*s)),typeof f=="number"&&(i.shadowOffsetX=Me(f*s)),typeof u=="number"&&(i.shadowOffsetX=Me(u*s))}function ma(e,t){const{xRatio:i,yRatio:n}=t,{x:o,y:s,w:r,h:a}=e;e.x=Me(o*i),e.y=Me(s*n),e.w=Me(r*i),e.h=Me(a*n),ds(e,t)}function ya(e,t){const{minRatio:i,maxRatio:n}=t,{fontSize:o,lineHeight:s}=e.detail,r=(i+n)/2;o&&o>0&&(e.detail.fontSize=Me(o*r)),s&&s>0&&(e.detail.lineHeight=Me(s*r))}function fs(e,t){const{type:i}=e;ma(e,t),i==="circle"||(i==="text"?ya(e,t):i==="image"||i==="svg"||i==="html"||i==="path"||i==="group"&&Array.isArray(e.detail.children)&&e.detail.children.forEach(n=>{fs(n,t)}))}function Hn(e,t){const i=t.w&&t.w>0?t.w:e.w,n=t.h&&t.h>0?t.h:e.h,o=i/e.w,s=n/e.h;if(o===s&&o===1)return e;const r=Math.min(o,s),a=Math.max(o,s);e.w=i,e.h=n;const c={xRatio:o,yRatio:s,minRatio:r,maxRatio:a};return e.type==="group"&&Array.isArray(e.detail.children)&&e.detail.children.forEach(l=>{fs(l,c)}),ds(e,c),e}const fn=200,hn=200;function wa(e,t){let i=0,n=0,o=fn,s=hn;if(t){const{viewScaleInfo:a,viewSizeInfo:c}=t,{scale:l,offsetLeft:d,offsetTop:f}=a,{width:u,height:v}=c,g=u/4,h=v/4;fn>=g?o=g/l:o=fn/l,hn>=h?s=h/l:s=hn/l,["circle","svg","image"].includes(e)?o=s=Math.max(o,s):e==="text"&&(s=o/Pi.length*2),i=(0-d+u/2-o*l/2)/l,n=(0-f+v/2-s*l/2)/l}return{x:i,y:n,w:o,h:s}}function pa(e,t,i){const n=wa(e,i);let o={};return e==="rect"?o=ca():e==="circle"?o=da():e==="text"?o=fa(n):e==="svg"?o=ha():e==="image"?o=ua():e==="group"&&(o=ga()),Object.assign(Object.assign(Object.assign({},n),t),{uuid:gt(),type:e,detail:Object.assign(Object.assign({},o),t.detail||{})})}function Nn(e,t,i){let n=!1;if(t.length===1){const o=t[0];i.splice(o,0,e),n=!0}else if(t.length>1){let o=i;for(let s=0;s<t.length;s++){const r=t[s],a=o[r];if(s===t.length-1){const c=t[s];o.splice(c,0,e),n=!0}else if(s<t.length-1&&a.type==="group")o=a.detail.children;else break}}return n}function Un(e,t){let i=!1;if(e.length===1){const n=e[0];t.splice(n,1),i=!0}else if(e.length>1){let n=t;for(let o=0;o<e.length;o++){const s=e[o],r=n[s];if(o===e.length-1){const a=e[o];n.splice(a,1),i=!0}else if(o<e.length-1&&r.type==="group")n=r.detail.children;else break}}return i}function ba(e,t){const i=ei(e,t);return Un(i,t)}function hs(e,t){const i=[...t.from],n=[...t.to];if(i.length===0||n.length===0)return{elements:e,from:i,to:n};if(i.length<=n.length){for(let s=0;s<i.length;s++)if(n[s]===i[s]){if(s===i.length-1)return{elements:e,from:i,to:n};continue}}const o=sn(i,e);if(o){if(!Nn(o,n,e))return{elements:e,from:i,to:n};let r=-1;for(let a=0;a<i.length&&n[a]>=0;a++)n[a]!==i[a]&&n[a]<i[a]&&a==n.length-1&&(r=a);r>=0&&(i[r]=i[r]+1),Un(i,e)}return{elements:e,from:i,to:n}}function us(e,t){var i;const n=Object.keys(t);for(let o=0;o<n.length;o++){const s=n[o];["x","y","w","h","angle","name"].includes(s)?e[s]=t[s]:["detail","operations"].includes(s)&&(Ut.json(t[s])?(e!=null&&e.hasOwnProperty(s)||(e[s]={}),Ut.json(e[s])&&(e[s]=Object.assign(Object.assign({},e[s]),t[s]))):Ut.array(t[s])&&(e!=null&&e.hasOwnProperty(s)||(e[s]=[]),Ut.array(e[s])&&((i=t==null?void 0:t[s])===null||i===void 0||i.forEach((r,a)=>{e[s][a]=r}),e[s]=[...e[s],...t[s]])))}return e}function gs(e,t,i){var n,o;let s=null;for(let r=0;r<i.length;r++){const a=i[r];if(a.uuid===e){a.type==="group"&&((n=a.operations)===null||n===void 0?void 0:n.deepResize)===!0&&(t.w&&t.w>0||t.h&&t.h>0)&&Hn(a,{w:t.w,h:t.h}),us(a,t),s=a;break}else a.type==="group"&&(s=gs(e,t,((o=a==null?void 0:a.detail)===null||o===void 0?void 0:o.children)||[]))}return s}function Sa(e,t,i){var n;const o=sn(e,i);return o&&(o.type==="group"&&((n=o.operations)===null||n===void 0?void 0:n.deepResize)===!0&&(t.w&&t.w>0||t.h&&t.h>0)&&Hn(o,{w:t.w,h:t.h}),us(o,t)),o}function Ma(e,t){var i,n,o,s,r,a,c,l,d,f;let u=0,v=0,g=1,h=((n=(i=e==null?void 0:e.elements)===null||i===void 0?void 0:i[0])===null||n===void 0?void 0:n.x)||0,m=((s=(o=e==null?void 0:e.elements)===null||o===void 0?void 0:o[0])===null||s===void 0?void 0:s.y)||0,p=((a=(r=e==null?void 0:e.elements)===null||r===void 0?void 0:r[0])===null||a===void 0?void 0:a.w)||0,M=((l=(c=e==null?void 0:e.elements)===null||c===void 0?void 0:c[0])===null||l===void 0?void 0:l.h)||0;const{width:w,height:y}=t.viewSizeInfo;if(e.layout&&((f=(d=e.layout)===null||d===void 0?void 0:d.detail)===null||f===void 0?void 0:f.overflow)==="hidden"?(h=0,m=0,p=e.layout.w||0,M=e.layout.h||0):e.elements.forEach(b=>{const S={x:b.x,y:b.y,w:b.w,h:b.h,angle:b.angle};if(S.angle&&(S.angle>0||S.angle<0)){const _=wt(S);if(_.length===4){const k=[_[0].x,_[1].x,_[2].x,_[3].x],U=[_[0].y,_[1].y,_[2].y,_[3].y];S.x=Math.min(...k),S.y=Math.min(...U),S.w=Math.abs(Math.max(...k)-Math.min(...k)),S.h=Math.abs(Math.max(...U)-Math.min(...U))}}const R=Math.min(S.x,h),j=Math.min(S.y,m),O=Math.max(S.x+S.w,h+p),W=Math.max(S.y+S.h,m+M);h=R,m=j,p=Math.abs(O-R),M=Math.abs(W-j)}),e.layout){const{x:b,y:S,w:R,h:j}=e.layout;J.x(b)&&J.y(S)&&J.w(R)&&J.h(j)&&(h=Math.min(h,b),m=Math.min(m,S),p=Math.max(p,R),M=Math.max(M,j))}if(p>0&&M>0){const b=ye(w/p,{decimalPlaces:4}),S=ye(y/M,{decimalPlaces:4});g=Math.min(b,S,1),u=(p*g-w)/2/g+h,v=(M*g-y)/2/g+m}return{offsetX:ye(u,{decimalPlaces:0}),offsetY:ye(v,{decimalPlaces:0}),scale:g}}function xa(e){let t=0,i=0;if(e){const{viewScaleInfo:o,viewSizeInfo:s}=e,{offsetLeft:r,offsetTop:a,scale:c}=o,{width:l,height:d}=s;t=0-r+l/c/2,i=0-a+d/c/2}return{x:t,y:i}}function Ac(e,t){const{type:i}=t,n=Object.assign({},t.content);if(i==="addElement"){const o=t,{element:s,position:r}=o.content;(r==null?void 0:r.length)>0?Nn(s,[...r],e.elements):e.elements.push(s)}else if(i==="deleteElement"){const o=t,{position:s}=o.content;Un(s,e.elements)}else if(i==="moveElement"){const o=t,{from:s,to:r}=o.content,a=hs(e.elements,{from:s,to:r});n.from=a.from,n.to=a.to,e.elements=a.elements}else if(i==="updateElement"){const o=t,{position:s,afterModifiedElement:r}=o.content;Sa(s,r,e.elements)}return{data:e,content:n}}const Aa=["-apple-system",'"system-ui"',' "Segoe UI"'," Roboto",'"Helvetica Neue"',"Arial",'"Noto Sans"'," sans-serif"];function vs(e){return[e,...Aa].join(", ")}function Ln(e,t,i){if(typeof t=="string")return t;const{viewElementSize:n,viewScaleInfo:o,opacity:s=1}=i,{x:r,y:a}=n,{scale:c}=o;if((t==null?void 0:t.type)==="linear-gradient"){const{start:l,end:d,stops:f}=t,u={x:r+l.x*c,y:a+l.y*c},v={x:r+d.x*c,y:a+d.y*c},g=e.createLinearGradient(u.x,u.y,v.x,v.y);return f.forEach(h=>{g.addColorStop(h.offset,Kn(h.color,s))}),g}if((t==null?void 0:t.type)==="radial-gradient"){const{inner:l,outer:d,stops:f}=t,u={x:r+l.x*c,y:a+l.y*c,radius:l.radius*c},v={x:r+d.x*c,y:a+d.y*c,radius:d.radius*c},g=e.createRadialGradient(u.x,u.y,u.radius,v.x,v.y,v.radius);return f.forEach(h=>{g.addColorStop(h.offset,Kn(h.color,s))}),g}return"#000000"}const En=Bt();function mt(e){var t,i,n,o;let s=1;return((t=e==null?void 0:e.detail)===null||t===void 0?void 0:t.opacity)!==void 0&&((i=e==null?void 0:e.detail)===null||i===void 0?void 0:i.opacity)>=0&&((n=e==null?void 0:e.detail)===null||n===void 0?void 0:n.opacity)<=1&&(s=(o=e==null?void 0:e.detail)===null||o===void 0?void 0:o.opacity),s}function ci(e,t,i){const{pattern:n,renderContent:o,originElem:s,calcElemSize:r,viewScaleInfo:a,viewSizeInfo:c}=i||{},{parentOpacity:l}=i,d=mt(s)*l,{clipPath:f,clipPathStrokeColor:u,clipPathStrokeWidth:v}=s.detail,g=()=>{e.globalAlpha=d,ms(e,t,{pattern:n,viewScaleInfo:a,viewSizeInfo:c}),o==null||o(),ys(e,t,{viewScaleInfo:a,viewSizeInfo:c}),e.globalAlpha=l};f?(Ia(e,t,{originElem:s,calcElemSize:r,viewScaleInfo:a,viewSizeInfo:c,renderContent:()=>{g()}}),typeof v=="number"&&v>0&&u&&Ra(e,t,{originElem:s,calcElemSize:r,viewScaleInfo:a,viewSizeInfo:c,parentOpacity:l})):g()}function Ia(e,t,i){const{renderContent:n,originElem:o,calcElemSize:s,viewSizeInfo:r}=i,a=r.devicePixelRatio,{clipPath:c}=(o==null?void 0:o.detail)||{};if(c&&s&&c.commands){const{x:l,y:d,w:f,h:u}=s,{originW:v,originH:g,originX:h,originY:m}=c,p=f/v,M=u/g,w=h*p,y=m*M,A=l-w,b=d-y;e.save(),e.translate(A,b),e.scale(a*p,a*M);const S=Xn(c.commands||[]),R=new Path2D(S);e.clip(R),e.translate(0-A,0-b),e.setTransform(1,0,0,1,0,0),Ye(e,Object.assign({},t),()=>{n==null||n()}),e.restore()}else n==null||n()}function Ra(e,t,i){const{renderContent:n,originElem:o,calcElemSize:s,viewSizeInfo:r,parentOpacity:a}=i,c=r.devicePixelRatio,{clipPath:l,clipPathStrokeColor:d,clipPathStrokeWidth:f}=(o==null?void 0:o.detail)||{};if(l&&s&&l.commands&&typeof f=="number"&&f>0&&d){const{x:u,y:v,w:g,h}=s,{originW:m,originH:p,originX:M,originY:w}=l,y=g/m,A=h/p,b=M*y,S=w*A,R=u-b,j=v-S;e.save(),e.globalAlpha=a,e.translate(R,j),e.scale(c*y,c*A);const O=Xn(l.commands||[]),W=new Path2D(O);e.strokeStyle=d,e.lineWidth=f,e.stroke(W),e.translate(0-R,0-j),e.setTransform(1,0,0,1,0,0),Ye(e,Object.assign({},t),()=>{n==null||n()}),e.restore()}else n==null||n()}function ms(e,t,i){var n,o;const{pattern:s,viewScaleInfo:r,viewSizeInfo:a}=i,c=[];if(t.detail.background||s){const{x:l,y:d,w:f,h:u,radiusList:v}=an(t,{viewScaleInfo:r,viewSizeInfo:a});if(e.beginPath(),e.moveTo(l+v[0],d),e.arcTo(l+f,d,l+f,d+u,v[1]),e.arcTo(l+f,d+u,l,d+u,v[2]),e.arcTo(l,d+u,l,d,v[3]),e.arcTo(l,d,l+f,d,v[0]),e.closePath(),typeof s=="string")e.fillStyle=s;else if(["CanvasPattern"].includes(Ut.type(s)))e.fillStyle=s;else if(typeof t.detail.background=="string")e.fillStyle=t.detail.background;else if(((n=t.detail.background)===null||n===void 0?void 0:n.type)==="linear-gradient"){const g=Ln(e,t.detail.background,{viewElementSize:{x:l,y:d,w:f,h:u},viewScaleInfo:r,opacity:e.globalAlpha});e.fillStyle=g}else if(((o=t.detail.background)===null||o===void 0?void 0:o.type)==="radial-gradient"){const g=Ln(e,t.detail.background,{viewElementSize:{x:l,y:d,w:f,h:u},viewScaleInfo:r,opacity:e.globalAlpha});if(e.fillStyle=g,c&&c.length>0)for(let h=0;h<(c==null?void 0:c.length);h++){const m=c[h];m.method==="translate"?e.translate(m.args[0]+l,m.args[1]+d):m.method==="rotate"?e.rotate(...m.args):m.method==="scale"&&e.scale(...m.args)}}e.fill(),c&&c.length>0&&e.setTransform(1,0,0,1,0,0)}}function ys(e,t,i){if(t.detail.borderWidth===0||!Ni(t.detail.borderColor))return;const{viewScaleInfo:n}=i,{scale:o}=n;let s=En.borderColor;Ni(t.detail.borderColor)===!0&&(s=t.detail.borderColor);const{borderWidth:r,borderRadius:a,borderDash:c,boxSizing:l=En.boxSizing}=t.detail;let d=0;typeof r=="number"&&(d=r||1),d=d*o;let f=[0,0,0,0];if(typeof a=="number"){const p=a*o;f=[p,p,p,p]}else Array.isArray(a)&&(a==null?void 0:a.length)===4&&(f=[a[0]*o,a[1]*o,a[2]*o,a[3]*o]);e.strokeStyle=s;let u=[];Array.isArray(c)&&c.length>0&&(u=c.map(p=>Math.ceil(p*o)));let v=0,g=0,h=0,m=0;if(Array.isArray(r)&&(v=(r[0]||0)*o,g=(r[1]||0)*o,h=(r[2]||0)*o,m=(r[3]||0)*o),m||g||v||h){e.lineCap="butt";let{x:p,y:M,w,h:y}=t;l==="border-box"?(p=p+m/2,M=M+v/2,w=w-m/2-g/2,y=y-v/2-h/2):l==="content-box"?(p=p-m/2,M=M-v/2,w=w+m/2+g/2,y=y+v/2+h/2):(p=t.x,M=t.y,w=t.w,y=t.h),v&&(e.beginPath(),e.lineWidth=v,e.moveTo(p-m/2,M),e.lineTo(p+w+g/2,M),e.closePath(),e.stroke()),g&&(e.beginPath(),e.lineWidth=g,e.moveTo(p+w,M-v/2),e.lineTo(p+w,M+y+h/2),e.closePath(),e.stroke()),h&&(e.beginPath(),e.lineWidth=h,e.moveTo(p-m/2,M+y),e.lineTo(p+w+g/2,M+y),e.closePath(),e.stroke()),m&&(e.beginPath(),e.lineWidth=m,e.moveTo(p,M-v/2),e.lineTo(p,M+y+h/2),e.closePath(),e.stroke())}else{let{x:p,y:M,w,h:y}=t;l==="border-box"?(p=t.x+d/2,M=t.y+d/2,w=t.w-d,y=t.h-d):l==="content-box"?(p=t.x-d/2,M=t.y-d/2,w=t.w+d,y=t.h+d):(p=t.x,M=t.y,w=t.w,y=t.h),u.length>0?e.lineCap="butt":e.lineCap="square",w=Math.max(w,1),y=Math.max(y,1),f=f.map(A=>Math.min(A,w/2,y/2)),e.setLineDash(u),e.lineWidth=d,e.beginPath(),e.moveTo(p+f[0],M),e.arcTo(p+w,M,p+w,M+y,f[1]),e.arcTo(p+w,M+y,p,M+y,f[2]),e.arcTo(p,M+y,p,M,f[3]),e.arcTo(p,M,p+w,M,f[0]),e.closePath(),e.stroke()}e.setLineDash([])}function Yt(e,t,i){const{detail:n}=t,{viewScaleInfo:o,renderContent:s}=i,{shadowColor:r,shadowOffsetX:a,shadowOffsetY:c,shadowBlur:l}=n;J.number(l)?(e.save(),e.shadowColor=r||En.shadowColor,e.shadowOffsetX=(a||0)*o.scale,e.shadowOffsetY=(c||0)*o.scale,e.shadowBlur=(l||0)*o.scale,s(),e.restore()):(e.save(),e.shadowColor="transparent",e.shadowOffsetX=0,e.shadowOffsetY=0,e.shadowBlur=0,s(),e.restore())}function Pa(e,t,i){const{detail:n,angle:o}=t,{viewScaleInfo:s,viewSizeInfo:r,parentOpacity:a}=i,{background:c="#000000",borderColor:l="#000000",boxSizing:d,borderWidth:f=0,borderDash:u}=n;let v=0;typeof f=="number"&&f>0?v=f:Array.isArray(f)&&typeof f[0]=="number"&&f[0]>0&&(v=f[0]),v=v*s.scale;const{x:g,y:h,w:m,h:p}=Ie({x:t.x,y:t.y,w:t.w,h:t.h},{viewScaleInfo:s})||t,M=Object.assign(Object.assign({},t),{x:g,y:h,w:m,h:p,angle:o});Ye(e,{x:g,y:h,w:m,h:p,angle:o},()=>{Yt(e,M,{viewScaleInfo:s,viewSizeInfo:r,renderContent:()=>{let w=m/2,y=p/2;const A=g+w,b=h+y,S=w,R=y;if(v>0&&(d==="content-box"?(w=w,y=y):d==="center-line"?(w=w-v/2,y=y-v/2):(w=w-v,y=y-v)),w>=0&&y>=0){const j=mt(M)*a;e.globalAlpha=j,e.beginPath();const O=Ln(e,c,{viewElementSize:{x:g,y:h,w:m,h:p},viewScaleInfo:s,opacity:e.globalAlpha});if(e.fillStyle=O,e.circle(A,b,S,R,0,0,2*Math.PI),e.closePath(),e.fill(),e.globalAlpha=a,typeof v=="number"&&v>0){const W=v/2+w,_=v/2+y;if(e.beginPath(),u){const k=u.map(U=>U*s.scale);e.setLineDash(k)}e.strokeStyle=l,e.lineWidth=v,e.circle(A,b,W,_,0,0,2*Math.PI),e.closePath(),e.stroke(),e.setLineDash([])}}}})})}function za(e,t,i){const{viewScaleInfo:n,viewSizeInfo:o,parentOpacity:s}=i,{x:r,y:a,w:c,h:l,angle:d}=Ie(t,{viewScaleInfo:n})||t,f=Object.assign(Object.assign({},t),{x:r,y:a,w:c,h:l,angle:d});Ye(e,{x:r,y:a,w:c,h:l,angle:d},()=>{Yt(e,f,{viewScaleInfo:n,viewSizeInfo:o,renderContent:()=>{ci(e,f,{originElem:t,calcElemSize:{x:r,y:a,w:c,h:l,angle:d},viewScaleInfo:n,viewSizeInfo:o,parentOpacity:s,renderContent:()=>{}})}})})}function La(e,t,i){const n=i.loader.getContent(t),{viewScaleInfo:o,viewSizeInfo:s,parentOpacity:r}=i,{x:a,y:c,w:l,h:d,angle:f}=Ie(t,{viewScaleInfo:o})||t,u=Object.assign(Object.assign({},t),{x:a,y:c,w:l,h:d,angle:f});Ye(e,{x:a,y:c,w:l,h:d,angle:f},()=>{Yt(e,u,{viewScaleInfo:o,viewSizeInfo:s,renderContent:()=>{ci(e,u,{originElem:t,calcElemSize:{x:a,y:c,w:l,h:d,angle:f},viewScaleInfo:o,viewSizeInfo:s,parentOpacity:r,renderContent:()=>{if(!n&&!i.loader.isDestroyed()&&i.loader.load(t,i.elementAssets||{}),t.type==="image"&&n){e.globalAlpha=mt(t)*r;const{x:v,y:g,w:h,h:m,radiusList:p}=an(u,{viewScaleInfo:o,viewSizeInfo:s}),{detail:M}=t,{scaleMode:w,originW:y=0,originH:A=0}=M,b=e.$undoPixelRatio(y),S=e.$undoPixelRatio(A);if(e.save(),e.fillStyle="transparent",e.beginPath(),e.moveTo(v+p[0],g),e.arcTo(v+h,g,v+h,g+m,p[1]),e.arcTo(v+h,g+m,v,g+m,p[2]),e.arcTo(v,g+m,v,g,p[3]),e.arcTo(v,g,v+h,g,p[0]),e.closePath(),e.fill(),e.clip(),w&&A&&y){let R=0,j=0,O=b,W=S;const _=v,k=g,U=h,K=m;if(b>t.w||S>t.h){if(w==="fill"){const L=Math.max(t.w/b,t.h/S),T=b*L,Y=S*L;R=(T-t.w)/2/L,j=(Y-t.h)/2/L,O=t.w/L,W=t.h/L}else if(w==="tile")R=0,j=0,O=t.w,W=t.h;else if(w==="fit"){const L=Math.min(t.w/b,t.h/S);R=(b-t.w/L)/2,j=(S-t.h/L)/2,O=t.w/L,W=t.h/L}}e.drawImage(n,R,j,O,W,_,k,U,K)}else e.drawImage(n,v,g,h,m);e.globalAlpha=r,e.restore()}}})}})})}function Ea(e,t,i){const n=i.loader.getContent(t),{viewScaleInfo:o,viewSizeInfo:s,parentOpacity:r}=i,{x:a,y:c,w:l,h:d,angle:f}=Ie(t,{viewScaleInfo:o,viewSizeInfo:s})||t;Ye(e,{x:a,y:c,w:l,h:d,angle:f},()=>{!n&&!i.loader.isDestroyed()&&i.loader.load(t,i.elementAssets||{}),t.type==="svg"&&n&&(e.globalAlpha=mt(t)*r,e.drawImage(n,a,c,l,d),e.globalAlpha=r)})}function Ta(e,t,i){const n=i.loader.getContent(t),{viewScaleInfo:o,viewSizeInfo:s,parentOpacity:r}=i,{x:a,y:c,w:l,h:d,angle:f}=Ie(t,{viewScaleInfo:o,viewSizeInfo:s})||t;Ye(e,{x:a,y:c,w:l,h:d,angle:f},()=>{!n&&!i.loader.isDestroyed()&&i.loader.load(t,i.elementAssets||{}),t.type==="html"&&n&&(e.globalAlpha=mt(t)*r,e.drawImage(n,a,c,l,d),e.globalAlpha=r)})}const un=Bt();function Ca(e,t,i){return i<.5&&e<t&&(e-t)/e>-.15?!0:e>=t}function Da(e,t,i){const{viewScaleInfo:n,viewSizeInfo:o,parentOpacity:s}=i,{x:r,y:a,w:c,h:l,angle:d}=Ie(t,{viewScaleInfo:n})||t,f=Object.assign(Object.assign({},t),{x:r,y:a,w:c,h:l,angle:d});Ye(e,{x:r,y:a,w:c,h:l,angle:d},()=>{ci(e,f,{originElem:t,calcElemSize:{x:r,y:a,w:c,h:l,angle:d},viewScaleInfo:n,viewSizeInfo:o,parentOpacity:s,renderContent:()=>{const u=Object.assign(Object.assign({},un),t.detail),v=u.fontSize||un.fontSize,g=v*n.scale;if(g<2)return;const m=(u.lineHeight||v)*n.scale;e.fillStyle=t.detail.color||un.color,e.textBaseline="top",e.$setFont({fontWeight:u.fontWeight,fontSize:g,fontFamily:vs(u.fontFamily)});let p=u.text.replace(/\r\n/gi,`
`);u.textTransform==="lowercase"?p=p.toLowerCase():u.textTransform==="uppercase"&&(p=p.toUpperCase());const M=m,w=p.split(`
`),y=[];let A=0;w.forEach((R,j)=>{if(u.minInlineSize==="maxContent")y.push({text:R,width:e.$undoPixelRatio(e.measureText(R).width)});else{let O="",_=R.split("");if(u.wordBreak==="normal"){const k=" ",U=R.split(k);_=[],U.forEach((K,L)=>{_.push(K),L<U.length-1&&_.push(k)})}if(_.length===1&&u.overflow==="visible")y.push({text:_[0],width:e.$undoPixelRatio(e.measureText(_[0]).width)});else if(_.length>0){for(let k=0;k<_.length&&(Ca(e.$doPixelRatio(c),e.measureText(O+_[k]).width,n.scale)?O+=_[k]||"":(y.push({text:O,width:e.$undoPixelRatio(e.measureText(O).width)}),O=_[k]||"",A++),!((A+1)*M>l&&u.overflow==="hidden"));k++)if(_.length-1===k&&(A+1)*M<=l){y.push({text:O,width:e.$undoPixelRatio(e.measureText(O).width)}),j<w.length-1&&A++;break}}else y.push({text:"",width:0})}});let b=0,S=0;M>g&&(S=(M-g)/2),y.length*M<l&&(t.detail.verticalAlign==="top"?b=0:t.detail.verticalAlign==="bottom"?b+=l-y.length*M:b+=(l-y.length*M)/2);{const R=a+b;u.textShadowColor!==void 0&&Ni(u.textShadowColor)&&(e.shadowColor=u.textShadowColor),u.textShadowOffsetX!==void 0&&J.number(u.textShadowOffsetX)&&(e.shadowOffsetX=u.textShadowOffsetX),u.textShadowOffsetY!==void 0&&J.number(u.textShadowOffsetY)&&(e.shadowOffsetY=u.textShadowOffsetY),u.textShadowBlur!==void 0&&J.number(u.textShadowBlur)&&(e.shadowBlur=u.textShadowBlur),y.forEach((j,O)=>{let W=r;u.textAlign==="center"?W=r+(c-j.width)/2:u.textAlign==="right"&&(W=r+(c-j.width)),e.fillText(j.text,W,R+M*O+S)})}}})})}var _a=function(e,t){var i={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(i[n]=e[n]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var o=0,n=Object.getOwnPropertySymbols(e);o<n.length;o++)t.indexOf(n[o])<0&&Object.prototype.propertyIsEnumerable.call(e,n[o])&&(i[n[o]]=e[n[o]]);return i};function Oa(e,t,i){var n,o;const{detail:s}=t,{originX:r,originY:a,originW:c,originH:l,fillRule:d}=s,{viewScaleInfo:f,viewSizeInfo:u,parentOpacity:v}=i,{x:g,y:h,w:m,h:p,angle:M}=Ie(t,{viewScaleInfo:f})||t,w=m/c,y=p/l,A=r*w,b=a*y,S=g-A,R=h-b,j=t.detail,O=_a(j,["clipPath","clipPathStrokeColor","clipPathStrokeWidth"]),W=f.scale*u.devicePixelRatio,_=Object.assign(Object.assign({},t),{x:g,y:h,w:m,h:p,angle:M});let k=Object.assign({},_);k.detail=O;let U=Object.assign({},t);U.detail=O,s.fill&&s.fill!=="string"&&(!((o=(n=s.fill)===null||n===void 0?void 0:n.type)===null||o===void 0)&&o.includes("gradient"))&&(k=Object.assign(Object.assign({},_),{detail:Object.assign(Object.assign({},_.detail),{background:s.fill,clipPath:{commands:s.commands,originX:r,originY:a,originW:c,originH:l}})}),U.detail=Object.assign({},k.detail)),Ye(e,{x:g,y:h,w:m,h:p,angle:M},()=>{ci(e,k,{originElem:U,calcElemSize:{x:g,y:h,w:m,h:p,angle:M},viewScaleInfo:f,viewSizeInfo:u,parentOpacity:v,renderContent:()=>{Yt(e,_,{viewScaleInfo:f,viewSizeInfo:u,renderContent:()=>{e.save(),e.translate(S,R),e.scale(W*w/f.scale,W*y/f.scale);const K=Xn(s.commands||[]),L=new Path2D(K);s.fill&&(typeof s.fill=="string"?e.fillStyle=s.fill:e.fillStyle="transparent"),s.fill&&e.fill(L,d),s.stroke&&s.strokeWidth!==0&&(e.strokeStyle=s.stroke,e.lineWidth=(s.strokeWidth||1)/u.devicePixelRatio,e.lineCap=s.strokeLineCap||"square",e.stroke(L)),e.translate(-S,-R),e.restore()}})}})})}const no=.4;function ws(e,t,i){var n,o,s;if(((n=t==null?void 0:t.operations)===null||n===void 0?void 0:n.invisible)===!0)return;const{w:r,h:a}=t,{scale:c}=i.viewScaleInfo;if(c<1&&(r*c<no||a*c<no)||i.parentOpacity===0)return;const{overrideElementMap:l}=i;if(!(!((s=(o=l==null?void 0:l[t.uuid])===null||o===void 0?void 0:o.operations)===null||s===void 0)&&s.invisible))try{switch(t.type){case"rect":{za(e,t,i);break}case"circle":{Pa(e,t,i);break}case"text":{Da(e,t,i);break}case"image":{La(e,t,i);break}case"svg":{Ea(e,t,i);break}case"html":{Ta(e,t,i);break}case"path":{Oa(e,t,i);break}case"group":{const d=Object.assign(Object.assign({},i.elementAssets||{}),t.detail.assets||{});Wa(e,t,Object.assign(Object.assign({},i),{elementAssets:d}));break}default:break}}catch(d){console.error(d)}}function Wa(e,t,i){const{viewScaleInfo:n,viewSizeInfo:o,parentOpacity:s}=i,{x:r,y:a,w:c,h:l,angle:d}=Ie({x:t.x,y:t.y,w:t.w,h:t.h,angle:t.angle},{viewScaleInfo:n})||t,f=Object.assign(Object.assign({},t),{x:r,y:a,w:c,h:l,angle:d});Ye(e,{x:r,y:a,w:c,h:l,angle:d},()=>{e.globalAlpha=mt(t)*s,Yt(e,f,{viewScaleInfo:n,viewSizeInfo:o,renderContent:()=>{ci(e,f,{originElem:t,calcElemSize:{x:r,y:a,w:c,h:l,angle:d},viewScaleInfo:n,viewSizeInfo:o,parentOpacity:s,renderContent:()=>{const{x:u,y:v,w:g,h,radiusList:m}=an(f,{viewScaleInfo:n,viewSizeInfo:o});if(t.detail.overflow==="hidden"&&(e.save(),e.fillStyle="transparent",e.beginPath(),e.moveTo(u+m[0],v),e.arcTo(u+g,v,u+g,v+h,m[1]),e.arcTo(u+g,v+h,u,v+h,m[2]),e.arcTo(u,v+h,u,v,m[3]),e.arcTo(u,v,u+g,v,m[0]),e.closePath(),e.fill(),e.clip()),Array.isArray(t.detail.children)){const{parentElementSize:p}=i,M={x:p.x+t.x,y:p.y+t.y,w:t.w||p.w,h:t.h||p.h,angle:t.angle},{calculator:w}=i;for(let y=0;y<t.detail.children.length;y++){let A=t.detail.children[y];if(A=Object.assign(Object.assign({},A),{x:M.x+A.x,y:M.y+A.y}),!(i.forceDrawAll!==!0&&!(w!=null&&w.needRender(A))))try{ws(e,A,Object.assign(Object.assign({},i),{parentOpacity:s*mt(t)}))}catch(b){console.error(b)}}}t.detail.overflow==="hidden"&&e.restore()}})}}),e.globalAlpha=s})}const ka=Bt();function oo(e,t,i){var n;const{elements:o=[]}=t,{parentOpacity:s}=i;for(let r=0;r<o.length;r++){const a=o[r],c=Object.assign(Object.assign({},a),{detail:Object.assign(Object.assign({},ka),a==null?void 0:a.detail)});if(!(i.forceDrawAll!==!0&&!(!((n=i.calculator)===null||n===void 0)&&n.needRender(c))))try{ws(e,c,Object.assign(Object.assign({},i),{parentOpacity:s}))}catch(l){console.error(l)}}}function ja(e,t,i,n){const{viewScaleInfo:o,viewSizeInfo:s,parentOpacity:r}=i,a=Object.assign({uuid:"layout",type:"group"},t),{x:c,y:l,w:d,h:f}=Ie(a,{viewScaleInfo:o})||a,v=Object.assign(Object.assign({},a),{x:c,y:l,w:d,h:f,angle:0});if(e.globalAlpha=1,Yt(e,v,{viewScaleInfo:o,viewSizeInfo:s,renderContent:()=>{ms(e,v,{viewScaleInfo:o,viewSizeInfo:s})}}),t.detail.overflow==="hidden"){const{viewScaleInfo:g,viewSizeInfo:h}=i,m=Object.assign({uuid:"layout",type:"group"},t),p=Ie(m,{viewScaleInfo:g})||m,M=Object.assign(Object.assign({},m),p),{x:w,y,w:A,h:b,radiusList:S}=an(M,{viewScaleInfo:g,viewSizeInfo:h});e.save(),e.fillStyle="transparent",e.beginPath(),e.moveTo(w+S[0],y),e.arcTo(w+A,y,w+A,y+b,S[1]),e.arcTo(w+A,y+b,w,y+b,S[2]),e.arcTo(w,y+b,w,y,S[3]),e.arcTo(w,y,w+A,y,S[0]),e.closePath(),e.fill(),e.clip()}n(e),t.detail.overflow==="hidden"&&e.restore(),ys(e,v,{viewScaleInfo:o,viewSizeInfo:s}),e.globalAlpha=r}function Va(e,t,i){if(typeof(t==null?void 0:t.background)=="string"){const{viewSizeInfo:n}=i,{width:o,height:s}=n;e.globalAlpha=1,e.fillStyle=t.background,e.fillRect(0,0,o,s)}}var gn=function(e,t,i,n){function o(s){return s instanceof i?s:new i(function(r){r(s)})}return new(i||(i=Promise))(function(s,r){function a(d){try{l(n.next(d))}catch(f){r(f)}}function c(d){try{l(n.throw(d))}catch(f){r(f)}}function l(d){d.done?s(d.value):o(d.value).then(a,c)}l((n=n.apply(e,t||[])).next())})},ne=function(e,t,i,n){if(i==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof t=="function"?e!==t||!n:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return i==="m"?n:i==="a"?n.call(e):n?n.value:t.get(e)},Ft=function(e,t,i,n,o){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!o)throw new TypeError("Private accessor was defined without a setter");if(typeof t=="function"?e!==t||!o:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?o.call(e,i):o?o.value=i:t.set(e,i),i},_e,ti,_t,De,Ke,zi,vn,so,ro,ao,ps,bs;const Ba=["image","svg","html"],$t=e=>{var t,i,n;let o=null;return e.type==="image"?o=((t=e==null?void 0:e.detail)===null||t===void 0?void 0:t.src)||null:e.type==="svg"?o=((i=e==null?void 0:e.detail)===null||i===void 0?void 0:i.svg)||null:e.type==="html"&&(o=((n=e==null?void 0:e.detail)===null||n===void 0?void 0:n.html)||null),typeof o=="string"&&o?vt(o)?o:qe(o):qe(`${gt()}-${e.uuid}-${gt()}-${gt()}`)};class Ya extends ri{constructor(){super(),_e.add(this),ti.set(this,{}),_t.set(this,{}),De.set(this,{}),Ke.set(this,!1),ne(this,_e,"m",zi).call(this,"image",(t,i)=>gn(this,void 0,void 0,function*(){var n;const o=((n=i[t.detail.src])===null||n===void 0?void 0:n.value)||t.detail.src,s=yield nn(o);return{uuid:t.uuid,lastModified:Date.now(),content:s}})),ne(this,_e,"m",zi).call(this,"html",(t,i)=>gn(this,void 0,void 0,function*(){var n;const o=((n=i[t.detail.html])===null||n===void 0?void 0:n.value)||t.detail.html,s=yield nr(o,{width:t.detail.originW||t.w,height:t.detail.originH||t.h});return{uuid:t.uuid,lastModified:Date.now(),content:s}})),ne(this,_e,"m",zi).call(this,"svg",(t,i)=>gn(this,void 0,void 0,function*(){var n;const o=((n=i[t.detail.svg])===null||n===void 0?void 0:n.value)||t.detail.svg,s=yield tr(o);return{uuid:t.uuid,lastModified:Date.now(),content:s}}))}isDestroyed(){return ne(this,Ke,"f")}destroy(){Ft(this,Ke,!0,"f"),this.clear(),Ft(this,ti,null,"f"),Ft(this,_t,null,"f"),Ft(this,De,null,"f")}load(t,i){ne(this,Ke,"f")!==!0&&(ne(this,_e,"m",bs).call(this,t)||Ba.includes(t.type)&&ne(this,_e,"m",ps).call(this,t,i))}getContent(t){var i,n;const o=$t(t);return((n=(i=ne(this,De,"f"))===null||i===void 0?void 0:i[o])===null||n===void 0?void 0:n.content)||null}getLoadItemMap(){return ne(this,De,"f")}setLoadItemMap(t){Ft(this,De,t,"f")}}ti=new WeakMap,_t=new WeakMap,De=new WeakMap,Ke=new WeakMap,_e=new WeakSet,zi=function(t,i){ne(this,ti,"f")[t]=i},vn=function(t){var i,n,o;let s=null;return t.type==="image"?s=((i=t==null?void 0:t.detail)===null||i===void 0?void 0:i.src)||null:t.type==="svg"?s=((n=t==null?void 0:t.detail)===null||n===void 0?void 0:n.svg)||null:t.type==="html"&&(s=((o=t==null?void 0:t.detail)===null||o===void 0?void 0:o.html)||null),s},so=function(t){return{element:t,status:"null",content:null,error:null,startTime:-1,endTime:-1,source:ne(this,_e,"m",vn).call(this,t)}},ro=function(t){const i=$t(t.element),n=ne(this,De,"f")[i];ne(this,Ke,"f")||(n?n.startTime<t.startTime&&(ne(this,De,"f")[i]=t,this.trigger("load",Object.assign(Object.assign({},t),{countTime:t.endTime-t.startTime}))):(ne(this,De,"f")[i]=t,this.trigger("load",Object.assign(Object.assign({},t),{countTime:t.endTime-t.startTime}))))},ao=function(t){var i;const n=$t(t.element),o=(i=ne(this,De,"f"))===null||i===void 0?void 0:i[n];ne(this,Ke,"f")||(o?o.startTime<t.startTime&&(ne(this,De,"f")[n]=t,this.trigger("error",Object.assign(Object.assign({},t),{countTime:t.endTime-t.startTime}))):(ne(this,De,"f")[n]=t,this.trigger("error",Object.assign(Object.assign({},t),{countTime:t.endTime-t.startTime}))))},ps=function(t,i){const n=ne(this,_e,"m",so).call(this,t),o=$t(t);if(ne(this,_t,"f")[o])return;ne(this,_t,"f")[o]=n;const s=ne(this,ti,"f")[t.type];typeof s=="function"&&!ne(this,Ke,"f")&&(n.startTime=Date.now(),s(t,i).then(r=>{ne(this,Ke,"f")||(n.content=r.content,n.endTime=Date.now(),n.status="load",ne(this,_e,"m",ro).call(this,n))}).catch(r=>{console.warn(`Load element source "${n.source}" fail`,r,t),n.endTime=Date.now(),n.status="error",n.error=r,ne(this,_e,"m",ao).call(this,n)}))},bs=function(t){var i;const n=$t(t),o=(i=ne(this,_t,"f"))===null||i===void 0?void 0:i[n];return!!(o&&o.status==="error"&&o.source&&o.source===ne(this,_e,"m",vn).call(this,t))};var Gt=function(e,t,i,n,o){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!o)throw new TypeError("Private accessor was defined without a setter");if(typeof t=="function"?e!==t||!o:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?o.call(e,i):o?o.value=i:t.set(e,i),i},je=function(e,t,i,n){if(i==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof t=="function"?e!==t||!n:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return i==="m"?n:i==="a"?n.call(e):n?n.value:t.get(e)},Tn,nt,Ze,Li,Ss;class Ms extends ri{constructor(t){super(),Tn.add(this),nt.set(this,void 0),Ze.set(this,new Ya),Li.set(this,!1),Gt(this,nt,t,"f"),je(this,Tn,"m",Ss).call(this)}isDestroyed(){return je(this,Li,"f")}destroy(){this.clear(),Gt(this,nt,null,"f"),je(this,Ze,"f").destroy(),Gt(this,Ze,null,"f"),Gt(this,Li,!0,"f")}updateOptions(t){Gt(this,nt,t,"f")}drawData(t,i){const n=je(this,Ze,"f"),{calculator:o,sharer:s}=je(this,nt,"f"),r=je(this,nt,"f").viewContext;r.clearRect(0,0,r.canvas.width,r.canvas.height);const a={x:0,y:0,w:i.viewSizeInfo.width,h:i.viewSizeInfo.height},c=Object.assign({loader:n,calculator:o,parentElementSize:a,elementAssets:t.assets,parentOpacity:1,overrideElementMap:s==null?void 0:s.getActiveOverrideElemenentMap()},i);Va(r,t.global,c),t.layout?ja(r,t.layout,c,()=>{oo(r,t,c)}):oo(r,t,c)}scale(t){const{sharer:i}=je(this,nt,"f");if(!i)return;const{data:n,offsetTop:o,offsetBottom:s,offsetLeft:r,offsetRight:a,width:c,height:l,contextHeight:d,contextWidth:f,devicePixelRatio:u}=i.getActiveStoreSnapshot();n&&this.drawData(n,{viewScaleInfo:{scale:t,offsetTop:o,offsetBottom:s,offsetLeft:r,offsetRight:a},viewSizeInfo:{width:c,height:l,contextHeight:d,contextWidth:f,devicePixelRatio:u}})}setLoadItemMap(t){je(this,Ze,"f").setLoadItemMap(t)}getLoadItemMap(){return je(this,Ze,"f").getLoadItemMap()}getLoader(){return je(this,Ze,"f")}}nt=new WeakMap,Ze=new WeakMap,Li=new WeakMap,Tn=new WeakSet,Ss=function(){const t=je(this,Ze,"f");t.on("load",i=>{this.trigger("load",i)}),t.on("error",i=>{console.error(i)})};var mn=function(e,t,i,n,o){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!o)throw new TypeError("Private accessor was defined without a setter");if(typeof t=="function"?e!==t||!o:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?o.call(e,i):o?o.value=i:t.set(e,i),i},Re=function(e,t,i,n){if(i==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof t=="function"?e!==t||!n:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return i==="m"?n:i==="a"?n.call(e):n?n.value:t.get(e)},Pt,Ae;class xs{constructor(t){Pt.set(this,void 0),Ae.set(this,void 0),mn(this,Pt,t,"f"),mn(this,Ae,new oi({defaultStorage:{viewVisibleInfoMap:{},visibleCount:0,invisibleCount:0}}),"f")}toGridNum(t,i){return(i==null?void 0:i.ignore)===!0?t:Math.round(t)}destroy(){mn(this,Pt,null,"f")}needRender(t){const n=Re(this,Ae,"f").get("viewVisibleInfoMap")[t.uuid];return n?n.isVisibleInView:!0}isPointInElement(t,i,n,o){const s=Re(this,Pt,"f").viewContext;return zn(t,{context2d:s,element:i,viewScaleInfo:n,viewSizeInfo:o})}getPointElement(t,i){const n=Re(this,Pt,"f").viewContext;return Jr(t,Object.assign(Object.assign({},i),{context2d:n}))}resetViewVisibleInfoMap(t,i){if(t){const{viewVisibleInfoMap:n,invisibleCount:o,visibleCount:s}=Kr(t.elements,i);Re(this,Ae,"f").set("viewVisibleInfoMap",n),Re(this,Ae,"f").set("invisibleCount",o),Re(this,Ae,"f").set("visibleCount",s)}}updateVisiableStatus(t){const{viewVisibleInfoMap:i,invisibleCount:n,visibleCount:o}=ls(Re(this,Ae,"f").get("viewVisibleInfoMap"),t);Re(this,Ae,"f").set("viewVisibleInfoMap",i),Re(this,Ae,"f").set("invisibleCount",n),Re(this,Ae,"f").set("visibleCount",o)}calcViewRectInfoFromOrigin(t,i){const n=Re(this,Ae,"f").get("viewVisibleInfoMap")[t];if(!(n!=null&&n.originRectInfo))return null;const{checkVisible:o,viewScaleInfo:s,viewSizeInfo:r}=i,{center:a,left:c,right:l,bottom:d,top:f,topLeft:u,topRight:v,bottomLeft:g,bottomRight:h}=n.originRectInfo;if(o===!0&&n.isVisibleInView===!1)return null;const m={viewScaleInfo:s,viewSizeInfo:r};return{center:N(a,m),left:N(c,m),right:N(l,m),bottom:N(d,m),top:N(f,m),topLeft:N(u,m),topRight:N(v,m),bottomLeft:N(g,m),bottomRight:N(h,m)}}calcViewRectInfoFromRange(t,i){const n=Re(this,Ae,"f").get("viewVisibleInfoMap")[t];if(!(n!=null&&n.originRectInfo))return null;const{checkVisible:o,viewScaleInfo:s,viewSizeInfo:r}=i,{center:a,left:c,right:l,bottom:d,top:f,topLeft:u,topRight:v,bottomLeft:g,bottomRight:h}=n.rangeRectInfo;if(o===!0&&n.isVisibleInView===!1)return null;const m={viewScaleInfo:s,viewSizeInfo:r};return{center:N(a,m),left:N(c,m),right:N(l,m),bottom:N(d,m),top:N(f,m),topLeft:N(u,m),topRight:N(v,m),bottomLeft:N(g,m),bottomRight:N(h,m)}}modifyViewVisibleInfoMap(t,i){const{modifyOptions:n,viewScaleInfo:o,viewSizeInfo:s}=i,{type:r,content:a}=n,c=t.elements,l=Re(this,Ae,"f").get("viewVisibleInfoMap");if(r==="deleteElement"){const{element:d}=a;delete l[d.uuid]}else if(r==="addElement"||r==="updateElement"){const{position:d}=a,f=sn(d,t.elements),u=ss(c,d);if(f){const v=rn(f,{groupQueue:u||[]}),g={originRectInfo:v,rangeRectInfo:J.angle(f.angle)?as(v):v,isVisibleInView:!0,isGroup:(f==null?void 0:f.type)==="group",position:[...d]};l[f.uuid]=g,r==="updateElement"&&this.updateVisiableStatus({viewScaleInfo:o,viewSizeInfo:s})}}else r==="moveElement"&&this.resetViewVisibleInfoMap(t,{viewScaleInfo:o,viewSizeInfo:s});Re(this,Ae,"f").set("viewVisibleInfoMap",l)}}Pt=new WeakMap,Ae=new WeakMap;var yn=function(e,t,i,n,o){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!o)throw new TypeError("Private accessor was defined without a setter");if(typeof t=="function"?e!==t||!o:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?o.call(e,i):o?o.value=i:t.set(e,i),i},F=function(e,t,i,n){if(i==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof t=="function"?e!==t||!n:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return i==="m"?n:i==="a"?n.call(e):n?n.value:t.get(e)},ae,Ot,Ce,Ei,As,Ti,Ci,Di,_i,Oi,Wi,ki,ji,Ne,Ue,dt;function lo(e){return e>0||e<0||e===0}class Fa extends ri{constructor(t){super(),ae.add(this),Ot.set(this,void 0),Ce.set(this,void 0),Ei.set(this,!1),Ti.set(this,n=>{if(!F(this,ae,"m",Ne).call(this,n))return;const o=F(this,ae,"m",Ue).call(this,n);if(!F(this,ae,"m",dt).call(this,o))return;n.preventDefault(),n.stopPropagation();const s=n.deltaX>0||n.deltaX<0?n.deltaX:0,r=n.deltaY>0||n.deltaY<0?n.deltaY:0;n.ctrlKey===!0&&this.has("wheelScale")?this.trigger("wheelScale",{deltaX:s,deltaY:r,point:o}):this.has("wheel")&&this.trigger("wheel",{deltaX:s,deltaY:r,point:o})}),Ci.set(this,n=>{if(!F(this,ae,"m",Ne).call(this,n))return;n.preventDefault();const o=F(this,ae,"m",Ue).call(this,n);F(this,ae,"m",dt).call(this,o)}),Di.set(this,n=>{if(!F(this,ae,"m",Ne).call(this,n))return;n.preventDefault();const o=F(this,ae,"m",Ue).call(this,n);if(!F(this,ae,"m",dt).call(this,o))return;const s=500,r=Date.now(),a=F(this,Ce,"f").get("prevClickPoint");a&&r-a.t<=s&&Math.abs(a.x-o.x)<=5&&Math.abs(a.y-o.y)<=5?this.trigger("doubleClick",{point:o}):F(this,Ce,"f").set("prevClickPoint",o)}),_i.set(this,n=>{if(F(this,Ce,"f").set("hasPointDown",!1),!F(this,ae,"m",Ne).call(this,n))return;n.preventDefault();const o=F(this,ae,"m",Ue).call(this,n);this.trigger("pointLeave",{point:o})}),Oi.set(this,n=>{if(F(this,Ce,"f").set("hasPointDown",!1),!F(this,ae,"m",Ne).call(this,n))return;n.preventDefault();const o=F(this,ae,"m",Ue).call(this,n);this.trigger("pointEnd",{point:o})}),Wi.set(this,n=>{if(!F(this,ae,"m",Ne).call(this,n))return;n.preventDefault(),n.stopPropagation();const o=F(this,ae,"m",Ue).call(this,n);if(!F(this,ae,"m",dt).call(this,o)){F(this,Ce,"f").get("hasPointDown")&&(this.trigger("pointLeave",{point:o}),F(this,Ce,"f").set("hasPointDown",!1));return}F(this,Ce,"f").get("hasPointDown")===!0&&this.trigger("pointMove",{point:o})}),ki.set(this,n=>{if(!F(this,ae,"m",Ne).call(this,n))return;n.preventDefault();const o=F(this,ae,"m",Ue).call(this,n);F(this,ae,"m",dt).call(this,o)&&(F(this,Ce,"f").set("hasPointDown",!0),this.trigger("pointStart",{point:o}))}),ji.set(this,n=>{if(!F(this,ae,"m",Ne).call(this,n))return;n.preventDefault();const o=F(this,ae,"m",Ue).call(this,n);F(this,ae,"m",dt).call(this,o)&&this.trigger("hover",{point:o})});const i=new oi({defaultStorage:{hasPointDown:!1,prevClickPoint:null}});yn(this,Ce,i,"f"),yn(this,Ot,t,"f"),F(this,ae,"m",As).call(this)}onEvents(){if(F(this,Ei,"f"))return;const t=window;t.addEventListener("mousemove",F(this,ji,"f")),t.addEventListener("mousedown",F(this,ki,"f")),t.addEventListener("mousemove",F(this,Wi,"f")),t.addEventListener("mouseup",F(this,Oi,"f")),t.addEventListener("mouseleave",F(this,_i,"f")),t.addEventListener("wheel",F(this,Ti,"f"),{passive:!1}),t.addEventListener("click",F(this,Di,"f")),t.addEventListener("contextmenu",F(this,Ci,"f"))}offEvents(){const t=window;t.removeEventListener("mousemove",F(this,ji,"f")),t.removeEventListener("mousedown",F(this,ki,"f")),t.removeEventListener("mousemove",F(this,Wi,"f")),t.removeEventListener("mouseup",F(this,Oi,"f")),t.removeEventListener("mouseleave",F(this,_i,"f")),t.removeEventListener("wheel",F(this,Ti,"f")),t.removeEventListener("click",F(this,Di,"f")),t.removeEventListener("contextmenu",F(this,Ci,"f"))}destroy(){this.offEvents(),F(this,Ce,"f").destroy(),yn(this,Ei,!0,"f")}}Ot=new WeakMap,Ce=new WeakMap,Ei=new WeakMap,Ti=new WeakMap,Ci=new WeakMap,Di=new WeakMap,_i=new WeakMap,Oi=new WeakMap,Wi=new WeakMap,ki=new WeakMap,ji=new WeakMap,ae=new WeakSet,As=function(){this.onEvents()},Ne=function(t){return t.target===F(this,Ot,"f").boardContent.boardContext.canvas},Ue=function(t){const n=F(this,Ot,"f").boardContent.boardContext.canvas.getBoundingClientRect();return{x:t.clientX-n.left,y:t.clientY-n.top,t:Date.now()}},dt=function(t){const i=F(this,Ot,"f").sharer.getActiveViewSizeInfo(),{width:n,height:o}=i;return!!(lo(t.x)&&lo(t.y)&&t.x<=n&&t.y<=o)};var co=function(e,t,i,n,o){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!o)throw new TypeError("Private accessor was defined without a setter");if(typeof t=="function"?e!==t||!o:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?o.call(e,i):o?o.value=i:t.set(e,i),i},oe=function(e,t,i,n){if(i==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof t=="function"?e!==t||!n:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return i==="m"?n:i==="a"?n.call(e):n?n.value:t.get(e)},se,zt;const Ga={width:0,height:0,devicePixelRatio:1,contextWidth:0,contextHeight:0,data:null,scale:1,offsetLeft:0,offsetRight:0,offsetTop:0,offsetBottom:0,overrideElementMap:null};class Xa{constructor(){se.set(this,void 0),zt.set(this,void 0);const t=new oi({defaultStorage:Ga}),i=new oi({defaultStorage:{}});co(this,se,t,"f"),co(this,zt,i,"f")}getActiveStorage(t){return oe(this,se,"f").get(t)}setActiveStorage(t,i){return oe(this,se,"f").set(t,i)}getActiveStoreSnapshot(t){return oe(this,se,"f").getSnapshot(t)}getSharedStorage(t){return oe(this,zt,"f").get(t)}setSharedStorage(t,i){return oe(this,zt,"f").set(t,i)}getSharedStoreSnapshot(t){return oe(this,zt,"f").getSnapshot(t)}getActiveViewScaleInfo(){return{scale:oe(this,se,"f").get("scale"),offsetTop:oe(this,se,"f").get("offsetTop"),offsetBottom:oe(this,se,"f").get("offsetBottom"),offsetLeft:oe(this,se,"f").get("offsetLeft"),offsetRight:oe(this,se,"f").get("offsetRight")}}setActiveViewScaleInfo(t){const{scale:i,offsetTop:n,offsetBottom:o,offsetLeft:s,offsetRight:r}=t;oe(this,se,"f").set("scale",i),oe(this,se,"f").set("offsetTop",n),oe(this,se,"f").set("offsetBottom",o),oe(this,se,"f").set("offsetLeft",s),oe(this,se,"f").set("offsetRight",r)}setActiveViewSizeInfo(t){oe(this,se,"f").set("width",t.width),oe(this,se,"f").set("height",t.height),oe(this,se,"f").set("devicePixelRatio",t.devicePixelRatio),oe(this,se,"f").set("contextWidth",t.contextWidth),oe(this,se,"f").set("contextHeight",t.contextHeight)}getActiveViewSizeInfo(){return{width:oe(this,se,"f").get("width"),height:oe(this,se,"f").get("height"),devicePixelRatio:oe(this,se,"f").get("devicePixelRatio"),contextWidth:oe(this,se,"f").get("contextWidth"),contextHeight:oe(this,se,"f").get("contextHeight")}}getActiveOverrideElemenentMap(){return oe(this,se,"f").get("overrideElementMap")}setActiveOverrideElemenentMap(t){oe(this,se,"f").set("overrideElementMap",t)}}se=new WeakMap,zt=new WeakMap;var Vi=function(e,t,i,n,o){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!o)throw new TypeError("Private accessor was defined without a setter");if(typeof t=="function"?e!==t||!o:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?o.call(e,i):o?o.value=i:t.set(e,i),i},he=function(e,t,i,n){if(i==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof t=="function"?e!==t||!n:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return i==="m"?n:i==="a"?n.call(e):n?n.value:t.get(e)},ii,Se,Wt,Lt,Is,Rs;const{requestAnimationFrame:Ha}=window;class Na extends ri{constructor(t){super(),ii.add(this),Se.set(this,void 0),Wt.set(this,[]),Lt.set(this,"FREE"),Vi(this,Se,t,"f"),he(this,ii,"m",Is).call(this)}resetViewVisibleInfoMap(t,i){t&&he(this,Se,"f").calculator.resetViewVisibleInfoMap(t,i)}drawFrame(){const{sharer:t}=he(this,Se,"f"),i=t.getActiveStoreSnapshot(),n=t.getSharedStoreSnapshot();he(this,Wt,"f").push({activeStore:i,sharedStore:n}),he(this,ii,"m",Rs).call(this)}scale(t){const{scale:i,point:n,ignoreUpdateVisibleStatus:o}=t,{sharer:s}=he(this,Se,"f"),{moveX:r,moveY:a}=$r({scale:i,point:n,viewScaleInfo:s.getActiveViewScaleInfo(),viewSizeInfo:s.getActiveViewSizeInfo()});return s.setActiveStorage("scale",i),o||he(this,Se,"f").calculator.updateVisiableStatus({viewScaleInfo:s.getActiveViewScaleInfo(),viewSizeInfo:s.getActiveViewSizeInfo()}),{moveX:r,moveY:a}}scroll(t){const{sharer:i}=he(this,Se,"f"),n=i.getActiveViewScaleInfo(),{moveX:o,moveY:s,ignoreUpdateVisibleStatus:r}=t,a=i.getActiveViewSizeInfo(),c=Qr({moveX:o,moveY:s,viewScaleInfo:n,viewSizeInfo:a});return i.setActiveViewScaleInfo(c),r||he(this,Se,"f").calculator.updateVisiableStatus({viewScaleInfo:i.getActiveViewScaleInfo(),viewSizeInfo:i.getActiveViewSizeInfo()}),c}updateViewScaleInfo(t){const{sharer:i}=he(this,Se,"f"),n=Ur(t,{viewSizeInfo:i.getActiveViewSizeInfo()});return i.setActiveViewScaleInfo(n),he(this,Se,"f").calculator.updateVisiableStatus({viewScaleInfo:i.getActiveViewScaleInfo(),viewSizeInfo:i.getActiveViewSizeInfo()}),n}resize(t={},i){const{sharer:n}=he(this,Se,"f"),o=n.getActiveViewSizeInfo(),s=Object.assign(Object.assign({},o),t),{width:r,height:a,devicePixelRatio:c}=s,{underlayContext:l,boardContext:d,overlayContext:f,viewContext:u}=he(this,Se,"f").boardContent;return d.canvas.width=r*c,d.canvas.height=a*c,d.canvas.style.width=`${r}px`,d.canvas.style.height=`${a}px`,l.canvas.width=r*c,l.canvas.height=a*c,f.canvas.width=r*c,f.canvas.height=a*c,u.canvas.width=r*c,u.canvas.height=a*c,n.setActiveViewSizeInfo(s),i!=null&&i.ignoreUpdateVisibleStatus||he(this,Se,"f").calculator.updateVisiableStatus({viewScaleInfo:n.getActiveViewScaleInfo(),viewSizeInfo:n.getActiveViewSizeInfo()}),s}}Se=new WeakMap,Wt=new WeakMap,Lt=new WeakMap,ii=new WeakSet,Is=function(){const{renderer:t}=he(this,Se,"f");t.on("load",()=>{this.drawFrame()})},Rs=function e(){if(he(this,Lt,"f")==="DRAWING"||he(this,Wt,"f").length===0)return;Vi(this,Lt,"DRAWING","f");const t=he(this,Wt,"f").shift(),{renderer:i,boardContent:n,beforeDrawFrame:o,afterDrawFrame:s}=he(this,Se,"f");if(t){const{scale:r,offsetTop:a,offsetBottom:c,offsetLeft:l,offsetRight:d,width:f,height:u,contextHeight:v,contextWidth:g,devicePixelRatio:h}=t.activeStore,m={scale:r,offsetTop:a,offsetBottom:c,offsetLeft:l,offsetRight:d},p={width:f,height:u,contextHeight:v,contextWidth:g,devicePixelRatio:h};t!=null&&t.activeStore.data&&i.drawData(t.activeStore.data,{viewScaleInfo:m,viewSizeInfo:p}),o({snapshot:t}),n.drawView(),s({snapshot:t})}if(he(this,Wt,"f").length===0){Vi(this,Lt,"COMPLETE","f");return}Vi(this,Lt,"DRAWING","f")&&Ha(()=>{he(this,ii,"m",e).call(this)})};var ot=function(e,t,i,n,o){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!o)throw new TypeError("Private accessor was defined without a setter");if(typeof t=="function"?e!==t||!o:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?o.call(e,i):o?o.value=i:t.set(e,i),i},D=function(e,t,i,n){if(i==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof t=="function"?e!==t||!n:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return i==="m"?n:i==="a"?n.call(e):n?n.value:t.get(e)},ge,Et,Je,Qi,ie,we,kt,Ve,Le,Tt,jt,Bi,Ps,fo,ho,uo,go,vo,mo,yo,wo,po,bo,zs,Ls,Es,Qt;class Ua{constructor(t){ge.add(this),Et.set(this,void 0),Je.set(this,new WeakMap),Qi.set(this,[]),ie.set(this,[]),we.set(this,void 0),kt.set(this,void 0),Ve.set(this,void 0),Le.set(this,void 0),Tt.set(this,void 0),jt.set(this,new ri),Bi.set(this,!1);const{boardContent:i}=t,n=new Xa,o=new xs({viewContext:i.viewContext}),s=new Fa({boardContent:i,sharer:n}),r=new Ms({viewContext:i.viewContext,sharer:n,calculator:o});ot(this,Et,t,"f"),ot(this,Ve,n,"f"),ot(this,we,s,"f"),ot(this,kt,r,"f"),ot(this,Tt,o,"f"),ot(this,Le,new Na({boardContent:t.boardContent,sharer:n,renderer:r,calculator:D(this,Tt,"f"),beforeDrawFrame:a=>{D(this,ge,"m",Ls).call(this,a)},afterDrawFrame:a=>{D(this,ge,"m",Es).call(this,a)}}),"f"),D(this,ge,"m",Ps).call(this),D(this,ge,"m",Qt).call(this)}isDestroyed(){return D(this,Bi,"f")}destroy(){D(this,we,"f").destroy(),D(this,kt,"f").destroy(),D(this,Tt,"f").destroy(),D(this,jt,"f").destroy(),ot(this,Bi,!0,"f")}getSharer(){return D(this,Ve,"f")}getViewer(){return D(this,Le,"f")}getRenderer(){return D(this,kt,"f")}setData(t,i){const{modifiedOptions:n}=i||{},o=D(this,Ve,"f");D(this,Ve,"f").setActiveStorage("data",t);const s=o.getActiveViewSizeInfo(),r=o.getActiveViewScaleInfo(),a=os(t.elements,{viewWidth:s.width,viewHeight:s.height,extend:!0});n?D(this,Le,"f").resetViewVisibleInfoMap(t,{viewSizeInfo:s,viewScaleInfo:r}):D(this,Le,"f").resetViewVisibleInfoMap(t,{viewSizeInfo:s,viewScaleInfo:r}),D(this,Le,"f").drawFrame();const c=Object.assign(Object.assign({},s),a);return D(this,Ve,"f").setActiveViewSizeInfo(c),{viewSizeInfo:c}}getData(){const{data:t}=D(this,Ve,"f").getActiveStoreSnapshot();return t}use(t){var i,n,o;if(D(this,Je,"f").has(t)){const u=D(this,Je,"f").get(t);if(u){(n=(i=u.middlewareObject).use)===null||n===void 0||n.call(i),u.status="enable",D(this,Je,"f").set(t,u),D(this,ge,"m",Qt).call(this);return}}const{boardContent:s,container:r}=D(this,Et,"f"),a=D(this,Ve,"f"),c=D(this,Le,"f"),l=D(this,Tt,"f"),d=D(this,jt,"f"),f=t({boardContent:s,sharer:a,viewer:c,calculator:l,eventHub:d,container:r});(o=f.use)===null||o===void 0||o.call(f),D(this,Qi,"f").push(t),D(this,ie,"f").push(f),D(this,Je,"f").set(t,{status:"enable",middlewareObject:f}),D(this,ge,"m",Qt).call(this)}disuse(t){var i,n;const o=D(this,Je,"f").get(t);o&&((n=(i=o.middlewareObject).disuse)===null||n===void 0||n.call(i),o.status="disable",D(this,Je,"f").set(t,o),D(this,ge,"m",Qt).call(this))}scale(t){const i=D(this,Le,"f"),{ignoreUpdateVisibleStatus:n}=t,{moveX:o,moveY:s}=i.scale(Object.assign(Object.assign({},t),{ignoreUpdateVisibleStatus:!0}));i.scroll({moveX:o,moveY:s,ignoreUpdateVisibleStatus:n})}scroll(t){return D(this,Le,"f").scroll(t)}updateViewScaleInfo(t){return D(this,Le,"f").updateViewScaleInfo(t)}resize(t,i){const n=D(this,Le,"f").resize(t,i),{width:o,height:s,devicePixelRatio:r}=t,{boardContent:a}=D(this,Et,"f");a.viewContext.$resize({width:o,height:s,devicePixelRatio:r}),a.overlayContext.$resize({width:o,height:s,devicePixelRatio:r}),a.boardContext.$resize({width:o,height:s,devicePixelRatio:r}),a.underlayContext.$resize({width:o,height:s,devicePixelRatio:r}),D(this,Le,"f").drawFrame(),D(this,we,"f").trigger("resize",n),D(this,Ve,"f").setActiveViewSizeInfo(t)}clear(){const{boardContent:t}=D(this,Et,"f"),{underlayContext:i,overlayContext:n,viewContext:o,boardContext:s}=t;i.clearRect(0,0,i.canvas.width,i.canvas.height),n.clearRect(0,0,n.canvas.width,n.canvas.height),o.clearRect(0,0,o.canvas.width,o.canvas.height),s.clearRect(0,0,s.canvas.width,s.canvas.height),D(this,ge,"m",zs).call(this)}getEventHub(){return D(this,jt,"f")}onWatcherEvents(){D(this,we,"f").onEvents()}offWatcherEvents(){D(this,we,"f").offEvents()}}Et=new WeakMap,Je=new WeakMap,Qi=new WeakMap,ie=new WeakMap,we=new WeakMap,kt=new WeakMap,Ve=new WeakMap,Le=new WeakMap,Tt=new WeakMap,jt=new WeakMap,Bi=new WeakMap,ge=new WeakSet,Ps=function(){D(this,we,"f").on("pointStart",D(this,ge,"m",fo).bind(this)),D(this,we,"f").on("pointEnd",D(this,ge,"m",ho).bind(this)),D(this,we,"f").on("pointMove",D(this,ge,"m",uo).bind(this)),D(this,we,"f").on("hover",D(this,ge,"m",go).bind(this)),D(this,we,"f").on("wheel",D(this,ge,"m",mo).bind(this)),D(this,we,"f").on("wheelScale",D(this,ge,"m",yo).bind(this)),D(this,we,"f").on("scrollX",D(this,ge,"m",wo).bind(this)),D(this,we,"f").on("scrollY",D(this,ge,"m",po).bind(this)),D(this,we,"f").on("resize",D(this,ge,"m",bo).bind(this)),D(this,we,"f").on("doubleClick",D(this,ge,"m",vo).bind(this)),D(this,kt,"f").on("load",()=>{D(this,jt,"f").trigger("loadResource")})},fo=function(t){var i;for(let n=0;n<D(this,ie,"f").length;n++){const o=D(this,ie,"f")[n];if(((i=o==null?void 0:o.pointStart)===null||i===void 0?void 0:i.call(o,t))===!1)return}},ho=function(t){var i;for(let n=0;n<D(this,ie,"f").length;n++){const o=D(this,ie,"f")[n];if(((i=o==null?void 0:o.pointEnd)===null||i===void 0?void 0:i.call(o,t))===!1)return}},uo=function(t){var i;for(let n=0;n<D(this,ie,"f").length;n++){const o=D(this,ie,"f")[n];if(((i=o==null?void 0:o.pointMove)===null||i===void 0?void 0:i.call(o,t))===!1)return}},go=function(t){var i;for(let n=0;n<D(this,ie,"f").length;n++){const o=D(this,ie,"f")[n];if(((i=o==null?void 0:o.hover)===null||i===void 0?void 0:i.call(o,t))===!1)return}},vo=function(t){var i;for(let n=0;n<D(this,ie,"f").length;n++){const o=D(this,ie,"f")[n];if(((i=o==null?void 0:o.doubleClick)===null||i===void 0?void 0:i.call(o,t))===!1)return}},mo=function(t){var i;for(let n=0;n<D(this,ie,"f").length;n++){const o=D(this,ie,"f")[n];if(((i=o==null?void 0:o.wheel)===null||i===void 0?void 0:i.call(o,t))===!1)return}},yo=function(t){var i;for(let n=0;n<D(this,ie,"f").length;n++){const o=D(this,ie,"f")[n];if(((i=o==null?void 0:o.wheelScale)===null||i===void 0?void 0:i.call(o,t))===!1)return}},wo=function(t){var i;for(let n=0;n<D(this,ie,"f").length;n++){const o=D(this,ie,"f")[n];if(((i=o==null?void 0:o.scrollX)===null||i===void 0?void 0:i.call(o,t))===!1)return}},po=function(t){var i;for(let n=0;n<D(this,ie,"f").length;n++){const o=D(this,ie,"f")[n];if(((i=o==null?void 0:o.scrollY)===null||i===void 0?void 0:i.call(o,t))===!1)return}},bo=function(t){var i;for(let n=0;n<D(this,ie,"f").length;n++){const o=D(this,ie,"f")[n];if(((i=o==null?void 0:o.resize)===null||i===void 0?void 0:i.call(o,t))===!1)return}},zs=function(t){var i;for(let n=0;n<D(this,ie,"f").length;n++){const o=D(this,ie,"f")[n];if(((i=o==null?void 0:o.clear)===null||i===void 0?void 0:i.call(o,t))===!1)return}},Ls=function(t){var i;for(let n=0;n<D(this,ie,"f").length;n++){const o=D(this,ie,"f")[n];if(((i=o==null?void 0:o.beforeDrawFrame)===null||i===void 0?void 0:i.call(o,t))===!1)return}},Es=function(t){var i;for(let n=0;n<D(this,ie,"f").length;n++){const o=D(this,ie,"f")[n];if(((i=o==null?void 0:o.afterDrawFrame)===null||i===void 0?void 0:i.call(o,t))===!1)return}},Qt=function(){const t=[],i=D(this,Je,"f");D(this,Qi,"f").forEach(n=>{const o=i.get(n);(o==null?void 0:o.status)==="enable"&&(o!=null&&o.middlewareObject)&&t.push(o.middlewareObject)}),ot(this,ie,t,"f")};const $a="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAoCAYAAACM/rhtAAAACXBIWXMAAAsTAAALEwEAmpwYAAAF92lUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4gPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iQWRvYmUgWE1QIENvcmUgNi4wLWMwMDYgNzkuMTY0NzUzLCAyMDIxLzAyLzE1LTExOjUyOjEzICAgICAgICAiPiA8cmRmOlJERiB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiPiA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtbG5zOmRjPSJodHRwOi8vcHVybC5vcmcvZGMvZWxlbWVudHMvMS4xLyIgeG1sbnM6cGhvdG9zaG9wPSJodHRwOi8vbnMuYWRvYmUuY29tL3Bob3Rvc2hvcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RFdnQ9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZUV2ZW50IyIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgMjIuMyAoTWFjaW50b3NoKSIgeG1wOkNyZWF0ZURhdGU9IjIwMjMtMDktMTdUMTY6MDc6MjYrMDg6MDAiIHhtcDpNb2RpZnlEYXRlPSIyMDIzLTA5LTE3VDE2OjEyOjUwKzA4OjAwIiB4bXA6TWV0YWRhdGFEYXRlPSIyMDIzLTA5LTE3VDE2OjEyOjUwKzA4OjAwIiBkYzpmb3JtYXQ9ImltYWdlL3BuZyIgcGhvdG9zaG9wOkNvbG9yTW9kZT0iMyIgcGhvdG9zaG9wOklDQ1Byb2ZpbGU9InNSR0IgSUVDNjE5NjYtMi4xIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOjliMGM0MzI2LWU4ZTQtNDlkNy04MmUzLTgxODkwYTE2ZmU1YSIgeG1wTU06RG9jdW1lbnRJRD0iYWRvYmU6ZG9jaWQ6cGhvdG9zaG9wOjMzOGFhZDBmLWZkZjMtODE0MS1iMTZmLWNiZWIzNTQyYTJhMCIgeG1wTU06T3JpZ2luYWxEb2N1bWVudElEPSJ4bXAuZGlkOjUwODAxNzc1LWZlNGEtNDQyMy05NDQ3LThkYWRhNzZhYTllOSI+IDx4bXBNTTpIaXN0b3J5PiA8cmRmOlNlcT4gPHJkZjpsaSBzdEV2dDphY3Rpb249ImNyZWF0ZWQiIHN0RXZ0Omluc3RhbmNlSUQ9InhtcC5paWQ6NTA4MDE3NzUtZmU0YS00NDIzLTk0NDctOGRhZGE3NmFhOWU5IiBzdEV2dDp3aGVuPSIyMDIzLTA5LTE3VDE2OjA3OjI2KzA4OjAwIiBzdEV2dDpzb2Z0d2FyZUFnZW50PSJBZG9iZSBQaG90b3Nob3AgMjIuMyAoTWFjaW50b3NoKSIvPiA8cmRmOmxpIHN0RXZ0OmFjdGlvbj0ic2F2ZWQiIHN0RXZ0Omluc3RhbmNlSUQ9InhtcC5paWQ6OWIwYzQzMjYtZThlNC00OWQ3LTgyZTMtODE4OTBhMTZmZTVhIiBzdEV2dDp3aGVuPSIyMDIzLTA5LTE3VDE2OjEyOjUwKzA4OjAwIiBzdEV2dDpzb2Z0d2FyZUFnZW50PSJBZG9iZSBQaG90b3Nob3AgMjIuMyAoTWFjaW50b3NoKSIgc3RFdnQ6Y2hhbmdlZD0iLyIvPiA8L3JkZjpTZXE+IDwveG1wTU06SGlzdG9yeT4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRmOlJERj4gPC94OnhtcG1ldGE+IDw/eHBhY2tldCBlbmQ9InIiPz7W6XrzAAAGLklEQVRYhb2Xf2iUdRzHX/txtfXLplZ6Wblm6fzRmG6r7Uou1AxKRjQKYUqgaLBACFogppcK1h8aLRkMSYaJIA5hYMomZpskEfPOufCaDpZ6t7rbre263U3vzn3643meu+eu3XNzvz7w4bbdc/e89nl/Pu/v50HUCAQCx1tbW0uAx4CHgSwggxkKERkziUQif2mQ0WjU53a7vwSeBB4BTEDmTICmBBwYGDivVlDjlFAo9KvT6dwIPAHkANkq6MwDXr169bCISENDg9TX14s+BgcHf2hubi5mBmRPCXj06NFPREQ6OjoEkPLycrl06VIMMhKJeFwu1xdMs+wpAYuLi9eIiIyOjkpeXp4AAsj27dvF7/fHQIPB4C9dXV0fME2ypwQEXvX7/bdFRNauXRsDBMRkMsnhw4cTZB8YGGhsamp6hSmW3Qhw1Y0bN86LiNTW1iYAallWViZtbW162ftcLtdO/i/7tAAWtba2ficicvLkyTEBtdy6dasMDg7GQIeHh9s7OzvfBx5nkrIbAS7du3fvxyIiPT09hoBa1tXVJcv+fWNj4zLgUeAhJiC7EeDLwOsiMioisnDhwnFBrlixQi5evKiX/c6tW7c+R5E9lweU3QjwReDV/v7+bhGRqqqqcQFquWnTJvH5fHrZLzocjkoSZU9bTSPA54GV165daxYROXDgwAMBannw4MFk2RsaGhqWME7ZjQDNwIrTp09/JSLS0tIyIUBACgoK5MKFCzHIcDj85+3btz8FZpFGdiPAZ4DCmpqaTSIiPp9vwoBaVlVVidfr1ct+/sqVK+9iILsR4FzgJcASDoeHRUSKioomDQnI/v37E2T3+Xz1hw4dWjSW7EaAeUA+UNbX12cXEdmyZcuUAAJiNpvlzJkzetl73G53rVrN2EmUCjATuA9EgYjL5eoGKCkpGatNHijmz5/Pxo0b2blzJ2azOfZ3k8lUYDabv45Go/Y7d+6sIY0VZQOjGqDT6bxeWlrKqlWrJgRlsVhYv349FRUVWCwWcnJyEt4PBoOuoaEhu9frvdzR0fHTtm3buolvRpLqe3OBp4EllZWV74mIRKNRyc3NTSvf7Nmzpbq6Wk6cOCFut1uSY2RkJOB0Ou3Nzc3Ha2trPwPWAGXAEuBZFFPPAbKMevBhYA6wCKgIBoP9IiKrV682hLPZbP8DEpH7vb29N1paWn602WwHFyxYsAX4EKgE3gIsQBFQgOIeT6j3z0wFqEkc60OPx9Odn58/t6SkhPb29jFLbrVa2bNnDwBer7fv5s2bPQ6Ho7upqcnZ1tbmASJq3gPC6utdYESXYfWeo6mkBaUHRQ/odrv/yM/Pt5SWlqb8kAbncDh+W7lyZYN683u6DOvAwipsOOnniA4wZf9lqhdoVYzY7fbrQMpBsdlsWK1WRkZGAtXV1d8D/wA+wKNLr5o+YEC9ZggIAEHiFbyfDhCUCcoFngIWFxYWrtMaat68eQl9V15eHmu2+vr6OuAd4A2gGFgMLERp/mdQ+noWyuadi9Jr2aQ4k42GBPXDs1Ga97WhoaFbIiIbNmxIANTWq87Ozp9VuApgGfACihPkoRjwI+p3mlSgtA9ZRkYNYwwKJBr2rl27sFqthEKhwZqamqOAX5f/AsPE5btLvM/GJWO6yFb/82eBonPnztWJiJw9e1YAWb58eUzaI0eOfAO8CbwCPIfiZZN+eEoncSaKLPOApbt3794uIuL1ehOktdvtF4C3gRKURXcOSn9lTRRsvIAZKI4+l/gjQFREZMeOHSIiEggE+tetW/cRitkuRhmERxnnxjxZQFDWnzzURwCv1+vUHxHHjh37lri0C1Am9KGpgDMC1G8SQnxxCHs8Hqf2RldX10+bN28+i+JjwyT62KSaP13oAfWTHO7t7f0dIBQK/b1v375GlEnVjPYuyoQaHlNTDahVMALca29vdwBcvnz5+KlTp26OATft1UuODBS7yEOxj0K/329HOSWWopjxlE1tchhtM7FriPfgXSDDbrfXo0gbJr4QzIi0WiRPYBbKZJrUV23b0dYn7XSYcsBkS9EiO/k6lApq1cwiPjzaAM1Y9cYC1G6uAWrPCtrvMwoHqU02Q5caIEzj1KaS+D+vIjxtLug31gAAAABJRU5ErkJggg==",Ts="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAApCAYAAABHomvIAAAACXBIWXMAAAsTAAALEwEAmpwYAAAF92lUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4gPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iQWRvYmUgWE1QIENvcmUgNi4wLWMwMDYgNzkuMTY0NzUzLCAyMDIxLzAyLzE1LTExOjUyOjEzICAgICAgICAiPiA8cmRmOlJERiB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiPiA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtbG5zOmRjPSJodHRwOi8vcHVybC5vcmcvZGMvZWxlbWVudHMvMS4xLyIgeG1sbnM6cGhvdG9zaG9wPSJodHRwOi8vbnMuYWRvYmUuY29tL3Bob3Rvc2hvcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RFdnQ9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZUV2ZW50IyIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgMjIuMyAoTWFjaW50b3NoKSIgeG1wOkNyZWF0ZURhdGU9IjIwMjMtMDktMTdUMTY6MzE6MjMrMDg6MDAiIHhtcDpNb2RpZnlEYXRlPSIyMDIzLTA5LTE3VDE2OjQ0OjIyKzA4OjAwIiB4bXA6TWV0YWRhdGFEYXRlPSIyMDIzLTA5LTE3VDE2OjQ0OjIyKzA4OjAwIiBkYzpmb3JtYXQ9ImltYWdlL3BuZyIgcGhvdG9zaG9wOkNvbG9yTW9kZT0iMyIgcGhvdG9zaG9wOklDQ1Byb2ZpbGU9InNSR0IgSUVDNjE5NjYtMi4xIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOjY0MTBhYjUzLWM0ZjEtNDVhNS04MjhkLTIxOTczOWFjOTk3MSIgeG1wTU06RG9jdW1lbnRJRD0iYWRvYmU6ZG9jaWQ6cGhvdG9zaG9wOjBkMDNmNjM5LTE5MzctY2Y0MC1hMTg0LTIyMjg0NzczNWNmYSIgeG1wTU06T3JpZ2luYWxEb2N1bWVudElEPSJ4bXAuZGlkOjgyYjQwZGRmLWE0ZGEtNDY3MC1iYzc2LTBhYjY3ZmI5M2I0ZSI+IDx4bXBNTTpIaXN0b3J5PiA8cmRmOlNlcT4gPHJkZjpsaSBzdEV2dDphY3Rpb249ImNyZWF0ZWQiIHN0RXZ0Omluc3RhbmNlSUQ9InhtcC5paWQ6ODJiNDBkZGYtYTRkYS00NjcwLWJjNzYtMGFiNjdmYjkzYjRlIiBzdEV2dDp3aGVuPSIyMDIzLTA5LTE3VDE2OjMxOjIzKzA4OjAwIiBzdEV2dDpzb2Z0d2FyZUFnZW50PSJBZG9iZSBQaG90b3Nob3AgMjIuMyAoTWFjaW50b3NoKSIvPiA8cmRmOmxpIHN0RXZ0OmFjdGlvbj0ic2F2ZWQiIHN0RXZ0Omluc3RhbmNlSUQ9InhtcC5paWQ6NjQxMGFiNTMtYzRmMS00NWE1LTgyOGQtMjE5NzM5YWM5OTcxIiBzdEV2dDp3aGVuPSIyMDIzLTA5LTE3VDE2OjQ0OjIyKzA4OjAwIiBzdEV2dDpzb2Z0d2FyZUFnZW50PSJBZG9iZSBQaG90b3Nob3AgMjIuMyAoTWFjaW50b3NoKSIgc3RFdnQ6Y2hhbmdlZD0iLyIvPiA8L3JkZjpTZXE+IDwveG1wTU06SGlzdG9yeT4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRmOlJERj4gPC94OnhtcG1ldGE+IDw/eHBhY2tldCBlbmQ9InIiPz57vRudAAAEk0lEQVRYhe3ZW0jbVxzA8e8/MX+NYnG9uI4xE3bvoLt0FzradRfGBtsYo32YdAhb6WQyBqV7KOylpYjzZShDGfjmyxgbgjjwyRm16SYMhgiNKDhbL3VtNF4xJOnf3x7+59i/Wf4aTbInf3AwJMdzPjnnf/n9/jFEhGzDMIxMb3uAIsDs6ek5urS05Dtz5syE+uwekAQS6u89YD19gC0NIpJ1c8GZQHlXV9fJRCIxGo/HxxoaGj4CngWOAEGgEihXfT07MeQC3MB1dna+lkgkRkXF6urq3xcuXPgUOAE8DzwGPOiGLARwEy4ej4+JiITD4elr167NiIgsLi7eqq2trQPeBI4Bj7sh8w10xZmmeds0zdn+/v5/RERisdjUuXPnvgLeAl50Q+YTaAA+oKy7u/uE3laNAwSQ4uLiu6FQ6G4G5DG13YeAMjWWkU+gBygJhULHNe769etTTpwDGXUiz58//yXwujp5qoAHgBLAk0+gNxKJHEulUiMKN2ma5gwgPp/vjhOXjlxYWJisq6urBV5RW30IKAW8eQPGYrGjlmXdEBEZHBy8aZrmFCCmac729fVtAHt7e6MO5N2+vr47IiJLS0s3L126dBZ4Sh2LZUBRwVdwYGBgVuwOYh/zsoF0bnPBVzDTMRgOh6dFhROokSIi8/Pz0+pEeaPQx+DGWdzV1XVSX2LcgCIic3NzMzU1NV8D7wIvq9WrLNRZvOk62NHRccqJTAdGo9Hb1dXV3wAfYt9VjgAPFfI66EQWAxU9PT0fuwEvXrzYBJwF3gFeAAJAhfrfrO4k/7lxZxnr2JlJqry8POnWyePx6H4JR0vhktVkHGOXQI20SkpKLLcOhmGsA5YCaZiVLS5XoADi9XpdkznDMERhnE0fCgUHZhvOW+CO4/8A5hR7wFxjD5hr7AFzjZyBlmVlrOYdYaS1HUUuQA/gWV9fd51URDyqn1c1j6MVFGjoidfW1oq2ABrYj0V82OmVzwHNajVdB88C5wOKTdM87NaxsrKyQsFKHC2BnTDo+/TWt8Bd5INeVC44NDT0xXYZdXNz8w/AaeyS8yjwCPdzQu92ht2m/OUjIyOfS1pkAoqItLS0fA+8D7wKPA0cxs6qC1O4T0xMfKYnb21tnXEDNjc3z+nXbW1t3wFvYz9dCAL7KUThHovFPtGTNjU1jQFSX18/lg68cuXKLUAaGxs3vkB7e/u3wHHgCQpUdnpTqdQvesJgMDisUVevXh3Xry9fvnxTv66qqprQ/cfHx/vVNj/J/couv0DAv7q6+pMDeYPNSalkwkUikX7s4ukl4FHgAODPN1CXnPsWFxd/dCAjW+GGhoZCwAfYpeczwMPAPjVW3gv3IvXN98disZ8dyBGNCwQC4/r94eHhfuy6+JS6zATUCeJXY+W9cNfIUuDAwsLCr05kIBDYeBQ8Ojr6h8Lpx25BtbWlGpfv62BG5PLy8m+SFpOTk38C76mVe84NVyhgOvLgysrK7xoXjUb/Uqt2XG1rEDiYCbcd0MgwsWtk+J1EI03An0wmw5Zlefx+/2n1eRKIO5r+rWTTpFsZ/gWFrGMmeObuqwAAAABJRU5ErkJggg==",Qa="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAApCAYAAABHomvIAAAEvUlEQVRYhc2Y20/cVRDHP8v+uKzAWkpDCtZq8BYhJkq8PBoJxgj7I2m0ryaSyFN9IT74pI8+8WJiggRj/APApFkSTGRJ+qKGUiyxbGPEWsUSuVhYC12Wy8+HmeMeYPe3d3WSye/k/M7le+bMzJkZ+J9ToEJreGVYN+vihcytstjQocUlAw0WCSoIVCv3Ae8CXwIt+u8XHVeOG8qLqgAHqAFCQCNwGugCthBJGd7S/tM6LqTzHI5KuqzgaoAHgEvAtwrkG2AG8FzXvep5nue67lX9N6P/PR1/SefXlBtkFXKNDUA/RyX1D9uUbYzOb9D1ygbSQU7eDMxhSSsSiVz3AxiJRK57nuf19/fPad8coqONFCBJPyUOIKc1OvcbgiY9ICDT8+0DHge2gR0gBeyTtviM5HeKAGlrrfMZVwhdAVaAr4F3KNF4gkA9cBbowOc68+3LwDn1Mhdy4/OcYk54nPr6+m54nofruvPa9SFQ6wfQTweNgTwInAGuQWk6mEUvHwb+Au4Dexx7ffK9+0q+CHWIBIOZ9skHYKWfK9tQ8gZoLDjIyWCg3ORY+2T8aYOyg4EaRIFrkCs4QU1NTSvabC20zyIDzuyfkYzEahHX8jHwE/LwXwHeJ4P7KIVIu5ouxFDC+HgLAy4MfEF2v1UpgOezATSiNVf6EvAWsD01NXVtdnb2bk9Pz81sp/q3KIi8t83Ae4DX0tJy0z7t8PDwD4FAYIX/WILVwKMAzc3Nu/agoaGhzmg0ugcsV0hIvlSNoH8IuIiebHJycrls4sotwaxGYvueAPAjEg3jum79yMjIr5WUjFLOxMpBIopWoBN4GfhOJ+4NDg4ulVt6i4uLm7r+BvAscA4fCXrAAfJQJ5Fg8gPgMuCMjo62d3V1LW1sbKRKlpXSxMTEmjZ/5qQrOwHwUAGmkIjiHhJdfKrM/Pz8Y+3t7RvT09Ob5QAYi8X2tbmke2cEZwAaCdoAt5QvIzEbiUSitbe3tyoej++UCnBhYSGkzdu6d1aQxkgOkfwgieQMCeCu8iwSnpNKpcIdHR3BZDJ5UCy4SCSyvL6+/giiSou67wE+eYmhAKKkIaAJUdynkdflNcQF3dFTpooxjmg0aozDAz4DXkB8bxPy1OYM7QzIOuAU0AY8pQu9CrwJ3AK8UCj0RyHgZmZmli1w3wOvAM/oHo1kiZiygbSDh7PAE8DzQA/wBqKnnuM4a2NjY7dygbtw4cICRy31deBFJA09o7eWsU7kJ1KTLJmyRyOSn5zS70fAkwBtbW2/DwwMHHR3d9d3dnY2rK6u7o2Pj2/GYrH9eDzurK2tndM1vwI+QXT7T2BTD5skQz6SCyAcLRoZkGEFGQbeRqpbubK+BPA5MI14h00L3I6Cy2h4+eQbJsKuRa6iQcGFFfB5oBt4DpFsI+Ky7iDBxW3gBhBH/GtC+R7i1lKk3UxRAG2QpvxWr0AbtB3SA5jkx36djH/dVlDbyibN3M8GDvJPyI2PSulixm/u6kZ1OQCaJ/S+tndJX6tvsFBIxcCUdA3vW5ubxMrObc0hDMhd/Rqp5QQHxeW8dubnHGM7tzVv/IECMlxQ/bpcRfRMqaNRheNcUGG9XFWDACfzWs/6Fl3t/xtO//8gpbCORQAAAABJRU5ErkJggg==",Za="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAoCAYAAACM/rhtAAAER0lEQVRYhe2YT2hjRRjAf8lL22xsNsm6EWKrSKvuIkIh+O9QRFxEW18KUsoe7FHoRaWCN1FPetOrIHgVKS0q9P5OxaJbodkalgVrtVZjS7Ntd02z6abPw3yzmaT585q+elj2g2HmvZn35jffN/PNNwP35R6XgM/fuif4n+dO2klQvgsaZRc4NJJvoJbHdhrIAkJAN2ADHwFfAw9J3ZoB/b9I0AA6A0SBc0Aa2EVpSqddeZ+QdmfkO+u0gIPSQQR4HfhRQH4AHMDNZDJXXNd1M5nMFalzdB3wJTAOPAD0yEB9066G6wXepVZTd5MpTdporZ6jVqsatmMJoTR3HvgJQ1u2bS+3ArRte9l1XXdsbGyJo1pdBN6Wf3d3ChlAmSQO9LeC8fquQRpDWaerHWSjSr1iu4BkJyOsF9u2s67rkslkluTVxygltAVsJBZqdCngEj5osIlW+4EYytRNF04jeu3vulCT+7QkLH20dEOhumft97pQI4s3+iiRSPwtxVSbd39J8eEGvzFXc1NAs8KSFAZeBt4AHgNeBFDWObkEAne7HAK2gT2gCFQatdca1GbtBj4E3veFprVYVLXXcg4GqM6588BbAMlkcm1qamqzr6/v6ikBet5RgiizJoDPAXdgYGDZXHkzMzPrrk9CdRWngUeAsxxdCzVwpgZ/BigWiz1mo4mJif7jqMajeJrU5hywgGvAej6fvzA0NLThN1Eul9uT4g5VTbYFNKUIfAbsZ7PZvuHh4Wt+As7Ozu5IcY2j219TQB0NV4A7qODgO4CFhYWLg4ODOb8AHccpG4A68m6pRQ1YAQ6A28A+8BXwBcDq6upTqVTquh+AuVyuW4q/opRRaQdZD1gCbgE3ge+BT4HdfD7/ZDwe/z2bzRY6hRsfH1/e3Nx8FDX/sgbgoZfvg6jo4ixqW7oIPA+8CrwHrAJuJBLJd+JaHMf5k6qmPgGeQe1SCenXk0/U21xcIC8AzwGvAJPAEuAmEon1xcXFba9w8/Pz5oqdB14CnpY+oij35km0qwmjwqAU8ISM9hIwBeQA17KsG9PT07+1gxsZGdmgdqW+BjwLDAAPoo4ALU+W9arVwWoIpXp9kouKZpPAO8AwQCwW+2d0dLQ0OTkZSafT0UKhUJ6bm9t2HKeysrIS3tra0g7+KvABUJC0g5rrJdRcbLpImtleRzYashc1P2OSXwbebDVykX3gW+Ab1AHqhuQ3pe6AJlFMO0CoPROHDcio5I8DL1A9C8dQbmod+APYAK4DvwjQnsDdErgyVTfTEaCG1GFYGHXG7TVSo2OkdvhlAflXoHSuNdfStFqaRhEi2kfdprrj6M5LAt0I8EDaaMdflPal48CB95hMr3Bt8h4jD0kyL5E0pN6dysZzW7N2AqjbmhdIZjJvufTOpE19x3g+9s1XJ/ck5tVbfdhu+rxDfLiSO+lFToCjZwrXyH2/0Lwv95z8B1jAqXmDnj4YAAAAAElFTkSuQmCC",Ja="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAoCAYAAACM/rhtAAAIiklEQVRYhe2YW2yUxxmGn7W96zXGNnZsr2FJHQyYBHNIU1ttAqVUVjlJUAtxQyUXhKgQktUDdSUkuEDtBVJ9UQXRC0RJRblrq/SCIARpFImWQ8VBIZQinJpQYozNyWaxiw/rfXsx3+z+6xNOe9tPGv2nOTzzffPPvDMhSXwJC1nKAXIDV/9ellLAqF1T9o5A2Ry7J5A/Fbh3mUMh8qYJ5kHCQATID6QIkBcAHAVGgKFAStq33EB53/ao5Rm064i9g0CmqcDyrNICYCZQBJTYdaa9j1jelDUwCAwAz4F+ex61DhZauXzr1CDwDHhq1wFg2Do1KWAo0NsCAyoDKoGYXcuBWdZY1PKnzAsDQB/wBOg1yKTVN8vqmoHz6nOgC7gHdFrbCasrNRFgyMCj5qVXgDlANfAaMA/4ir2rMI+MtSHgEdAN9BjsiNVZYR0sNq8+AtqB69Z2MuDBcYA+pAXW0yoDWgTUWXrd8k1l+cBcSxjIIBlPB63G8uUB/8Z57znwAkgGAX1YC4BSK7QIWA7UWwoDJJNJzp49y4ULF2hvb6e7u5tEIkFhYSGVlZXMmzePhoYGNmzYQElJCVZv2tPt7e3s2bOHvr4+9u3bx/r16+PWjg/zQ9x4BEk+5UkqklQt6ZuSdkn6jaRbMhsYGFBbW5uWLVvmp5MpU3V1tVpbW9XV1aWgbdy4MZ2npqbGvx6W9DtJ35e0RFJREDBX0gxJcUnfkPQDScck3fGlz549q7q6ummBjU2xWEzvvfdeGvCtt95Kf6uoqAiyfyBpt6SvSZrlAUOSIpLKJS2X9D1Jv5Z025d69913FQqFJmy8rKxMS5YsUUNDg5YvX67Zs2dPCrpjxw6NjIxoxYoV6XdVVVVBwI8l/UTS1yWVesBcC+18SRsk/ULS33yJtra2CRtramrSiRMn1NXVpWQyKUlKpVJ6+vSpTp48qZ07dyo/P39cua1bt6q+vn4ywL9IapX0tqQyDxiRFDPq3ZL+JCklSadOnRrXwMKFC3X69GlNx65du6aVK1eOqyMYjTGAf50IsNC8t1FSm6TPJOn+/fuKxWJZFb/zzjvjBvx0bO/evQqHwxNG4mUe9MtYMZk5bwHA4cOH6enpSc9BixYt4uTJk5SVlflXfcBN4DFuapoHLPQfz58/z9WrVwmFQsTjceLxOHfv3uUlNlZcpFeMEtzsXg2QSCQ4duxYulQoFOLQoUNBuE7gvAE+x82b/VZHyblz52hsbCSZTL4MCGWrqUECq0gQsBi3ts4B+PDDD3n48GG61OrVq1mzZo1/fGZw54HbVmGV1bMAWPbRRx9NC24CwD7cajLiAXNwIS7ELW3lAGfOnMmqZPv27cHHvwM3gH8AnwH/wnn0C+AuwLZt25g/f/5L4cLhMNu2bfOPnbh1+xkZ9UMebvmKGmQEoLOzM11JQUEBK1eu9I/JAFAPTqnk4hTNY9xS1V5TU1N7+fJlOjo6SKXS+jPLJFFUVMTixYsxmJtW/inOi2nAXDI/C0BWeMvKyojFYv6xz1LCKhnCRSEBPMCFfBaQKi0tfb2+vn5qFzp7AnwCXAM+t45mAUJGfgMwOpoWtIRCWZ/89BB8TuJ+lG5cNEatkXYgjtN+BYG2ktaxBE4U3AP+iRsud3EeHCTwk6Ss0IhvtaKiIk3Q19dHb28vhYWF4H6mYtxwiBrQIE4aPTHgIVzoO3E/TzlOV4YD3/stj9eMPj2xzg4HAYMSPQnkxePxNGB/fz+XLl1iy5Yt4HTeq+aZTtyA9h18Yb33G6aRQBqyDiUNLihmH1q54LAZ9ZHKISPRn1loaGxsJGjHjx8PPi6xtAgnNufgVHcRmf1J2DpTiJsjvYout3c5gQ49Ns89s3fpOdB70I+Hx7iBXrV27VqKi4tJJBKAm3auXLmCDfpy4G3rZSHur/aSPg83BCpx24MFuNUlbnkHcGMubEDdxpG0lBn8AcBBsgfsVysqKti6dStHjhwBYGRkhJaWFs6dO0ckEgGYj9v0xIA71rkha7jUgBYCb5hHGRoaIj8/f4Z5s8jafUpmN/diLBwAkmZKWiipSdKvJN2VpI6ODhUVFWUt7Js2bdLAwMBYLdAt6VNJlyV9IumLsRkOHjyo2tparVixQrdvp2Xmn00YrJI0R05VBRV+GjAiqcoUxA8lnfI1HD16dJz6WLVqla5fvz4tFdPZ2anm5uas8s3Nzf7zp5J+LmmNpFcl5U8GmCupWFKtpO9K+qWkG76W3bt3j4OMRqNqaWnRhQsXNDQ0lAWVTCZ169YtHThwQFVVVePKtrS0+Kw3pgsYso+Vkuol7ZD0W0ldvsHW1tZJZXxtba0aGxvV1NSkdevWaenSpYpGoxPmXb9+vXp6ejzgx5J+ZiGeLSk8GaD34ky5Hd23JP1I0h8kPQmGu7y8/L/aNEUiEe3fv1/Dw8Pp6Es6KqlZ0puSXpHbVU4KiPVglqQFkr4j6aeSfi/pvq/13r172rVrlyorK6cFFo1GtXnzZl25ciU4Ch5J+qOkH0v6tqTXzDk5EwGGlNFjOWQOd8px4vUN4E3cpn2pz/jgwQPef/99Ll68yJ07d+jt7WVwcJBIJEJJSQlz586loaGBTZs2UVdXF5w0OoDLwFWcbPsct6r04+bRLHEYCoWyAD1kBDfHleHmsxrccccS3NFHNV/eenBy6iZwCycMOnHz5wBuDh2nyyY6H0zhFmoF7vtxk+l9q3ieQfrDo8msF7cy3cN56g7ZWnKcep7IxnrQmz+wHKu2K3EKJWbPpWSUTQ4ZtRJc23sC6ZGB9ZM52JwcboIQjzUvZvNxYfeHlyVkZFcBbux6wKA6ShjoM5yM8uH0Xpuy8ekAQuZc2W8P8nEei9p9mMmPgAfJHO0O27e0lHppw9MEDJo//A4eoE91iB48SJ80lFMB/t/+V/sPGZfTmtMFR4EAAAAASUVORK5CYII=";var Zi=function(e,t,i,n,o){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!o)throw new TypeError("Private accessor was defined without a setter");if(typeof t=="function"?e!==t||!o:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?o.call(e,i):o?o.value=i:t.set(e,i),i},ce=function(e,t,i,n){if(i==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof t=="function"?e!==t||!n:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return i==="m"?n:i==="a"?n.call(e):n?n.value:t.get(e)},Ee,Ji,ni,Ct,Yi,ft,Cs,Ds,it,So,Mo;class Ka{constructor(t,i){Ee.add(this),Ji.set(this,void 0),ni.set(this,void 0),Ct.set(this,null),Yi.set(this,null),ft.set(this,{auto:$a,"drag-default":Qa,"drag-active":Za,"rotate-0":Ts,rotate:Ja}),Zi(this,ni,t,"f"),Zi(this,Ji,i.eventHub,"f"),ce(this,Ee,"m",Cs).call(this),ce(this,Ee,"m",Ds).call(this)}}Ji=new WeakMap,ni=new WeakMap,Ct=new WeakMap,Yi=new WeakMap,ft=new WeakMap,Ee=new WeakSet,Cs=function(){const t=ce(this,Ji,"f");ce(this,Ee,"m",it).call(this,"default"),t.on("cursor",i=>{var n;i.type==="over-element"||!i.type?ce(this,Ee,"m",it).call(this,"auto"):i.type==="resize-rotate"?ce(this,Ee,"m",it).call(this,"rotate"):typeof i.type=="string"&&(!((n=i.type)===null||n===void 0)&&n.startsWith("resize-"))?ce(this,Ee,"m",So).call(this,i):i.type==="drag-default"?ce(this,Ee,"m",it).call(this,"drag-default"):i.type==="drag-active"?ce(this,Ee,"m",it).call(this,"drag-active"):ce(this,Ee,"m",it).call(this,"auto")})},Ds=function(){nn(Ts).then(t=>{Zi(this,Yi,t,"f")}).catch(t=>{console.error(t)})},it=function(t){if(ce(this,Ct,"f")===t)return;Zi(this,Ct,t,"f");const i=ce(this,ft,"f")[ce(this,Ct,"f")]||ce(this,ft,"f").auto;let n=0,o=0;(t.startsWith("rotate-")&&ce(this,ft,"f")[ce(this,Ct,"f")]||t==="rotate")&&(n=10,o=10),t==="default"?ce(this,ni,"f").style.cursor="default":ce(this,ni,"f").style.cursor=`image-set(url(${i})2x) ${n} ${o}, auto`},So=function(t){var i;let n=0;t.type==="resize-top"?n+=0:t.type==="resize-top-right"?n+=45:t.type==="resize-right"?n+=90:t.type==="resize-bottom-right"?n+=135:t.type==="resize-bottom"?n+=180:t.type==="resize-bottom-left"?n+=225:t.type==="resize-left"?n+=270:t.type==="resize-top-left"&&(n+=315),n+=Be(((i=t==null?void 0:t.element)===null||i===void 0?void 0:i.angle)||0),Array.isArray(t.groupQueue)&&t.groupQueue.length>0&&t.groupQueue.forEach(s=>{n+=Be(s.angle||0)}),n=Be(n);const o=ce(this,Ee,"m",Mo).call(this,n);ce(this,Ee,"m",it).call(this,o)},Mo=function(t){const i=`rotate-${t}`;if(!ce(this,ft,"f")[i]){const n=ce(this,Yi,"f");if(n){const o=document.createElement("canvas"),s=n.width,r=n.height,a={x:s/2,y:r/2};o.width=s,o.height=r;const c=o.getContext("2d"),l=et(t);c.translate(a.x,a.y),c.rotate(l),c.translate(-a.x,-a.y),c.drawImage(n,0,0,s,r),c.translate(a.x,a.y),c.rotate(-l),c.translate(-a.x,-a.y);const d=o.toDataURL("image/png");ce(this,ft,"f")[i]=d}}return i};const $n="change",be="SELECT",re=Symbol(`${be}_actionType`),rt=Symbol(`${be}_resizeType`),mi=Symbol(`${be}_areaStart`),yi=Symbol(`${be}_areaEnd`),at=Symbol(`${be}_hoverElement`),Xt=Symbol(`${be}_hoverElementVertexes`),ht=Symbol(`${be}_selectedElementList`),qa=Symbol(`${be}_selectedElementListVertexes`),St=Symbol(`${be}_selectedElementController`),Mt=Symbol(`${be}_selectedElementPosition`),xt=Symbol(`${be}_selectedReferenceXLines`),At=Symbol(`${be}_selectedReferenceYLines`),ze=Symbol(`${be}_groupQueue`),wn=Symbol(`${be}_groupQueueVertexesList`),wi=Symbol(`${be}_isMoving`),pn=Symbol(`${be}_enableSelectInGroup`),pi=Symbol(`${be}_enableSnapToGrid`),_s=2,el=4,Os=1,di="#1973ba",xo="#5b5959b5",Ws=10,tl="#f7276e",Fi="@middleware/select",Ki="@middleware/select-clear",Cn="@middleware/select-in-group",Dn="@middleware/snap-to-grid";function st(e,t,i){const{borderColor:n,borderWidth:o,background:s,lineDash:r}=i;e.setLineDash([]),e.lineWidth=o,e.strokeStyle=n,e.fillStyle=s,e.setLineDash(r),e.beginPath(),e.moveTo(t[0].x,t[0].y),e.lineTo(t[1].x,t[1].y),e.lineTo(t[2].x,t[2].y),e.lineTo(t[3].x,t[3].y),e.lineTo(t[0].x,t[0].y),e.closePath(),e.stroke(),e.fill()}function _n(e,t,i,n){const{borderColor:o,borderWidth:s,lineDash:r}=n;e.setLineDash([]),e.lineWidth=s,e.strokeStyle=o,e.setLineDash(r),e.beginPath(),e.moveTo(t.x,t.y),e.lineTo(i.x,i.y),e.closePath(),e.stroke()}function il(e,t,i){const{size:n,borderColor:o,borderWidth:s,background:r}=i,a=t,c=n/2,l=c,d=c;if(l>=0&&d>=0){if(typeof s=="number"&&s>0){const f=s/2+l,u=s/2+d;e.beginPath(),e.strokeStyle=o,e.lineWidth=s,e.circle(a.x,a.y,f,u,0,0,2*Math.PI),e.closePath(),e.stroke()}e.beginPath(),e.fillStyle=r,e.circle(a.x,a.y,l,d,0,0,2*Math.PI),e.closePath(),e.fill()}}function $e(e,t,i){const{borderColor:n,borderWidth:o,lineDash:s}=i;e.setLineDash([]),e.lineWidth=o,e.strokeStyle=n,e.setLineDash(s),e.beginPath(),e.moveTo(t[0].x,t[0].y),e.lineTo(t[2].x,t[2].y),e.closePath(),e.stroke(),e.beginPath(),e.moveTo(t[1].x,t[1].y),e.lineTo(t[3].x,t[3].y),e.closePath(),e.stroke()}function Ao(e,t,i){const{size:n,borderColor:o,borderWidth:s,lineDash:r}=i,a=t.x-n/2,c=t.x+n/2,l=t.y-n/2,d=t.y+n/2;$e(e,[{x:a,y:l},{x:c,y:l},{x:c,y:d},{x:a,y:d}],{borderColor:o,borderWidth:s,lineDash:r})}function Io(e,t,i){if(!t)return;const n={borderColor:di,borderWidth:1,background:"transparent",lineDash:[]};st(e,xe(t,i),n)}function Ro(e,t,i){if(!t)return;const n={borderColor:xo,borderWidth:1,background:"transparent",lineDash:[]};st(e,xe(t,i),n);const{controller:o}=i;if(o){const{topLeft:s,topRight:r,bottomLeft:a,bottomRight:c,topMiddle:l,bottomMiddle:d,leftMiddle:f,rightMiddle:u}=o,v=Object.assign(Object.assign({},n),{borderWidth:1,background:xo});$e(e,xe(l.vertexes,i),v),$e(e,xe(d.vertexes,i),v),$e(e,xe(f.vertexes,i),v),$e(e,xe(u.vertexes,i),v),$e(e,xe(s.vertexes,i),v),$e(e,xe(r.vertexes,i),v),$e(e,xe(a.vertexes,i),v),$e(e,xe(c.vertexes,i),v)}}function Po(e,t,i){if(!t)return;const{hideControllers:n}=i,{elementWrapper:o,topLeft:s,topRight:r,bottomLeft:a,bottomRight:c,top:l,rotate:d}=t,f={borderColor:di,borderWidth:_s,background:"transparent",lineDash:[]},u=Object.assign(Object.assign({},f),{borderWidth:el,background:"#FFFFFF"});st(e,xe(o,i),f),n||(_n(e,N(l.center,i),N(d.center,i),Object.assign(Object.assign({},u),{borderWidth:2})),st(e,xe(s.vertexes,i),u),st(e,xe(r.vertexes,i),u),st(e,xe(a.vertexes,i),u),st(e,xe(c.vertexes,i),u),il(e,N(d.center,i),Object.assign(Object.assign({},u),{size:Ws,borderWidth:2})))}function nl(e,t){const{start:i,end:n}=t;e.setLineDash([]),e.lineWidth=Os,e.strokeStyle=di,e.fillStyle="#1976d24f",e.beginPath(),e.moveTo(i.x,i.y),e.lineTo(n.x,i.y),e.lineTo(n.x,n.y),e.lineTo(i.x,n.y),e.closePath(),e.stroke(),e.fill()}function ol(e,t){const{areaSize:i}=t,{x:n,y:o,w:s,h:r}=i;e.setLineDash([]),e.lineWidth=Os,e.strokeStyle=di,e.fillStyle="#1976d21c",e.beginPath(),e.moveTo(n,o),e.lineTo(n+s,o),e.lineTo(n+s,o+r),e.lineTo(n,o+r),e.closePath(),e.stroke(),e.fill()}function sl(e,t,i){for(let n=0;n<t.length;n++){const o=t[n],s={borderColor:di,borderWidth:_s,background:"transparent",lineDash:[4,4]};st(e,xe(o,i),s)}}function zo(e,t){const{xLines:i,yLines:n}=t,o={borderColor:tl,borderWidth:1,lineDash:[]},s=Object.assign(Object.assign({},o),{size:6});i&&i.forEach(r=>{r.forEach((a,c)=>{Ao(e,a,s),r[c+1]&&_n(e,r[c],r[c+1],o)})}),n&&n.forEach(r=>{r.forEach((a,c)=>{Ao(e,a,s),r[c+1]&&_n(e,r[c],r[c+1],o)})})}function ee(e){return e*Math.PI/180}function bi(e,t){return Math.sqrt(e*e+t*t)}function X(e,t){return t>0?Math.abs(e):0-Math.abs(e)}function On(e,t){const{ctx:i,viewScaleInfo:n,vertexes:o}=t,s=N(o[0],{viewScaleInfo:n}),r=N(o[1],{viewScaleInfo:n}),a=N(o[2],{viewScaleInfo:n}),c=N(o[3],{viewScaleInfo:n});return i.beginPath(),i.moveTo(s.x,s.y),i.lineTo(r.x,r.y),i.lineTo(a.x,a.y),i.lineTo(c.x,c.y),i.lineTo(s.x,s.y),i.closePath(),!!i.isPointInPath(e.x,e.y)}function Lo(e,t){const{ctx:i,viewScaleInfo:n,viewSizeInfo:o,groupQueue:s}=t;if(!s||!((s==null?void 0:s.length)>0))return!1;const r=Gn(s),a=r[r.length-1];return a?On(e,{ctx:i,vertexes:a,viewScaleInfo:n,viewSizeInfo:o}):!1}function Ht(e,t){var i,n,o;const s={type:null,elements:[],elementVertexesList:[],groupQueue:[],groupQueueVertexesList:[]},{ctx:r,data:a,calculator:c,selectedElements:l,viewScaleInfo:d,viewSizeInfo:f,areaSize:u,groupQueue:v,selectedElementController:g}=t;if(g){const{left:h,right:m,top:p,bottom:M,topLeft:w,topRight:y,bottomLeft:A,bottomRight:b,rotate:S}=g,R=[h,m,p,M,w,y,A,b,S];for(let j=0;j<R.length;j++){const O=R[j];if(On(e,{ctx:r,vertexes:O.vertexes,viewSizeInfo:f,viewScaleInfo:d})){s.type=`resize-${O.type}`,l&&(l==null?void 0:l.length)>0&&(s.groupQueue=v||[],s.elements=[l[0]]);break}}}if(v&&Array.isArray(v)&&v.length>0){const h=v[v.length-1];if(!((i=h==null?void 0:h.detail)===null||i===void 0)&&i.children&&Array.isArray((n=h==null?void 0:h.detail)===null||n===void 0?void 0:n.children))for(let m=h.detail.children.length-1;m>=0;m--){const p=h.detail.children[m],M=si(p,{groupQueue:v});if(M&&On(e,{ctx:r,vertexes:M,viewScaleInfo:d,viewSizeInfo:f}))return s.type||(s.type="over-element"),s.groupQueue=v,s.elements=[p],s}return s}if(s.type!==null)return s;if(u&&Array.isArray(l)&&(l==null?void 0:l.length)>1){const{x:h,y:m,w:p,h:M}=u;if(e.x>=h&&e.x<=h+p&&e.y>=m&&e.y<=m+M)return s.type="list-area",s.elements=l,s}if(a){const{index:h,element:m}=c.getPointElement(e,{data:a,viewScaleInfo:d,viewSizeInfo:f});if(h>=0&&m&&((o=m==null?void 0:m.operations)===null||o===void 0?void 0:o.invisible)!==!0)return s.elements=[m],s.type="over-element",s}return s}function rl(e,t){var i,n,o,s,r,a,c,l,d;let{x:f,y:u,w:v,h:g,angle:h=0}=e;const m=Fe({x:f,y:u,w:v,h:g,angle:h});h=Be(h);const p=et(h),M=!!(!((i=e==null?void 0:e.operations)===null||i===void 0)&&i.limitRatio),{start:w,end:y,resizeType:A,scale:b}=t;let S=Object.assign({},w),R=Object.assign({},y),j={x:S.x,y:m.y},O={x:R.x,y:m.y},W=Object.assign({},j),_=Object.assign({},O),k={x:m.x,y:S.y},U={x:m.x,y:R.y},K=Object.assign({},k),L=Object.assign({},U),T=(_.x-W.x)/b,Y=(_.y-W.y)/b,E=bi(T,Y),$=(L.x-K.x)/b,G=(L.y-K.y)/b,x=bi($,G);(h>0||h<0)&&(S=le(m,w,0-p),R=le(m,y,0-p),j={x:S.x,y:m.y},O={x:R.x,y:m.y},W=le(m,j,p),_=le(m,O,p),k={x:m.x,y:S.y},U={x:m.x,y:R.y},K=le(m,k,p),L=le(m,U,p),T=(_.x-W.x)/b,Y=(_.y-W.y)/b,E=bi(T,Y),E=X(E,Y),$=(L.x-K.x)/b,G=(L.y-K.y)/b,x=bi($,G),x=X(x,G));let Z=(y.x-w.x)/b,Q=(y.y-w.y)/b;if(M===!0){if(["resize-top","resize-bottom","resize-left","resize-right"].includes(A)){const P=Math.max(Math.abs(Z),Math.abs(Q));Z=(Z>=0?1:-1)*P,Q=(Q>=0?1:-1)*P/e.w*e.h;const z=Math.max(Math.abs($),Math.abs(G));$=($>=0?1:-1)*z,G=(G>=0?1:-1)*z/e.w*e.h;const I=Math.max(Math.abs(T),Math.abs(Y));T=(T>=0?1:-1)*I,Y=(Y>=0?1:-1)*I/e.w*e.h}else if(["resize-top-left","resize-top-right","resize-bottom-left","resize-bottom-right"].includes(A)){{const P=Math.abs(Z);Z=(Z>=0?1:-1)*P;const z=P/e.w*e.h;A==="resize-top-left"||A==="resize-bottom-right"?Q=Z>0?z:-z:(A==="resize-top-right"||A==="resize-bottom-left")&&(Q=Z>0?-z:z)}E=Math.abs(E),x=E/e.w*e.h}}switch(A){case"resize-top":{if(h===0)g-Q>0&&(u+=Q,g-=Q,((n=e.operations)===null||n===void 0?void 0:n.limitRatio)===!0&&(f+=Q/e.h*e.w/2,v-=Q/e.h*e.w));else if(h>0||h<0){let P=m.x,z=m.y;if(h<90){x=0-X(x,G);const I=ee(h),C=x/2;P=P+C*Math.sin(I),z=z-C*Math.cos(I)}else if(h<180){x=X(x,$);const I=ee(h-90),C=x/2;P=P+C*Math.cos(I),z=z+C*Math.sin(I)}else if(h<270){x=X(x,G);const I=ee(h-180),C=x/2;P=P-C*Math.sin(I),z=z+C*Math.cos(I)}else if(h<360){x=0-X(x,$);const I=ee(h-270),C=x/2;P=P-C*Math.cos(I),z=z-C*Math.sin(I)}g+x>0&&(((o=e.operations)===null||o===void 0?void 0:o.limitRatio)===!0&&(v=v+x/e.h*e.w),g=g+x,f=P-v/2,u=z-g/2)}break}case"resize-bottom":{if(h===0)e.h+Q>0&&(g+=Q,((s=e.operations)===null||s===void 0?void 0:s.limitRatio)===!0&&(f-=Q/e.h*e.w/2,v+=Q/e.h*e.w));else if(h>0||h<0){let P=m.x,z=m.y;if(h<90){x=X(x,G);const I=ee(h),C=x/2;P=P-C*Math.sin(I),z=z+C*Math.cos(I)}else if(h<180){x=0-X(x,$);const I=ee(h-90),C=x/2;P=P-C*Math.cos(I),z=z-C*Math.sin(I)}else if(h<270){x=X(x,$);const I=ee(h-180),C=x/2;P=P+C*Math.sin(I),z=z-C*Math.cos(I)}else if(h<360){x=X(x,$);const I=ee(h-270),C=x/2;P=P+C*Math.cos(I),z=z+C*Math.sin(I)}g+x>0&&(((r=e.operations)===null||r===void 0?void 0:r.limitRatio)===!0&&(v=v+x/e.h*e.w),g=g+x,f=P-v/2,u=z-g/2)}break}case"resize-left":{if(h===0)e.w-Z>0&&(f+=Z,v-=Z,((a=e.operations)===null||a===void 0?void 0:a.limitRatio)===!0&&(g-=Z/e.w*e.h,u+=Z/e.w*e.h/2));else if(h>0||h<0){let P=m.x,z=m.y;if(h<90){E=0-X(E,T);const I=ee(h),C=E/2;P=P-C*Math.cos(I),z=z-C*Math.sin(I)}else if(h<180){E=X(E,T);const I=ee(h-90),C=E/2;P=P+C*Math.sin(I),z=z-C*Math.cos(I)}else if(h<270){E=X(E,Y);const I=ee(h-180),C=E/2;P=P+C*Math.cos(I),z=z+C*Math.sin(I)}else if(h<360){E=X(E,Y);const I=ee(h-270),C=E/2;P=P-C*Math.sin(I),z=z+C*Math.cos(I)}v+E>0&&(((c=e.operations)===null||c===void 0?void 0:c.limitRatio)===!0&&(g=g+E/e.w*e.h),v=v+E,f=P-v/2,u=z-g/2)}break}case"resize-right":{if(h===0)e.w+Z>0&&(v+=Z,((l=e.operations)===null||l===void 0?void 0:l.limitRatio)===!0&&(u-=Z*e.h/e.w/2,g+=Z*e.h/e.w));else if(h>0||h<0){let P=m.x,z=m.y;if(h<90){E=X(E,Y);const I=ee(h),C=E/2;P=P+C*Math.cos(I),z=z+C*Math.sin(I)}else if(h<180){E=X(E,Q);const I=ee(h-90),C=E/2;P=P-C*Math.sin(I),z=z+C*Math.cos(I)}else if(h<270){E=X(E,Q);const I=ee(h-180),C=E/2;P=P+C*Math.cos(I),z=z+C*Math.sin(I),E=0-E}else if(h<360){E=X(E,Z);const I=ee(h-270),C=E/2;P=P+C*Math.sin(I),z=z-C*Math.cos(I)}v+E>0&&(((d=e.operations)===null||d===void 0?void 0:d.limitRatio)===!0&&(g=g+E/e.w*e.h),v=v+E,f=P-v/2,u=z-g/2)}break}case"resize-top-left":{if(h===0)v-Z>0&&(f+=Z,v-=Z),g-Q>0&&(u+=Q,g-=Q);else if(h>0||h<0){let P=m.x,z=m.y;if(h<90){x=0-X(x,G),E=0-X(E,M?0-x:T);const I=x/2;P=P+I*Math.sin(p),z=z-I*Math.cos(p);const C=E/2;P=P-C*Math.cos(p),z=z-C*Math.sin(p)}else if(h<180){x=X(x,$),E=X(E,M?x:T);const I=ee(h-90),C=x/2;P=P+C*Math.cos(I),z=z+C*Math.sin(I);const H=E/2;P=P+H*Math.sin(I),z=z-H*Math.cos(I)}else if(h<270){x=X(x,G),E=X(E,M?x:Y);const I=ee(h-180),C=x/2;P=P-C*Math.sin(I),z=z+C*Math.cos(I);const H=E/2;P=P+H*Math.cos(I),z=z+H*Math.sin(I)}else if(h<360){x=0-X(x,$),E=X(E,M?x:Y);const I=ee(h-270),C=x/2;P=P-C*Math.cos(I),z=z-C*Math.sin(I);const H=E/2;P=P-H*Math.sin(I),z=z+H*Math.cos(I)}g+x>0&&(g=g+x),v+E>0&&(v=v+E),f=P-v/2,u=z-g/2}break}case"resize-top-right":{if(h===0)v+Z>0&&(v+=Z),g-Q>0&&(u+=Q,g-=Q);else if(h>0||h<0){let P=m.x,z=m.y;if(h<90){x=0-X(x,G),E=X(E,M?x:Y);const I=ee(h),C=x/2;P=P+C*Math.sin(I),z=z-C*Math.cos(I);const H=E/2;P=P+H*Math.cos(I),z=z+H*Math.sin(I)}else if(h<180){x=X(x,$),E=X(E,M?x:Y);const I=ee(h-90),C=x/2;P=P+C*Math.cos(I),z=z+C*Math.sin(I);const H=E/2;P=P-H*Math.sin(I),z=z+H*Math.cos(I)}else if(h<270){const I=ee(h-180);x=X(x,G),E=X(E,M?x:0-T);const C=x/2;P=P-C*Math.sin(I),z=z+C*Math.cos(I);const H=E/2;P=P-H*Math.cos(I),z=z-H*Math.sin(I)}else if(h<360){x=0-X(x,$),E=X(E,M?x:T);const I=ee(h-270),C=x/2;P=P-C*Math.cos(I),z=z-C*Math.sin(I);const H=E/2;P=P+H*Math.sin(I),z=z-H*Math.cos(I)}g+x>0&&(g=g+x),v+E>0&&(v=v+E),f=P-v/2,u=z-g/2}break}case"resize-bottom-left":{if(h===0)e.h+Q>0&&(g+=Q),e.w-Z>0&&(f+=Z,v-=Z);else if(h>0||h<0){let P=m.x,z=m.y;if(h<90){x=X(x,G),E=0-X(E,M?0-x:T);const I=ee(h),C=x/2;P=P-C*Math.sin(I),z=z+C*Math.cos(I);const H=E/2;P=P-H*Math.cos(I),z=z-H*Math.sin(I)}else if(h<180){x=0-X(x,$),E=X(E,M?x:T);const I=ee(h-90),C=x/2;P=P-C*Math.cos(I),z=z-C*Math.sin(I);const H=E/2;P=P+H*Math.sin(I),z=z-H*Math.cos(I)}else if(h<270){x=X(x,$),E=X(E,M?x:Y);const I=ee(h-180),C=x/2;P=P+C*Math.sin(I),z=z-C*Math.cos(I);const H=E/2;P=P+H*Math.cos(I),z=z+H*Math.sin(I)}else if(h<360){x=X(x,$),E=X(E,M?x:Y);const I=ee(h-270),C=x/2;P=P+C*Math.cos(I),z=z+C*Math.sin(I);const H=E/2;P=P-H*Math.sin(I),z=z+H*Math.cos(I)}g+x>0&&(g=g+x),v+E>0&&(v=v+E),f=P-v/2,u=z-g/2}break}case"resize-bottom-right":{if(h===0)e.h+Q>0&&(g+=Q),e.w+Z>0&&(v+=Z);else if(h>0||h<0){let P=m.x,z=m.y;if(h<90){x=X(x,G),E=X(E,M?x:Y);const I=ee(h),C=x/2;P=P-C*Math.sin(I),z=z+C*Math.cos(I);const H=E/2;P=P+H*Math.cos(I),z=z+H*Math.sin(I)}else if(h<180){x=0-X(x,$),E=X(E,M?x:Q);const I=ee(h-90),C=x/2;P=P-C*Math.cos(I),z=z-C*Math.sin(I);const H=E/2;P=P-H*Math.sin(I),z=z+H*Math.cos(I)}else if(h<270){x=X(x,$),E=X(E,M?x:0-Y);const I=ee(h-180),C=x/2;P=P+C*Math.sin(I),z=z-C*Math.cos(I);const H=E/2;P=P-H*Math.cos(I),z=z-H*Math.sin(I)}else if(h<360){x=X(x,$),E=X(E,M?x:T);const I=ee(h-270),C=x/2;P=P+C*Math.cos(I),z=z+C*Math.sin(I);const H=E/2;P=P+H*Math.sin(I),z=z-H*Math.cos(I)}g+x>0&&(g=g+x),v+E>0&&(v=v+E),f=P-v/2,u=z-g/2}break}}return{x:f,y:u,w:v,h:g,angle:e.angle}}function al(e,t){const{x:i,y:n,w:o,h:s,angle:r=0}=e,{center:a,start:c,end:l,viewScaleInfo:d}=t,f=N(a,{viewScaleInfo:d}),u=Be(r),v=kr(f,c,l),g=u+Wr(v);return{x:i,y:n,w:o,h:s,angle:g}}function ll(e,t){var i;const n=[],o=[],s=[],{viewScaleInfo:r,viewSizeInfo:a,start:c,end:l}=t;if(!(Array.isArray(e.elements)&&c&&l))return{indexes:n,uuids:o,elements:s};const d=Math.min(c.x,l.x),f=Math.max(c.x,l.x),u=Math.min(c.y,l.y),v=Math.max(c.y,l.y);for(let g=0;g<e.elements.length;g++){const h=e.elements[g];if(((i=h==null?void 0:h.operations)===null||i===void 0?void 0:i.lock)===!0)continue;const m=Ie(h,{viewScaleInfo:r,viewSizeInfo:a}),p=Fe(m);if(p.x>=d&&p.x<=f&&p.y>=u&&p.y<=v&&(n.push(g),o.push(h.uuid),s.push(h),m.angle&&(m.angle>0||m.angle<0))){const M=wt(m);if(M.length===4){const w=[M[0].x,M[1].x,M[2].x,M[3].x],y=[M[0].y,M[1].y,M[2].y,M[3].y];m.x=Math.min(...w),m.y=Math.min(...y),m.w=Math.abs(Math.max(...w)-Math.min(...w)),m.h=Math.abs(Math.max(...y)-Math.min(...y))}}}return{indexes:n,uuids:o,elements:s}}function bn(e,t){var i;if(!Array.isArray(e))return null;const n={x:0,y:0,w:0,h:0},{viewScaleInfo:o,viewSizeInfo:s}=t;let r=null;for(let a=0;a<e.length;a++){const c=e[a];if(!((i=c==null?void 0:c.operations)===null||i===void 0)&&i.invisible)continue;const l=Ie(c,{viewScaleInfo:o,viewSizeInfo:s});if(l.angle&&(l.angle>0||l.angle<0)){const d=wt(l);if(d.length===4){const f=[d[0].x,d[1].x,d[2].x,d[3].x],u=[d[0].y,d[1].y,d[2].y,d[3].y];l.x=Math.min(...f),l.y=Math.min(...u),l.w=Math.abs(Math.max(...f)-Math.min(...f)),l.h=Math.abs(Math.max(...u)-Math.min(...u))}}if(r){const d=Math.min(l.x,n.x),f=Math.min(l.y,n.y),u=Math.max(l.x+l.w,n.x+n.w),v=Math.max(l.y+l.h,n.y+n.h);n.x=d,n.y=f,n.w=Math.abs(u-d),n.h=Math.abs(v-f)}else n.x=l.x,n.y=l.y,n.w=l.w,n.h=l.h;r=l}return n}function cl(e,t){var i;if((t==null?void 0:t.type)==="group"&&Array.isArray((i=t==null?void 0:t.detail)===null||i===void 0?void 0:i.children))for(let n=0;n<t.detail.children.length;n++){const o=t.detail.children[n];if(e.uuid===o.uuid)return!0}return!1}function dl(e,t,i){let n=t.x-e.x,o=t.y-e.y;const s=[];if(i.forEach(r=>{const{x:a,y:c,w:l,h:d,angle:f=0}=r;s.push({x:a,y:c,w:l,h:d,angle:0-f})}),(i==null?void 0:i.length)>0){const r=$i(e,s),a=$i(t,s);n=a.x-r.x,o=a.y-r.y}return{moveX:n,moveY:o}}const Eo=2;function To(e){return{minX:e.topLeft.x,minY:e.topLeft.y,maxX:e.bottomRight.x,maxY:e.bottomRight.y,midX:e.center.x,midY:e.center.y}}const It=(e,t)=>{if(e.length===0)throw null;if(e.length===1)return e[0];let i=0,n=e.length-1;for(;i<=n;){const o=Math.floor((i+n)/2);if(e[o]===t)return e[o];e[o]<t?i=o+1:n=o-1}return i>=e.length?e[n]:n<0?e[i]:Math.abs(e[n]-t)<=Math.abs(e[i]-t)?e[n]:e[i]},Te=(e,t)=>Math.abs(e-t)<1e-5;function fl(e,t){var i,n;const{data:o,groupQueue:s,calculator:r,viewScaleInfo:a,viewSizeInfo:c}=t;let l=o.elements||[];(s==null?void 0:s.length)>0&&(l=((n=(i=s[s.length-1])===null||i===void 0?void 0:i.detail)===null||n===void 0?void 0:n.children)||[]);const d=[];l.forEach(L=>{if(L.uuid!==e){const T=r.calcViewRectInfoFromRange(L.uuid,{checkVisible:!0,viewScaleInfo:a,viewSizeInfo:c});T&&d.push(T)}});const f=r.calcViewRectInfoFromRange(e,{viewScaleInfo:a,viewSizeInfo:c});if(!f)return null;const u={},v={},g={},h={},m=[],p=[];let M=[],w=[];const y=To(f);u[y.minX]=[y.minY,y.midY,y.maxY],u[y.midX]=[y.minY,y.midY,y.maxY],u[y.maxX]=[y.minY,y.midY,y.maxY],v[y.minY]=[y.minX,y.midX,y.maxX],v[y.midY]=[y.minX,y.midX,y.maxX],v[y.maxY]=[y.minX,y.midX,y.maxX],d.forEach(L=>{const T=To(L);g[T.minX]||(g[T.minX]=[]),g[T.midX]||(g[T.midX]=[]),g[T.maxX]||(g[T.maxX]=[]),h[T.minY]||(h[T.minY]=[]),h[T.midY]||(h[T.midY]=[]),h[T.maxY]||(h[T.maxY]=[]),g[T.minX]=[T.minY,T.midY,T.maxY],g[T.midX]=[T.minY,T.midY,T.maxY],g[T.maxX]=[T.minY,T.midY,T.maxY],M.push(T.minX),M.push(T.midX),M.push(T.maxX),h[T.minY]=[T.minX,T.midX,T.maxX],h[T.midY]=[T.minX,T.midX,T.maxX],h[T.maxY]=[T.minX,T.midX,T.maxX],w.push(T.minY),w.push(T.midY),w.push(T.maxY)}),M=M.sort((L,T)=>L-T),w=w.sort((L,T)=>L-T);let A=null,b=null,S=null,R=null,j=null,O=null,W=null,_=null;if(M.length>0){S=It(M,y.minX),R=It(M,y.midX),j=It(M,y.maxX);const L=Math.abs(S-y.minX),T=Math.abs(R-y.midX),Y=Math.abs(j-y.maxX),E=Math.min(L,T,Y);E<=Eo/a.scale&&(Te(E,L)?A=S-y.minX:Te(E,T)?A=R-y.midX:Te(E,Y)&&(A=j-y.maxX))}if(w.length>0){O=It(w,y.minY),W=It(w,y.midY),_=It(w,y.maxY);const L=Math.abs(O-y.minY),T=Math.abs(W-y.midY),Y=Math.abs(_-y.maxY),E=Math.min(L,T,Y);E<=Eo/a.scale&&(Te(E,L)?b=O-y.minY:Te(E,T)?b=W-y.midY:Te(E,Y)&&(b=_-y.maxY))}const k=Object.assign({},y);if(A!==null&&(k.minX+=A,k.midX+=A,k.maxX+=A),b!==null&&(k.minY+=b,k.midY+=b,k.maxY+=b),J.x(A)&&A!==null&&S!==null&&R!==null&&j!==null){if(Te(A,S-y.minX)){const L={x:S,yList:[]};L.yList.push(k.minY),L.yList.push(k.midY),L.yList.push(k.maxY),L.yList.push(...(h==null?void 0:h[S])||[]),m.push(L)}if(Te(A,R-y.minX)){const L={x:R,yList:[]};L.yList.push(k.minY),L.yList.push(k.midY),L.yList.push(k.maxY),L.yList.push(...(h==null?void 0:h[R])||[]),m.push(L)}if(Te(A,j-y.minX)){const L={x:j,yList:[]};L.yList.push(k.minY),L.yList.push(k.midY),L.yList.push(k.maxY),L.yList.push(...(h==null?void 0:h[j])||[]),m.push(L)}}if(J.y(b)&&b!==null&&O!==null&&W!==null&&_!==null){if(Te(b,O-y.minY)){const L={y:O,xList:[]};L.xList.push(k.minX),L.xList.push(k.midX),L.xList.push(k.maxX),L.xList.push(...(g==null?void 0:g[O])||[]),p.push(L)}if(Te(b,W-y.midY)){const L={y:W,xList:[]};L.xList.push(k.minX),L.xList.push(k.midX),L.xList.push(k.maxX),L.xList.push(...(g==null?void 0:g[O])||[]),p.push(L)}if(Te(b,_-y.maxY)){const L={y:_,xList:[]};L.xList.push(k.minX),L.xList.push(k.midX),L.xList.push(k.maxX),L.xList.push(...(g==null?void 0:g[_])||[]),p.push(L)}}const U=[];(m==null?void 0:m.length)>0&&m.forEach((L,T)=>{U.push([]),L.yList.forEach(Y=>{U[T].push({x:L.x,y:Y})})});const K=[];return(p==null?void 0:p.length)>0&&p.forEach((L,T)=>{K.push([]),L.xList.forEach(Y=>{K[T].push({x:Y,y:L.y})})}),{offsetX:A,offsetY:b,yLines:U,xLines:K}}const qi="@middleware/text-edit",Wn="@middleware/text-change",hl=Bt(),Co=e=>{const{eventHub:t,boardContent:i,viewer:n,sharer:o}=e,s=i.boardContext.canvas,r=document.createElement("div");r.setAttribute("contenteditable","true");const a=document.createElement("div"),c=e.container||document.body,l=document.createElement("div");let d=null,f=[];a.appendChild(r),a.style.position="absolute",l.appendChild(a),l.style.position="fixed",l.style.top="0",l.style.bottom="0",l.style.left="0",l.style.right="0",l.style.display="none",c.appendChild(l);const u=w=>{p(),m(w),l.style.display="block",d!=null&&d.uuid&&(o.setActiveOverrideElemenentMap({[d.uuid]:{operations:{invisible:!0}}}),n.drawFrame())},v=()=>{if(d!=null&&d.uuid){const w=o.getActiveOverrideElemenentMap();w&&delete w[d.uuid],o.setActiveOverrideElemenentMap(w),n.drawFrame()}l.style.display="none",d=null,f=[]},g=()=>{const w=s.getBoundingClientRect(),{left:y,top:A,width:b,height:S}=w;return{left:y,top:A,width:b,height:S}},h=w=>{const{size:y,parent:A}=w,b=document.createElement("div"),{x:S,y:R,w:j,h:O}=y,W=Be(y.angle||0);return b.style.position="absolute",b.style.left=`${S}px`,b.style.top=`${R}px`,b.style.width=`${j}px`,b.style.height=`${O}px`,b.style.transform=`rotate(${W}deg)`,A.appendChild(b),b},m=w=>{const{viewScaleInfo:y,element:A,groupQueue:b}=w,{scale:S,offsetTop:R,offsetLeft:j}=y;a.children&&Array.from(a.children).forEach(Y=>{Y.remove()});let O=a;for(let Y=0;Y<b.length;Y++){const E=b[Y],{x:$,y:G,w:x,h:Z}=E,Q=Be(E.angle||0),P={x:$*S,y:G*S,w:x*S,h:Z*S,angle:Q};Y===0&&(P.x+=j,P.y+=R),O=h({size:P,parent:O})}const W=Object.assign(Object.assign({},hl),A.detail);let _=A.x*S+j,k=A.y*S+R,U=A.w*S,K=A.h*S;b.length>0&&(_=A.x*S,k=A.y*S,U=A.w*S,K=A.h*S);let L="center",T="center";W.textAlign==="left"?L="start":W.textAlign==="right"&&(L="end"),W.verticalAlign==="top"?T="start":W.verticalAlign==="bottom"&&(T="end"),r.style.display="inline-flex",r.style.justifyContent=L,r.style.alignItems=T,r.style.position="absolute",r.style.left=`${_-1}px`,r.style.top=`${k-1}px`,r.style.width=`${U+2}px`,r.style.height=`${K+2}px`,r.style.transform=`rotate(${Be(A.angle||0)}deg)`,r.style.boxSizing="border-box",r.style.border="1px solid #1973ba",r.style.resize="none",r.style.overflow="hidden",r.style.wordBreak="break-all",r.style.background="transparent",r.style.color=`${W.color||"#333333"}`,r.style.fontSize=`${W.fontSize*S}px`,r.style.lineHeight=`${(W.lineHeight||W.fontSize)*S}px`,r.style.fontFamily=vs(W.fontFamily),r.style.fontWeight=`${W.fontWeight}`,r.style.padding="0",r.style.margin="0",r.style.outline="none",r.innerText=W.text||"",O.appendChild(r)},p=()=>{const{left:w,top:y,width:A,height:b}=g();a.style.position="absolute",a.style.overflow="hidden",a.style.top=`${y}px`,a.style.left=`${w}px`,a.style.width=`${A}px`,a.style.height=`${b}px`};l.addEventListener("click",()=>{v()}),r.addEventListener("click",w=>{w.stopPropagation()}),r.addEventListener("input",()=>{d&&f&&(d.detail.text=r.innerText||"",t.trigger(Wn,{element:{uuid:d.uuid,detail:{text:d.detail.text}},position:[...f||[]]}),n.drawFrame())}),r.addEventListener("blur",()=>{d&&f&&t.trigger(Wn,{element:{uuid:d.uuid,detail:{text:d.detail.text}},position:[...f]}),v()}),r.addEventListener("keydown",w=>{w.stopPropagation()}),r.addEventListener("keypress",w=>{w.stopPropagation()}),r.addEventListener("keyup",w=>{w.stopPropagation()}),r.addEventListener("wheel",w=>{w.stopPropagation(),w.preventDefault()});const M=w=>{var y;w!=null&&w.position&&(w!=null&&w.element)&&((y=w==null?void 0:w.element)===null||y===void 0?void 0:y.type)==="text"&&(d=w.element,f=w.position),u(w)};return{name:"@middleware/text-editor",use(){t.on(qi,M)},disuse(){t.off(qi,M)}}},Do=e=>{const{viewer:t,sharer:i,boardContent:n,calculator:o,eventHub:s}=e,{overlayContext:r}=n;let a=null,c=null;i.setSharedStorage(re,null),i.setSharedStorage(pi,!0);const l=()=>i.getSharedStorage(ht),d=w=>{let y=i.getSharedStorage(ze);Array.isArray(y)||(y=[]),y.length>0?cl(w,y[y.length-1])?y.push(w):y=[]:y.length===0&&y.push(w);const A=Gn(y);return i.setSharedStorage(ze,y),i.setSharedStorage(wn,A),y.length>0},f=w=>{i.setSharedStorage(at,w);let y=null;w&&(y=si(w,{groupQueue:i.getSharedStorage(ze)})),i.setSharedStorage(Xt,y)},u=(w,y)=>{var A;if(i.setSharedStorage(ht,w),w.length===1){const b=vi(w[0],{groupQueue:i.getSharedStorage(ze),controllerSize:Ws,viewScaleInfo:i.getActiveViewScaleInfo()});i.setSharedStorage(St,b),i.setSharedStorage(Mt,ei(w[0].uuid,((A=i.getActiveStorage("data"))===null||A===void 0?void 0:A.elements)||[]))}else i.setSharedStorage(St,null),i.setSharedStorage(Mt,[]);(y==null?void 0:y.triggerEvent)===!0&&s.trigger(Fi,{uuids:w.map(b=>b.uuid)})},v=()=>({ctx:r,calculator:o,data:i.getActiveStorage("data"),selectedElements:l(),viewScaleInfo:i.getActiveViewScaleInfo(),viewSizeInfo:i.getActiveViewSizeInfo(),groupQueue:i.getSharedStorage(ze),areaSize:null,selectedElementController:i.getSharedStorage(St),selectedElementPosition:i.getSharedStorage(Mt)}),g=()=>{i.setSharedStorage(re,null),i.setSharedStorage(rt,null),i.setSharedStorage(mi,null),i.setSharedStorage(yi,null),i.setSharedStorage(ze,[]),i.setSharedStorage(wn,[]),i.setSharedStorage(at,null),i.setSharedStorage(Xt,null),i.setSharedStorage(ht,[]),i.setSharedStorage(qa,null),i.setSharedStorage(St,null),i.setSharedStorage(Mt,[]),i.setSharedStorage(xt,[]),i.setSharedStorage(At,[]),i.setSharedStorage(wi,null),i.setSharedStorage(pn,null)};g();const h=({uuids:w,positions:y})=>{let A=[];const b=i.getSharedStorage(re),S=i.getActiveStorage("data");y&&Array.isArray(y)?A=Xr(y,(S==null?void 0:S.elements)||[]):A=Fr(w,(S==null?void 0:S.elements)||[]);let R=!1;if(!b&&A.length===1?(i.setSharedStorage(re,"select"),R=!0):b==="select"&&A.length===1&&(R=!0),R){const j=A[0],O=Gr(j.uuid,(S==null?void 0:S.elements)||[]);i.setSharedStorage(ze,O),u(A),t.drawFrame()}},m=()=>{g(),t.drawFrame()},p=w=>{i.setSharedStorage(pi,!!w.enable)},M=w=>{i.setSharedStorage(pn,!!w.enable)};return{name:"@middleware/selector",use(){s.on(Fi,h),s.on(Ki,m),s.on(Cn,M),s.on(Dn,p)},disuse(){s.off(Fi,h),s.off(Ki,m),s.off(Cn,M),s.off(Dn,p)},hover:w=>{var y,A,b,S,R;const j=i.getSharedStorage(rt),O=i.getSharedStorage(re),W=i.getSharedStorage(ze),_=T=>{const Y=T.type;c===null&&s.trigger("cursor",{type:Y,groupQueue:T.groupQueue,element:T.elements[0]})};if((W==null?void 0:W.length)>0){if(!Lo(w.point,{ctx:r,viewScaleInfo:i.getActiveViewScaleInfo(),viewSizeInfo:i.getActiveViewSizeInfo(),groupQueue:i.getSharedStorage(ze)})){f(null),t.drawFrame();return}const Y=Ht(w.point,v());if(_(Y),j||["area","drag","drag-list"].includes(O)){f(null),t.drawFrame();return}if(((y=Y==null?void 0:Y.elements)===null||y===void 0?void 0:y.length)===1){f(Y.elements[0]),t.drawFrame();return}f(null),t.drawFrame();return}if(j||["area","drag","drag-list"].includes(O)){f(null);return}if(O==="drag"){f(null);return}const k=l(),U=i.getActiveViewScaleInfo(),K=i.getActiveViewSizeInfo(),L=Ht(w.point,Object.assign(Object.assign({},v()),{areaSize:bn(k,{viewScaleInfo:U,viewSizeInfo:K,calculator:o})}));if(_(L),L.type===null){(i.getSharedStorage(at)||i.getSharedStorage(Xt))&&(i.setSharedStorage(at,null),i.setSharedStorage(Xt,null),t.drawFrame());return}if(!(L.type==="over-element"&&i.getSharedStorage(re)==="select"&&L.elements.length===1&&L.elements[0].uuid===((b=(A=l())===null||A===void 0?void 0:A[0])===null||b===void 0?void 0:b.uuid))&&!(L.type==="over-element"&&i.getSharedStorage(re)===null&&L.elements.length===1&&L.elements[0].uuid===((S=i.getSharedStorage(at))===null||S===void 0?void 0:S.uuid))){if(L.type==="over-element"&&((R=L==null?void 0:L.elements)===null||R===void 0?void 0:R.length)===1){f(L.elements[0]),t.drawFrame();return}if(i.getSharedStorage(at)){f(null),t.drawFrame();return}}},pointStart:w=>{var y,A,b,S,R,j,O,W,_,k;a=w.point;const U=i.getSharedStorage(ze);if((U==null?void 0:U.length)>0){if(Lo(w.point,{ctx:r,viewScaleInfo:i.getActiveViewScaleInfo(),viewSizeInfo:i.getActiveViewSizeInfo(),groupQueue:U})){const T=Ht(w.point,v());if(((y=T==null?void 0:T.elements)===null||y===void 0?void 0:y.length)===1&&((b=(A=T.elements[0])===null||A===void 0?void 0:A.operations)===null||b===void 0?void 0:b.lock)===!0)return;f(null),T.type==="over-element"&&((S=T==null?void 0:T.elements)===null||S===void 0?void 0:S.length)===1?(u([T.elements[0]],{triggerEvent:!0}),i.setSharedStorage(re,"drag")):!((R=T.type)===null||R===void 0)&&R.startsWith("resize-")?(i.setSharedStorage(rt,T.type),i.setSharedStorage(re,"resize")):u([],{triggerEvent:!0})}else g();t.drawFrame();return}const K=bn(l(),{viewScaleInfo:i.getActiveViewScaleInfo(),viewSizeInfo:i.getActiveViewSizeInfo(),calculator:o}),L=Ht(w.point,Object.assign(Object.assign({},v()),{areaSize:K,groupQueue:[]}));((j=L==null?void 0:L.elements)===null||j===void 0?void 0:j.length)===1&&((W=(O=L.elements[0])===null||O===void 0?void 0:O.operations)===null||W===void 0?void 0:W.lock)===!0||(f(null),L.type==="list-area"?i.setSharedStorage(re,"drag-list"):L.type==="over-element"&&((_=L==null?void 0:L.elements)===null||_===void 0?void 0:_.length)===1?(u([L.elements[0]],{triggerEvent:!0}),i.setSharedStorage(re,"drag")):!((k=L.type)===null||k===void 0)&&k.startsWith("resize-")?(i.setSharedStorage(rt,L.type),i.setSharedStorage(re,"resize")):(g(),i.setSharedStorage(re,"area"),i.setSharedStorage(mi,w.point),u([],{triggerEvent:!0})),t.drawFrame())},pointMove:w=>{var y,A,b;i.setSharedStorage(xt,[]),i.setSharedStorage(At,[]),i.setSharedStorage(wi,!0);const S=i.getActiveStorage("data"),R=l(),j=i.getActiveStorage("scale")||1,O=i.getActiveViewScaleInfo(),W=i.getActiveViewSizeInfo(),_=a,k=w.point,U=i.getSharedStorage(rt),K=i.getSharedStorage(re),L=i.getSharedStorage(ze),T=i.getSharedStorage(pi);if(K==="drag"){if(c="drag",S&&(R==null?void 0:R.length)===1&&_&&k&&((A=(y=R[0])===null||y===void 0?void 0:y.operations)===null||A===void 0?void 0:A.lock)!==!0){const{moveX:Y,moveY:E}=dl(_,k,L);let $=o.toGridNum(Y/j),G=o.toGridNum(E/j);if(T===!0){const x=fl(R[0].uuid,{calculator:o,data:S,groupQueue:L,viewScaleInfo:O,viewSizeInfo:W});try{x&&(J.x(x.offsetX)&&x.offsetX!==null&&($=o.toGridNum($+x.offsetX)),J.y(x.offsetY)&&x.offsetY!==null&&(G=o.toGridNum(G+x.offsetY)),i.setSharedStorage(xt,x.xLines),i.setSharedStorage(At,x.yLines))}catch(Z){console.error(Z)}}R[0].x=o.toGridNum(R[0].x+$),R[0].y=o.toGridNum(R[0].y+G),u([R[0]]),o.modifyViewVisibleInfoMap(S,{modifyOptions:{type:"updateElement",content:{element:R[0],position:i.getSharedStorage(Mt)||[]}},viewSizeInfo:W,viewScaleInfo:O})}t.drawFrame()}else if(K==="drag-list"){if(c="drag-list",S&&_&&k&&(R==null?void 0:R.length)>1){const Y=(k.x-_.x)/j,E=(k.y-_.y)/j;R.forEach($=>{var G;$&&((G=$==null?void 0:$.operations)===null||G===void 0?void 0:G.lock)!==!0&&($.x=o.toGridNum($.x+Y),$.y=o.toGridNum($.y+E),o.modifyViewVisibleInfoMap(S,{modifyOptions:{type:"updateElement",content:{element:$,position:ei($.uuid,S.elements)||[]}},viewSizeInfo:W,viewScaleInfo:O}))}),i.setActiveStorage("data",S)}t.drawFrame()}else if(K==="resize"){if(S&&(R==null?void 0:R.length)===1&&_&&(U!=null&&U.startsWith("resize-"))){c="resize";const Y=[];L.forEach(G=>{const{x,y:Z,w:Q,h:P,angle:z=0}=G;Y.push({x,y:Z,w:Q,h:P,angle:0-z})});let E=_,$=k;if(L.length>0&&(E=$i(_,Y),$=$i(k,Y)),U==="resize-rotate"){const G=i.getSharedStorage(St),x=[G.topLeft.center,G.topRight.center,G.bottomLeft.center,G.bottomRight.center],Z=ts(x),Q=al(R[0],{center:Z,viewScaleInfo:O,viewSizeInfo:W,start:_,end:k,resizeType:U,sharer:i});R[0].angle=o.toGridNum(Q.angle||0)}else{const G=rl(R[0],{scale:j,start:E,end:$,resizeType:U,sharer:i}),x={ignore:!!R[0].angle};R[0].x=o.toGridNum(G.x,x),R[0].y=o.toGridNum(G.y,x),R[0].type==="group"&&((b=R[0].operations)===null||b===void 0?void 0:b.deepResize)===!0?Hn(R[0],{w:o.toGridNum(G.w,x),h:o.toGridNum(G.h,x)}):(R[0].w=o.toGridNum(G.w,x),R[0].h=o.toGridNum(G.h,x))}u([R[0]]),o.modifyViewVisibleInfoMap(S,{modifyOptions:{type:"updateElement",content:{element:R[0],position:i.getSharedStorage(Mt)||[]}},viewSizeInfo:W,viewScaleInfo:O}),t.drawFrame()}}else K==="area"&&(c="area",i.setSharedStorage(yi,w.point),t.drawFrame());a=w.point},pointEnd(w){c=null,i.setSharedStorage(xt,[]),i.setSharedStorage(At,[]),i.setSharedStorage(wi,!1);const y=i.getActiveStorage("data"),A=i.getSharedStorage(rt),b=i.getSharedStorage(re),S=i.getActiveViewSizeInfo();let R=!1;if(a=null,b==="resize"&&A)i.setSharedStorage(rt,null),R=!0;else if(b==="area"){if(i.setSharedStorage(re,null),y){const O=i.getSharedStorage(mi),W=i.getSharedStorage(yi);if(O&&W){const{elements:_}=ll(y,{start:O,end:W,calculator:o,viewScaleInfo:i.getActiveViewScaleInfo(),viewSizeInfo:i.getActiveViewSizeInfo()});_.length>0&&(i.setSharedStorage(re,"drag-list"),u(_,{triggerEvent:!0}),R=!0)}}}else b==="drag-list"?(i.setSharedStorage(re,"drag-list-end"),R=!0):y&&(o.getPointElement(w.point,{data:y,viewScaleInfo:i.getActiveViewScaleInfo(),viewSizeInfo:i.getActiveViewSizeInfo()}).element?(i.setSharedStorage(re,"select"),R=!0):i.setSharedStorage(re,null));i.getSharedStorage(re)===null&&(g(),R=!0),(()=>{if(R){if(y&&Array.isArray(y==null?void 0:y.elements)&&["drag","drag-list"].includes(b)){const O=Br(y.elements,S,{extend:!0});i.setActiveStorage("contextHeight",O.contextSize.contextHeight),i.setActiveStorage("contextWidth",O.contextSize.contextWidth)}y&&["drag","drag-list","drag-list-end","resize"].includes(b)&&s.trigger($n,{data:y,type:"dragElement"}),t.drawFrame()}})()},pointLeave(){a=null,g(),t.drawFrame()},doubleClick(w){var y,A,b,S,R,j,O,W;if(i.getSharedStorage(pn)===!1)return;const _=Ht(w.point,v());if(i.setSharedStorage(St,null),i.setSharedStorage(ht,[]),!(_.elements.length===1&&((A=(y=_.elements[0])===null||y===void 0?void 0:y.operations)===null||A===void 0?void 0:A.lock)===!0)){if(_.elements.length===1&&((b=_.elements[0])===null||b===void 0?void 0:b.type)==="group"){if(d(_.elements[0])===!0){i.setSharedStorage(re,null),t.drawFrame();return}}else _.elements.length===1&&((S=_.elements[0])===null||S===void 0?void 0:S.type)==="text"&&!(!((j=(R=_.elements[0])===null||R===void 0?void 0:R.operations)===null||j===void 0)&&j.invisible)&&s.trigger(qi,{element:_.elements[0],groupQueue:i.getSharedStorage(ze)||[],position:ei((O=_.elements[0])===null||O===void 0?void 0:O.uuid,((W=i.getActiveStorage("data"))===null||W===void 0?void 0:W.elements)||[]),viewScaleInfo:i.getActiveViewScaleInfo()});i.setSharedStorage(re,null)}},beforeDrawFrame({snapshot:w}){var y;const{activeStore:A,sharedStore:b}=w,{scale:S,offsetLeft:R,offsetTop:j,offsetRight:O,offsetBottom:W,width:_,height:k,contextHeight:U,contextWidth:K,devicePixelRatio:L}=A,T=e.sharer,Y={scale:S,offsetLeft:R,offsetTop:j,offsetRight:O,offsetBottom:W},E={width:_,height:k,contextHeight:U,contextWidth:K,devicePixelRatio:L},G=b[ht][0],x=b[at],Z=b[Xt],Q=b[re],P=b[mi],z=b[yi],I=b[ze],C=b[wn],H=b[wi],cn=b[pi],Ge={calculator:o,viewScaleInfo:Y,viewSizeInfo:E},Jn=G?vi(G,{groupQueue:I,controllerSize:10,viewScaleInfo:Y}):null,hi=!!(!((y=x==null?void 0:x.operations)===null||y===void 0)&&y.lock);if((I==null?void 0:I.length)>0){if(sl(r,C,Ge),x&&Q!=="drag"&&(hi?Ro(r,Z,Object.assign(Object.assign({},Ge),{controller:vi(x,{groupQueue:I,controllerSize:10,viewScaleInfo:Y})})):Io(r,Z,Ge)),!hi&&G&&["select","drag","resize"].includes(Q)&&(Po(r,Jn,Object.assign(Object.assign({},Ge),{element:G,calculator:o,hideControllers:!!H&&Q==="drag"})),Q==="drag")){const pt=T.getSharedStorage(xt),dn=T.getSharedStorage(At);cn===!0&&zo(r,{xLines:pt,yLines:dn})}}else if(x&&Q!=="drag"&&(hi?Ro(r,Z,Object.assign(Object.assign({},Ge),{controller:vi(x,{groupQueue:I,controllerSize:10,viewScaleInfo:Y})})):Io(r,Z,Ge)),!hi&&G&&["select","drag","resize"].includes(Q)){if(Po(r,Jn,Object.assign(Object.assign({},Ge),{element:G,calculator:o,hideControllers:!!H&&Q==="drag"})),Q==="drag"){const pt=T.getSharedStorage(xt),dn=T.getSharedStorage(At);cn===!0&&zo(r,{xLines:pt,yLines:dn})}}else if(Q==="area"&&P&&z)nl(r,{start:P,end:z});else if(["drag-list","drag-list-end"].includes(Q)){const pt=bn(l(),{viewScaleInfo:T.getActiveViewScaleInfo(),viewSizeInfo:T.getActiveViewSizeInfo(),calculator:o});pt&&ol(r,{areaSize:pt})}}}},fi="SCROLL",Gi=Symbol(`${fi}_xThumbRect`),Xi=Symbol(`${fi}_yThumbRect`),Dt=Symbol(`${fi}_prevPoint`),kn=Symbol(`${fi}_activePoint`),Zt=Symbol(`${fi}_activeThumbType`),ul=12,_o=16,gl=.3,Oo={width:ul,thumbColor:"#000000AA",scrollBarColor:"#FFFFFF60",showScrollBar:!1};function Wo(e,t,i){const n=e,{x:o,y:s,w:r,h:a}=i;return n.beginPath(),n.rect(o,s,r,a),n.closePath(),!!n.isPointInPath(t.x,t.y)}function vl(e,t,i){let n=null;const{xThumbRect:o,yThumbRect:s}=i;return o&&Wo(e,t,o)?n="X":s&&Wo(e,t,s)&&(n="Y"),n}function ml(e){const{sharedStore:t}=e;return{activePoint:t[kn]||null,prevPoint:t[Dt]||null,activeThumbType:t[Zt]||null,xThumbRect:t[Gi]||null,yThumbRect:t[Xi]||null}}function yl(e,t){const{width:i,height:n}=t,{offsetTop:o,offsetBottom:s,offsetLeft:r,offsetRight:a}=e,c=_o*2.5,l=_o;let d=0,f=0;d=Math.max(c,i-l*2-(Math.abs(r)+Math.abs(a))),d>=i&&(d=i),f=Math.max(c,n-l*2-(Math.abs(o)+Math.abs(s))),f>=n&&(f=n);const u=l,v=i-d-l;let g=u;r>0?g=u:a>0?g=v:r<=0&&d>0&&!(r===0&&a===0)&&(g=u+(i-d)*Math.abs(r)/(Math.abs(r)+Math.abs(a)),g=Math.min(Math.max(0,g-u),i-d));const h=l,m=n-f-l;let p=h;o>0?p=h:s>0?p=m:o<=0&&f>0&&!(o===0&&s===0)&&(p=h+(n-f)*Math.abs(o)/(Math.abs(o)+Math.abs(s)),p=Math.min(Math.max(0,p-h),n-f));const M={x:g,y:n-l,w:d,h:l},w={x:i-l,y:p,w:l,h:f};return{lineSize:l,xSize:d,ySize:f,translateY:p,translateX:g,thumbColor:Oo.thumbColor,scrollBarColor:Oo.scrollBarColor,xThumbRect:M,yThumbRect:w}}function ko(e,t){let{x:i,y:n,h:o,w:s}=t;e.save(),e.shadowColor="#FFFFFF",e.shadowOffsetX=0,e.shadowOffsetY=0,e.shadowBlur=1;{const{color:r,axis:a}=t;a==="X"?(n=n+o/4+0,o=o/2):a==="Y"&&(i=i+s/4+0,s=s/2);let c=t.r;c=Math.min(c,s/2,o/2),(s<c*2||o<c*2)&&(c=0),e.globalAlpha=gl,e.beginPath(),e.moveTo(i+c,n),e.arcTo(i+s,n,i+s,n+o,c),e.arcTo(i+s,n+o,i,n+o,c),e.arcTo(i,n+o,i,n,c),e.arcTo(i,n,i+s,n,c),e.closePath(),e.fillStyle=r,e.fill(),e.globalAlpha=1,e.beginPath(),e.lineWidth=1,e.strokeStyle=r,e.setLineDash([]),e.moveTo(i+c,n),e.arcTo(i+s,n,i+s,n+o,c),e.arcTo(i+s,n+o,i,n+o,c),e.arcTo(i,n+o,i,n,c),e.arcTo(i,n,i+s,n,c),e.closePath(),e.stroke()}e.restore()}function wl(e,t){const i=e,{viewScaleInfo:n,viewSizeInfo:o,scrollInfo:s}=t,{activeThumbType:r,prevPoint:a,activePoint:c}=s,l=yl(n,o);let d=Object.assign({},l.xThumbRect),f=Object.assign({},l.yThumbRect);return r&&a&&c&&(r==="X"&&s.xThumbRect?(d=Object.assign({},s.xThumbRect),d.x=d.x+(c.x-a.x)):r==="Y"&&s.yThumbRect&&(f=Object.assign({},s.yThumbRect),f.y=f.y+(c.y-a.y))),ko(i,Object.assign(Object.assign({axis:"X"},d),{r:l.lineSize/2,color:l.thumbColor})),ko(i,Object.assign(Object.assign({axis:"Y"},f),{r:l.lineSize/2,color:l.thumbColor})),i.globalAlpha=1,{xThumbRect:d,yThumbRect:f}}function pl(e,t){const{snapshot:i}=t,n=on(i),o=ai(i),s=ml(i),{xThumbRect:r,yThumbRect:a}=wl(e,{viewSizeInfo:n,viewScaleInfo:o,scrollInfo:s});return{xThumbRect:r,yThumbRect:a}}const jo=e=>{const{viewer:t,boardContent:i,sharer:n}=e,{overlayContext:o}=i;n.setSharedStorage(Gi,null),n.setSharedStorage(Xi,null);const s=()=>{n.setSharedStorage(Dt,null),n.setSharedStorage(kn,null),n.setSharedStorage(Zt,null)};s();const r=l=>{const d=n.getSharedStorage(Dt);if(d){const{offsetLeft:f,offsetRight:u}=n.getActiveViewScaleInfo(),{width:v}=n.getActiveViewSizeInfo(),g=-(l.x-d.x),h=v+Math.abs(f)+Math.abs(u),m=g*h/v;t.scroll({moveX:m}),t.drawFrame()}},a=l=>{const d=n.getSharedStorage(Dt);if(d){const{offsetTop:f,offsetBottom:u}=n.getActiveViewScaleInfo(),{height:v}=n.getActiveViewSizeInfo(),g=-(l.y-d.y),h=v+Math.abs(f)+Math.abs(u),m=g*h/v;t.scroll({moveY:m}),t.drawFrame()}},c=l=>vl(o,l,{xThumbRect:n.getSharedStorage(Gi),yThumbRect:n.getSharedStorage(Xi)});return{name:"@middleware/scroller",wheel:l=>{t.scroll({moveX:0-l.deltaX,moveY:0-l.deltaY}),t.drawFrame()},pointStart:l=>{const{point:d}=l,f=c(d);if(f==="X"||f==="Y")return n.setSharedStorage(Zt,f),n.setSharedStorage(Dt,d),!1},pointMove:l=>{const{point:d}=l,f=n.getSharedStorage(Zt);if(f==="X"||f==="Y")return n.setSharedStorage(kn,d),f==="X"?r(d):f==="Y"&&a(d),n.setSharedStorage(Dt,d),!1},pointEnd:()=>{const l=n.getSharedStorage(Zt);if(s(),l==="X"||l==="Y")return t.scroll({moveX:0,moveY:0}),t.drawFrame(),!1},beforeDrawFrame({snapshot:l}){const{xThumbRect:d,yThumbRect:f}=pl(o,{snapshot:l});n.setSharedStorage(Gi,d),n.setSharedStorage(Xi,f)}}},ks="@middleware/scale",Vo=e=>{const{viewer:t,sharer:i,eventHub:n}=e,o=50,s=.05;return{name:"@middleware/scaler",wheelScale(r){const{deltaY:a,point:c}=r,{scale:l}=i.getActiveViewScaleInfo();let d=l;if(a<0?d=l*1.1:a>0&&(d=l*.9),d<s||d>o)return;const{moveX:f,moveY:u}=t.scale({scale:d,point:c});t.scroll({moveX:f,moveY:u}),t.drawFrame();const v=ye(l);n.trigger(ks,{scale:v})}}},ve=16,bl="#FFFFFFA8",Sl="#00000080",js="#000000",Vs="#00000080",Bs="monospace",jn=10,Ys=100,Bo="#AAAAAA20",Yo="#AAAAAA40",ln=1,Fo="#196097",Rt=[1,2,5,10,20,50,100,200,500];function Ml(e){e=Math.max(Rt[0],Math.min(e,Rt[Rt.length-1]));for(let t=0;t<Rt.length-1;t++){const i=Rt[t],n=Rt[t+1];if(e>n)continue;if(e===i||e===n)return e;const o=(i+n)/2;return e<=o?i:n}return e}function Fs(e){const{scale:t,viewLength:i,viewOffset:n}=e,o=[];let s=10;s=ye(s/t,{decimalPlaces:0}),s=Ml(s);const r=s*10,a=s*5;let c=0;const l=s*t,d=0-n,f=0,u=d%l,v=(d-u+l)/t,g=f+(l-u);for(;g+c*l<i;){const h=ye(v+c*s,{decimalPlaces:0}),m=ye(g+c*l,{decimalPlaces:0}),p={num:h,position:m,showNum:h%r===0,isKeyNum:h%r===0,isSubKeyNum:h%a===0};o.push(p),c++}return{list:o,rulerUnit:s}}function xl(e){const{viewScaleInfo:t,viewSizeInfo:i}=e,{scale:n,offsetLeft:o}=t,{width:s}=i;return Fs({axis:"X",scale:n,viewLength:s,viewOffset:o})}function Al(e){const{viewScaleInfo:t,viewSizeInfo:i}=e,{scale:n,offsetTop:o}=t,{height:s}=i;return Fs({axis:"Y",scale:n,viewLength:s,viewOffset:o})}function Il(e,t){const{scaleList:i}=t,n=ve,o=ve*4/5,s=ve*2/5,r=ve*1/5,a=ve/5;for(let c=0;c<i.length;c++){const l=i[c];l.position<ve||(e.beginPath(),e.moveTo(l.position,n),e.lineTo(l.position,l.isKeyNum?r:l.isSubKeyNum?s:o),e.closePath(),e.lineWidth=ln,e.setLineDash([]),e.fillStyle=js,e.stroke(),l.isKeyNum&&(e.fillStyle=Vs,e.textBaseline="top",e.$setFont({fontWeight:Ys,fontSize:jn,fontFamily:Bs}),e.fillText(`${l.num}`,l.position+a,a)))}}function Rl(e,t){const{scaleList:i}=t,n=ve,o=ve*4/5,s=ve*2/5,r=ve*1/5,a=ve/5;for(let c=0;c<i.length;c++){const l=i[c];if(!(l.position<ve)&&(e.beginPath(),e.moveTo(n,l.position),e.lineTo(l.isKeyNum?r:l.isSubKeyNum?s:o,l.position),e.closePath(),e.fillStyle=js,e.lineWidth=ln,e.setLineDash([]),e.stroke(),l.showNum===!0)){const d=a,f=l.position+a,u=`${l.num}`;li(e,-90,{x:d,y:f},()=>{e.fillStyle=Vs,e.textBaseline="top",e.$setFont({fontWeight:Ys,fontSize:jn,fontFamily:Bs}),e.fillText(u,a+jn,l.position+a)})}}}function Pl(e,t){const{viewSizeInfo:i}=t,{width:n,height:o}=i;e.beginPath(),e.moveTo(0,0),e.lineTo(n+1,0),e.lineTo(n+1,ve),e.lineTo(ve,ve),e.lineTo(ve,o+1),e.lineTo(0,o+1),e.lineTo(0,0),e.closePath(),e.fillStyle=bl,e.fill(),e.lineWidth=ln,e.setLineDash([]),e.strokeStyle=Sl,e.stroke()}function zl(e,t){const{xList:i,yList:n,viewSizeInfo:o}=t,{width:s,height:r}=o;for(let a=0;a<i.length;a++){const c=i[a];e.beginPath(),e.moveTo(c.position,0),e.lineTo(c.position,r),c.isKeyNum===!0||c.isSubKeyNum===!0?e.strokeStyle=Yo:e.strokeStyle=Bo,e.closePath(),e.lineWidth=ln,e.setLineDash([]),e.stroke()}for(let a=0;a<n.length;a++){const c=n[a];e.beginPath(),e.moveTo(0,c.position),e.lineTo(s,c.position),c.isKeyNum===!0||c.isSubKeyNum===!0?e.strokeStyle=Yo:e.strokeStyle=Bo,e.lineWidth=1,e.closePath(),e.stroke()}}function Ll(e,t){const{snapshot:i,calculator:n}=t,{sharedStore:o}=i,s=o[ht],r=o[re];if(["select","drag","drag-list","drag-list-end"].includes(r)&&s.length>0){const a=ai(i),c=on(i),l=[],d=[],f=[],u=[],v=[];if(s.forEach(M=>{const w=n.calcViewRectInfoFromRange(M.uuid,{viewScaleInfo:a,viewSizeInfo:c});w&&(l.push(w),d.push(w.left.x),f.push(w.right.x),u.push(w.top.y),v.push(w.bottom.y))}),!(l.length>0))return;const g=Math.min(...d),h=Math.max(...f),m=Math.min(...u),p=Math.max(...v);e.globalAlpha=1,e.beginPath(),e.moveTo(g,0),e.lineTo(h,0),e.lineTo(h,ve),e.lineTo(g,ve),e.fillStyle=Fo,e.closePath(),e.fill(),e.beginPath(),e.moveTo(0,m),e.lineTo(ve,m),e.lineTo(ve,p),e.lineTo(0,p),e.fillStyle=Fo,e.closePath(),e.fill()}}const Vn="@middleware/show-ruler",Go=e=>{const{boardContent:t,viewer:i,eventHub:n,calculator:o}=e,{overlayContext:s,underlayContext:r}=t;let a=!0,c=!0;const l=d=>{typeof(d==null?void 0:d.show)=="boolean"&&(a=d.show),typeof(d==null?void 0:d.showGrid)=="boolean"&&(c=d.showGrid),(typeof(d==null?void 0:d.show)=="boolean"||typeof(d==null?void 0:d.showGrid)=="boolean")&&i.drawFrame()};return{name:"@middleware/ruler",use(){n.on(Vn,l)},disuse(){n.off(Vn,l)},beforeDrawFrame:({snapshot:d})=>{if(a===!0){const f=ai(d),u=on(d);Ll(s,{snapshot:d,calculator:o}),Pl(s,{viewScaleInfo:f,viewSizeInfo:u});const{list:v,rulerUnit:g}=xl({viewScaleInfo:f,viewSizeInfo:u});Il(s,{scaleList:v});const{list:h}=Al({viewScaleInfo:f,viewSizeInfo:u});Rl(s,{scaleList:h}),c===!0&&zl(g===1?s:r,{xList:v,yList:h,viewScaleInfo:f,viewSizeInfo:u})}}}},El="DRAG",Si=Symbol(`${El}_prevPoint`),Xo=e=>{const{eventHub:t,sharer:i,viewer:n}=e;let o=!1;return{name:"@middleware/dragger",hover(){o!==!0&&t.trigger("cursor",{type:"drag-default"})},pointStart(s){const{point:r}=s;i.setSharedStorage(Si,r),o=!0,t.trigger("cursor",{type:"drag-active"})},pointMove(s){const{point:r}=s,a=i.getSharedStorage(Si);if(r&&a){const c=r.x-a.x,l=r.y-a.y;n.scroll({moveX:c,moveY:l}),n.drawFrame()}i.setSharedStorage(Si,r)},pointEnd(){o=!1,i.setSharedStorage(Si,null),t.trigger("cursor",{type:"drag-default"})}}},Qn="monospace";function Tl(e,t){const{point:i,rotateCenter:n,angle:o,text:s,color:r,background:a,fontSize:c,lineHeight:l}=t;li(e,o,n,()=>{e.$setFont({fontWeight:"300",fontSize:c,fontFamily:Qn});const d=(l-c)/2,f=e.$undoPixelRatio(e.measureText(s).width),u={x:i.x-f/2-d,y:i.y},v={x:u.x+f+d*2,y:u.y+c+d},g={x:i.x-f/2,y:i.y};e.setLineDash([]),e.fillStyle=a,e.beginPath(),e.moveTo(u.x,u.y),e.lineTo(v.x,u.y),e.lineTo(v.x,v.y),e.lineTo(u.x,v.y),e.closePath(),e.fill(),e.fillStyle=r,e.textBaseline="top",e.fillText(s,g.x,g.y+d)})}function Cl(e,t){const{point:i,rotateCenter:n,angle:o,text:s,color:r,background:a,fontSize:c,lineHeight:l}=t;li(e,o,n,()=>{e.$setFont({fontWeight:"300",fontSize:c,fontFamily:Qn});const d=(l-c)/2,f=e.$undoPixelRatio(e.measureText(s).width),u={x:i.x,y:i.y},v={x:u.x+f+d*2,y:u.y+c+d},g={x:i.x+d,y:i.y};e.setLineDash([]),e.fillStyle=a,e.beginPath(),e.moveTo(u.x,u.y),e.lineTo(v.x,u.y),e.lineTo(v.x,v.y),e.lineTo(u.x,v.y),e.closePath(),e.fill(),e.fillStyle=r,e.textBaseline="top",e.fillText(s,g.x,g.y+d)})}function Dl(e,t){const{point:i,rotateCenter:n,angle:o,text:s,color:r,background:a,fontSize:c,lineHeight:l}=t;li(e,o,n,()=>{e.$setFont({fontWeight:"300",fontSize:c,fontFamily:Qn});const d=(l-c)/2,f=e.$undoPixelRatio(e.measureText(s).width),u={x:i.x,y:i.y},v={x:u.x+f+d*2,y:u.y+c+d},g={x:i.x+d,y:i.y};e.setLineDash([]),e.fillStyle=a,e.beginPath(),e.moveTo(u.x,u.y),e.lineTo(v.x,u.y),e.lineTo(v.x,v.y),e.lineTo(u.x,v.y),e.closePath(),e.fill(),e.fillStyle=r,e.textBaseline="top",e.fillText(s,g.x,g.y+d)})}const Sn="#1973bac6",Mn="#ffffff",lt=10,xn=16,Ho=e=>{const{boardContent:t,calculator:i}=e,{overlayContext:n}=t;return{name:"@middleware/info",beforeDrawFrame({snapshot:o}){const{sharedStore:s}=o,r=s[ht],a=s[re],c=s[ze]||[];if(r.length===1){const l=r[0];if(l&&["select","drag","resize"].includes(a)){const d=ai(o),f=on(o),{x:u,y:v,w:g,h,angle:m}=l,p=[...c,{uuid:gt(),x:u,y:v,w:g,h,angle:m,type:"group",detail:{children:[]}}],M={viewScaleInfo:d,viewSizeInfo:f},w=i.calcViewRectInfoFromOrigin(l.uuid,M);let y=0;p.forEach(b=>{y+=b.angle||0});const A=et(Be(0-y));if(w){const b=w==null?void 0:w.center,S={topLeft:le(b,w.topLeft,A),topRight:le(b,w.topRight,A),bottomRight:le(b,w.bottomRight,A),bottomLeft:le(b,w.bottomLeft,A),center:le(b,w.center,A),top:le(b,w.top,A),right:le(b,w.right,A),bottom:le(b,w.bottom,A),left:le(b,w.left,A)},R=ye(l.x,{decimalPlaces:2}),j=ye(l.y,{decimalPlaces:2}),O=ye(l.w,{decimalPlaces:2}),W=ye(l.h,{decimalPlaces:2}),_=`${ye(R,{decimalPlaces:0})},${ye(j,{decimalPlaces:0})}`,k=`${ye(O,{decimalPlaces:0})}x${ye(W,{decimalPlaces:0})}`,U=`${ye(l.angle||0,{decimalPlaces:0})}`;Tl(n,{point:{x:S.bottom.x,y:S.bottom.y+lt},rotateCenter:S.center,angle:y,text:k,fontSize:lt,lineHeight:xn,color:Mn,background:Sn}),Cl(n,{point:{x:S.topLeft.x,y:S.topLeft.y-lt*2},rotateCenter:S.center,angle:y,text:_,fontSize:lt,lineHeight:xn,color:Mn,background:Sn}),Dl(n,{point:{x:S.top.x+lt,y:S.top.y-lt*2},rotateCenter:S.center,angle:y,text:U,fontSize:lt,lineHeight:xn,color:Mn,background:Sn})}}}}}},Zn="LAYOUT_SELECT",ke=Symbol(`${Zn}_layoutActionType`),Nt=Symbol(`${Zn}_layoutControlType`),Mi=Symbol(`${Zn}_layoutController`),Gs="#1973ba",Xs="#5b5959b5";function xi(e,t){e.setLineDash([]),e.fillStyle="#FFFFFF",e.beginPath(),e.moveTo(t[0].x,t[0].y),e.lineTo(t[1].x,t[1].y),e.lineTo(t[2].x,t[2].y),e.lineTo(t[3].x,t[3].y),e.closePath(),e.fill(),e.strokeStyle=Gs,e.lineWidth=2,e.beginPath(),e.moveTo(t[0].x,t[0].y),e.lineTo(t[1].x,t[1].y),e.lineTo(t[2].x,t[2].y),e.lineTo(t[3].x,t[3].y),e.closePath(),e.stroke()}function Jt(e,t){const{vertexes:i,strokeStyle:n,lineWidth:o}=t;e.setLineDash([]),e.strokeStyle=n,e.lineWidth=o,e.beginPath(),e.moveTo(i[0].x,i[0].y),e.lineTo(i[2].x,i[2].y),e.closePath(),e.stroke(),e.beginPath(),e.moveTo(i[1].x,i[1].y),e.lineTo(i[3].x,i[3].y),e.closePath(),e.stroke()}function Ai(e,t){const{start:i,end:n,centerVertexes:o,disabled:s}=t,r=s===!0?1:2,a=s===!0?Xs:Gs;e.setLineDash([]),e.strokeStyle=a,e.lineWidth=r,e.beginPath(),e.moveTo(i.x,i.y),e.lineTo(n.x,n.y),e.closePath(),e.stroke(),s===!0&&Jt(e,{vertexes:o,lineWidth:r,strokeStyle:a})}function _l(e,t){const{controller:i,operations:n}=t,{topLeft:o,topRight:s,bottomLeft:r,bottomRight:a,topMiddle:c,rightMiddle:l,bottomMiddle:d,leftMiddle:f}=i;Ai(e,{start:o.center,end:s.center,centerVertexes:c.vertexes,disabled:!!(n!=null&&n.disabledTop)}),Ai(e,{start:s.center,end:a.center,centerVertexes:l.vertexes,disabled:!!(n!=null&&n.disabledRight)}),Ai(e,{start:a.center,end:r.center,centerVertexes:d.vertexes,disabled:!!(n!=null&&n.disabledBottom)}),Ai(e,{start:r.center,end:o.center,centerVertexes:f.vertexes,disabled:!!(n!=null&&n.disabledLeft)});const u={lineWidth:1,strokeStyle:Xs};(n==null?void 0:n.disabledTopLeft)===!0?Jt(e,Object.assign({vertexes:o.vertexes},u)):xi(e,o.vertexes),(n==null?void 0:n.disabledTopRight)===!0?Jt(e,Object.assign({vertexes:s.vertexes},u)):xi(e,s.vertexes),(n==null?void 0:n.disabledBottomRight)===!0?Jt(e,Object.assign({vertexes:a.vertexes},u)):xi(e,a.vertexes),(n==null?void 0:n.disabledBottomLeft)===!0?Jt(e,Object.assign({vertexes:r.vertexes},u)):xi(e,r.vertexes)}const No=e=>{const{sharer:t,boardContent:i,calculator:n,viewer:o,eventHub:s}=e,{overlayContext:r}=i;let a=null;const c=()=>{a=null,t.setSharedStorage(ke,null),t.setSharedStorage(Nt,null),t.setSharedStorage(Mi,null)},l=()=>!!t.getSharedStorage(re),d=g=>{var h;const m=t.getActiveStorage("data");if(!((h=m==null?void 0:m.layout)===null||h===void 0)&&h.operations){const p=m.layout.operations;if(g==="left"&&p.disabledLeft===!0||g==="top"&&p.disabledTop===!0||g==="right"&&p.disabledRight===!0||g==="bottom"&&p.disabledBottom===!0||g==="top-left"&&p.disabledTopLeft===!0||g==="top-right"&&p.disabledTopRight===!0||g==="bottom-left"&&p.disabledBottomLeft===!0||g==="bottom-right"&&p.disabledBottomRight===!0)return!0}return!1},f=()=>{const g=t.getActiveStorage("data");if(g!=null&&g.layout){const{x:h,y:m,w:p,h:M}=g.layout;return{x:h,y:m,w:p,h:M}}return null},u=()=>{const g=t.getActiveViewScaleInfo(),h=f();if(h){const m=to(h,{viewScaleInfo:g,controllerSize:10});t.setSharedStorage(Mi,m)}else t.setSharedStorage(Mi,null)},v=g=>{const h=t.getActiveStorage("data"),m=t.getSharedStorage(Mi);if(m&&(h!=null&&h.layout)&&(g!=null&&g.point)){let p=null;if(m){const{topLeft:M,top:w,topRight:y,right:A,bottomRight:b,bottom:S,bottomLeft:R,left:j}=m,O=[M,w,y,A,b,S,R,j];for(let W=0;W<O.length;W++){const _=O[W];if(Zr(g.point,_.vertexes)){p=`${_.type}`;break}}if(p)return t.setSharedStorage(Nt,p),s.trigger(Ki,{}),p}}return null};return{name:"@middleware/layout-selector",use:()=>{c(),u()},hover:g=>{if(l())return;const h=t.getSharedStorage(ke),m=t.getActiveStorage("data");if(m!=null&&m.layout&&h!=="resize"){u();const p=v(g);p?(t.setSharedStorage(ke,"hover"),d(p)||s.trigger("cursor",{type:`resize-${p}`,groupQueue:[],element:f()}),o.drawFrame()):t.setSharedStorage(ke,null)}if(["hover","resize"].includes(t.getSharedStorage(ke)))return!1;h==="hover"&&!t.getSharedStorage(ke)&&o.drawFrame()},pointStart:g=>{if(l())return;u();const h=v(g);if(a=g.point,h)return d(h)?void 0:(t.setSharedStorage(ke,"resize"),!1);const m=t.getSharedStorage(ke);if(["hover","resize"].includes(m))return!1},pointMove:g=>{if(l())return;const h=t.getSharedStorage(ke),m=t.getSharedStorage(Nt),p=t.getActiveStorage("data");if(!(m&&d(m))){if(h==="resize"&&m&&(p!=null&&p.layout)){if(a){const M=t.getActiveStorage("scale"),w=(g.point.x-a.x)/M,y=(g.point.y-a.y)/M,{x:A,y:b,w:S,h:R}=p.layout;m==="top"?(p.layout.y=n.toGridNum(b+y),p.layout.h=n.toGridNum(R-y)):m==="right"?p.layout.w=n.toGridNum(S+w):m==="bottom"?p.layout.h=n.toGridNum(R+y):m==="left"?(p.layout.x=n.toGridNum(A+w),p.layout.w=n.toGridNum(S-w)):m==="top-left"?(p.layout.x=n.toGridNum(A+w),p.layout.y=n.toGridNum(b+y),p.layout.w=n.toGridNum(S-w),p.layout.h=n.toGridNum(R-y)):m==="top-right"?(p.layout.y=n.toGridNum(b+y),p.layout.w=n.toGridNum(S+w),p.layout.h=n.toGridNum(R-y)):m==="bottom-right"?(p.layout.w=n.toGridNum(S+w),p.layout.h=n.toGridNum(R+y)):m==="bottom-left"&&(p.layout.x=n.toGridNum(A+w),p.layout.w=n.toGridNum(S-w),p.layout.h=n.toGridNum(R+y))}return a=g.point,u(),o.drawFrame(),!1}if(["hover","resize"].includes(h))return!1}},pointEnd:()=>{const g=t.getSharedStorage(ke),h=t.getSharedStorage(Nt),m=t.getActiveStorage("data");m&&g==="resize"&&h&&!d(h)&&s.trigger($n,{type:"changeLayout",data:m}),c()},beforeDrawFrame:({snapshot:g})=>{var h;const{sharedStore:m,activeStore:p}=g,M=m[ke],w=m[Nt];if(!((h=p.data)===null||h===void 0)&&h.layout&&M&&w&&["hover","resize"].includes(M)){const y=ai(g),{x:A,y:b,w:S,h:R}=p.data.layout,O=to({x:A,y:b,w:S,h:R},{viewScaleInfo:y,controllerSize:10});_l(r,{controller:O,operations:p.data.layout.operations||{}})}},scrollX:()=>{c()},scrollY:()=>{c()},wheelScale:()=>{c()}}};var An=function(e,t,i,n,o){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!o)throw new TypeError("Private accessor was defined without a setter");if(typeof t=="function"?e!==t||!o:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?o.call(e,i):o?o.value=i:t.set(e,i),i},de=function(e,t,i,n){if(i==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof t=="function"?e!==t||!n:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return i==="m"?n:i==="a"?n.call(e):n?n.value:t.get(e)},Bn,fe,Hi,en,Hs;class Ol{constructor(t,i){Bn.add(this),fe.set(this,void 0),Hi.set(this,void 0),en.set(this,void 0);const{devicePixelRatio:n=1,width:o,height:s,createCustomContext2D:r}=i;An(this,en,t,"f");const a=document.createElement("canvas");An(this,Hi,a,"f"),de(this,Bn,"m",Hs).call(this),t.appendChild(a);const c=Cr(a,{width:o,height:s,devicePixelRatio:n,offscreen:!0,createCustomContext2D:r}),l=new Ua({boardContent:c,container:t}),d=l.getSharer();d.setActiveViewSizeInfo({width:o,height:s,devicePixelRatio:n,contextWidth:o,contextHeight:s}),An(this,fe,l,"f"),this.resize(d.getActiveViewSizeInfo());const f=l.getEventHub();new Ka(t,{eventHub:f})}isDestroyed(){return de(this,fe,"f").isDestroyed()}destroy(){de(this,fe,"f").destroy(),de(this,Hi,"f").remove()}use(t){de(this,fe,"f").use(t)}disuse(t){de(this,fe,"f").disuse(t)}setData(t,i){ns((t==null?void 0:t.elements)||[]),de(this,fe,"f").setData(t,i)}getData(){return de(this,fe,"f").getData()}scale(t){de(this,fe,"f").scale(t),de(this,fe,"f").getViewer().drawFrame()}resize(t){const i=de(this,fe,"f"),o=i.getSharer().getActiveViewSizeInfo();i.resize(Object.assign(Object.assign({},o),t))}clear(){de(this,fe,"f").clear()}on(t,i){de(this,fe,"f").getEventHub().on(t,i)}off(t,i){de(this,fe,"f").getEventHub().off(t,i)}trigger(t,i){de(this,fe,"f").getEventHub().trigger(t,i)}getViewInfo(){const i=de(this,fe,"f").getSharer(),n=i.getActiveViewSizeInfo(),o=i.getActiveViewScaleInfo();return{viewSizeInfo:n,viewScaleInfo:o}}refresh(){de(this,fe,"f").getViewer().drawFrame()}setViewScale(t){de(this,fe,"f").updateViewScaleInfo(t)}getLoadItemMap(){return de(this,fe,"f").getRenderer().getLoadItemMap()}onBoardWatcherEvents(){de(this,fe,"f").onWatcherEvents()}offBoardWatcherEvents(){de(this,fe,"f").offWatcherEvents()}}fe=new WeakMap,Hi=new WeakMap,en=new WeakMap,Bn=new WeakSet,Hs=function(){const t=de(this,en,"f");t.style.position="relative"};const tn="select",Wl={mode:tn};function kl(){return{mode:tn,enableRuler:!1,enableScale:!1,enableScroll:!1,enableSelect:!1,enableTextEdit:!1,enableDrag:!1,enableInfo:!1}}var jl=function(e,t,i,n){function o(s){return s instanceof i?s:new i(function(r){r(s)})}return new(i||(i=Promise))(function(s,r){function a(d){try{l(n.next(d))}catch(f){r(f)}}function c(d){try{l(n.throw(d))}catch(f){r(f)}}function l(d){d.done?s(d.value):o(d.value).then(a,c)}l((n=n.apply(e,t||[])).next())})};function Vl(e){return jl(this,void 0,void 0,function*(){const{data:t,width:i,height:n,devicePixelRatio:o,viewScaleInfo:s,viewSizeInfo:r,loadItemMap:a}=e;let c=Ii({width:i,height:n,devicePixelRatio:o}),l=new xs({viewContext:c}),d=new Ms({viewContext:c,calculator:l});d.setLoadItemMap(a),d.drawData(t,{viewScaleInfo:s,viewSizeInfo:r,forceDrawAll:!0});let f=null,u=c.$getOffscreenCanvas();if(u){const v=yield u.convertToBlob();f=window.URL.createObjectURL(v)}return u=null,c=null,l=null,d=null,{blobURL:f,width:i,height:n,devicePixelRatio:o}})}const Bl=$n,Uo={change:Bl,ruler:Vn,scale:ks,select:Fi,clearSelect:Ki,textEdit:qi,textChange:Wn},Qe={};Object.keys(Uo).forEach(e=>{Object.defineProperty(Qe,e,{value:Uo[e],writable:!1})});function Yl(e){return["select","drag","readOnly"].includes(e)}function Ns(e,t){const{enableRuler:i,enableScale:n,enableScroll:o,enableSelect:s,enableTextEdit:r,enableDrag:a,enableInfo:c}=t.getSnapshot();o===!0?e.use(jo):o===!1&&e.disuse(jo),s===!0?(e.use(No),e.use(Do)):s===!1&&(e.disuse(No),e.disuse(Do)),n===!0?e.use(Vo):n===!1&&e.disuse(Vo),i===!0?e.use(Go):i===!1&&e.disuse(Go),r===!0?e.use(Co):r===!1&&e.disuse(Co),a===!0?e.use(Xo):a===!1&&e.disuse(Xo),c===!0?e.use(Ho):c===!1&&e.disuse(Ho)}function Yn(e,t,i){let n=!1,o=!1,s=!1,r=!1,a=!1,c=!1;const l=!0;let d="select";i.set("mode",d),Yl(e)?d=e:console.warn(`${e} is invalid mode of iDraw.js`),d==="select"?(n=!0,o=!0,s=!0,r=!0,a=!1,c=!0):d==="drag"?(n=!0,o=!0,s=!1,r=!1,a=!0,c=!0):d==="readOnly"&&(n=!1,o=!1,s=!1,r=!1,a=!1,c=!1),i.set("enableScale",n),i.set("enableScroll",o),i.set("enableSelect",s),i.set("enableTextEdit",r),i.set("enableDrag",a),i.set("enableRuler",c),i.set("enableInfo",l),Ns(t,i)}var Fl=function(e,t,i,n){function o(s){return s instanceof i?s:new i(function(r){r(s)})}return new(i||(i=Promise))(function(s,r){function a(d){try{l(n.next(d))}catch(f){r(f)}}function c(d){try{l(n.throw(d))}catch(f){r(f)}}function l(d){d.done?s(d.value):o(d.value).then(a,c)}l((n=n.apply(e,t||[])).next())})},In=function(e,t,i,n,o){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!o)throw new TypeError("Private accessor was defined without a setter");if(typeof t=="function"?e!==t||!o:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?o.call(e,i):o?o.value=i:t.set(e,i),i},q=function(e,t,i,n){if(i==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof t=="function"?e!==t||!n:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return i==="m"?n:i==="a"?n.call(e):n?n.value:t.get(e)},Kt,te,qt,ut,Us,Fn;class Ic{constructor(t,i){Kt.add(this),te.set(this,void 0),qt.set(this,void 0),ut.set(this,new oi({defaultStorage:kl()}));const n=Object.assign(Object.assign({},Wl),i),{width:o,height:s,devicePixelRatio:r,createCustomContext2D:a}=n,c=new Ol(t,{width:o,height:s,devicePixelRatio:r,createCustomContext2D:a});In(this,te,c,"f"),In(this,qt,n,"f"),q(this,Kt,"m",Us).call(this)}reset(t){const i=q(this,te,"f"),n=q(this,ut,"f");n.clear(),Yn(t.mode||tn,i,n),i.refresh(),In(this,qt,Object.assign(Object.assign({},q(this,qt,"f")),t),"f")}setMode(t){const i=q(this,te,"f"),n=q(this,ut,"f");Yn(t||tn,i,n),i.refresh()}enable(t){q(this,Kt,"m",Fn).call(this,t,!0)}disable(t){q(this,Kt,"m",Fn).call(this,t,!1)}setData(t){const i=q(this,te,"f");i.setData(t),i.trigger(Qe.change,{data:t,type:"setData"})}getData(t){const i=q(this,te,"f").getData();return i&&(t==null?void 0:t.compact)===!0?Js(i,{loadItemMap:q(this,te,"f").getLoadItemMap()}):i}getViewInfo(){return q(this,te,"f").getViewInfo()}scale(t){q(this,te,"f").scale(t)}setViewScale(t){const i=q(this,te,"f");i.setViewScale(t),i.refresh()}centerContent(t){const i=(t==null?void 0:t.data)||q(this,te,"f").getData(),{viewSizeInfo:n}=this.getViewInfo();if(i!=null&&i.layout||Array.isArray(i==null?void 0:i.elements)&&(i==null?void 0:i.elements.length)>0){const o=Ma(i,{viewSizeInfo:n});this.setViewScale(o)}}resize(t){q(this,te,"f").resize(t)}on(t,i){q(this,te,"f").on(t,i)}off(t,i){q(this,te,"f").off(t,i)}trigger(t,i){q(this,te,"f").trigger(t,i)}selectElement(t){this.selectElements([t])}selectElements(t){this.trigger(Qe.select,{uuids:t})}selectElementByPosition(t){this.selectElementsByPositions([t])}selectElementsByPositions(t){this.trigger(Qe.select,{positions:t})}cancelElements(){this.trigger(Qe.select,{uuids:[]})}createElement(t,i){const{viewScaleInfo:n,viewSizeInfo:o}=q(this,te,"f").getViewInfo();return pa(t,(i==null?void 0:i.element)||{},(i==null?void 0:i.viewCenter)===!0?{viewScaleInfo:n,viewSizeInfo:o}:void 0)}updateElement(t){const i=q(this,te,"f"),n=i.getData()||{elements:[]};gs(t.uuid,t,n.elements),i.setData(n),i.refresh(),i.trigger(Qe.change,{data:n,type:"updateElement"})}addElement(t,i){var n;const o=q(this,te,"f"),s=o.getData()||{elements:[]};if(!i||!(!((n=i==null?void 0:i.position)===null||n===void 0)&&n.length))s.elements.push(t);else if(i!=null&&i.position){const r=[...i==null?void 0:i.position];Nn(t,r,s.elements)}return o.setData(s),o.refresh(),o.trigger(Qe.change,{data:s,type:"addElement"}),s}deleteElement(t){const i=q(this,te,"f"),n=i.getData()||{elements:[]};ba(t,n.elements),i.setData(n),i.refresh(),i.trigger(Qe.change,{data:n,type:"deleteElement"})}moveElement(t,i){const n=q(this,te,"f"),o=n.getData()||{elements:[]},s=ei(t,o.elements),{elements:r}=hs(o.elements,{from:s,to:i});o.elements=r,n.setData(o),n.refresh(),n.trigger(Qe.change,{data:o,type:"moveElement"})}getImageBlobURL(t){return Fl(this,void 0,void 0,function*(){const i=this.getData()||{elements:[]},{devicePixelRatio:n}=t,o=Vr(i.elements),{viewSizeInfo:s}=this.getViewInfo();return yield Vl({width:o.w,height:o.h,devicePixelRatio:n,data:i,viewScaleInfo:{scale:1,offsetLeft:-o.x,offsetTop:-o.y,offsetBottom:0,offsetRight:0},viewSizeInfo:Object.assign(Object.assign({},s),{devicePixelRatio:n}),loadItemMap:q(this,te,"f").getLoadItemMap()})})}isDestroyed(){return q(this,te,"f").isDestroyed()}destroy(){const t=q(this,te,"f"),i=q(this,ut,"f");t.destroy(),i.destroy()}getViewCenter(){const{viewScaleInfo:t,viewSizeInfo:i}=this.getViewInfo();return xa({viewScaleInfo:t,viewSizeInfo:i})}$onBoardWatcherEvents(){q(this,te,"f").onBoardWatcherEvents()}$offBoardWatcherEvents(){q(this,te,"f").offBoardWatcherEvents()}}te=new WeakMap,qt=new WeakMap,ut=new WeakMap,Kt=new WeakSet,Us=function(){const t=q(this,te,"f"),i=q(this,ut,"f");Yn("select",t,i)},Fn=function(t,i){const n=q(this,ut,"f");if(["ruler","scroll","scale","info"].includes(t)){const o={ruler:"enableRuler",scroll:"enableScroll",scale:"enableScale",info:"enableInfo"};n.set(o[t],!!i),Ns(q(this,te,"f"),n),q(this,te,"f").refresh()}else t==="selectInGroup"?q(this,te,"f").trigger(Cn,{enable:!!i}):t==="snapToGrid"&&q(this,te,"f").trigger(Dn,{enable:!!i})};export{xs as Calculator,qo as Context2D,Ol as Core,ri as EventEmitter,Go as MiddlewareRuler,Vo as MiddlewareScaler,jo as MiddlewareScroller,Do as MiddlewareSelector,Co as MiddlewareTextEditor,Ms as Renderer,Xa as Sharer,oi as Store,es as calcDistance,Fe as calcElementCenter,ts as calcElementCenterFromVertexes,Vr as calcElementListSize,rn as calcElementOriginRectInfo,Gn as calcElementQueueVertexesQueueInGroup,vi as calcElementSizeController,si as calcElementVertexesInGroup,Nr as calcElementVertexesQueueInGroup,yc as calcElementViewRectInfo,wc as calcElementViewRectInfoMap,os as calcElementsContextSize,Br as calcElementsViewInfo,rc as calcSpeed,an as calcViewBoxSize,xa as calcViewCenter,Ma as calcViewCenterContent,Ie as calcViewElementSize,N as calcViewPointSize,xe as calcViewVertexes,sc as check,Hr as checkRectIntersect,ec as colorNameToHex,tc as colorToCSS,ic as colorToLinearGradientCSS,Gl as compose,Mc as compressImage,qe as createAssetId,Cr as createBoardContent,bt as createContext2D,pa as createElement,Ii as createOffscreenContext2D,gt as createUUID,Nl as debounce,Vt as deepClone,nc as deepCloneElement,Hn as deepResizeGroupElement,Xl as delay,ba as deleteElementInList,Un as deleteElementInListByPosition,Jl as downloadFileFromText,Ul as downloadImageFromCanvas,_r as equalPoint,ac as equalTouchPoint,Qe as eventKeys,uc as filterElementAsset,Yr as findElementFromList,sn as findElementFromListByPosition,vc as findElementQueueFromListByPosition,Fr as findElementsFromList,Xr as findElementsFromListByPositions,ye as formatNumber,Sc as generateHTML,Xn as generateSVGPath,ue as getCenterFromTwoPoints,Bt as getDefaultElementDetailConfig,dc as getElemenetsAssetIds,ei as getElementPositionFromList,is as getElementRotateVertexes,fc as getElementSize,rs as getElementVertexes,Gr as getGroupQueueFromList,cc as getSelectedElementUUIDs,Jr as getViewPointAtElement,ai as getViewScaleInfoFromSnapshot,on as getViewSizeInfoFromSnapshot,Ic as iDraw,Nn as insertElementToListByPosition,J as is,vt as isAssetId,Ni as isColorStr,mc as isElementInView,gc as isResourceElement,zn as isViewPointInElement,Ut as istype,Be as limitAngle,nr as loadHTML,nn as loadImage,tr as loadSVG,xc as matrixToAngle,la as matrixToRadian,hc as mergeElementAsset,Kn as mergeHexColorAlpha,Vn as middlewareEventRuler,ks as middlewareEventScale,Fi as middlewareEventSelect,Ki as middlewareEventSelectClear,Ac as modifyElement,hs as moveElementPosition,et as parseAngleToRadian,Ql as parseFileToBase64,Zl as parseFileToText,bc as parseHTML,Wr as parseRadianToAngle,pc as parseSVGPath,$l as pickFile,Ye as rotateElement,wt as rotateElementVertexes,le as rotatePoint,$i as rotatePointInGroup,eo as rotateVertexes,oc as sortDataAsserts,Kr as sortElementsViewVisiableInfoMap,Hl as throttle,Kl as toColorHexNum,ql as toColorHexStr,gs as updateElementInList,Or as vaildPoint,lc as vaildTouchPoint,ns as validateElements,$r as viewScale,Qr as viewScroll};
